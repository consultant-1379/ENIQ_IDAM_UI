{"version":3,"sources":["../../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/OperatorRulesView.js"],"names":["define","$","_","AbstractView","UIUtils","extend","template","noBaseTemplate","events","data","mode","select","dropbox","operatorI18nKey","render","args","element","itemID","firstChild","callback","self","each","operators","operator","i18nKey","title","setElement","fillTemplateWithData","tpl","$el","append","find","delegateEvents","focus","trigger","popover","setValue","value","val","rebindElement","onSelect","e","item","currentTarget","parent","itemData","schema","obj","type","map","config","properties","key","removeClass","toLowerCase","addClass","checkOptions","target","children","option","length","isDisabled","condition","subject","prop"],"mappings":";;AAAA;;;;;;;;;;;;;;;;AAgBAA,OAAO,CACH,QADG,EAEH,QAFG,EAGH,mDAHG,EAIH,8CAJG,CAAP,EAKG,UAAUC,CAAV,EAAaC,CAAb,EAAgBC,YAAhB,EAA8BC,OAA9B,EAAuC;AACtC,WAAOD,aAAaE,MAAb,CAAoB;AACvBC,kBAAU,2FADa;AAEvBC,wBAAgB,IAFO;AAGvBC,gBAAQ;AACJ,kCAAsB,UADlB;AAEJ,gCAAoB,cAFhB;AAGJ,gCAAoB;AAHhB,SAHe;AAQvBC,cAAM,EARiB;AASvBC,cAAM,QATiB;AAUvBC,gBAAQ,IAVe;AAWvBC,iBAAS,IAXc;;AAavBC,yBAAiB,gDAbM;;AAevBC,cAfuB,kBAefC,IAfe,EAeTC,OAfS,EAeAC,MAfA,EAeQC,UAfR,EAeoBC,QAfpB,EAe8B;AACjD,gBAAIC,OAAO,IAAX;;AAEA,iBAAKX,IAAL,GAAYR,EAAEI,MAAF,CAAS,IAAT,EAAe,EAAf,EAAmBU,IAAnB,CAAZ;AACA,iBAAKN,IAAL,CAAUQ,MAAV,GAAmBA,MAAnB;AACA,iBAAKR,IAAL,CAAUS,UAAV,GAAuBA,UAAvB;;AAEAhB,cAAEmB,IAAF,CAAO,KAAKZ,IAAL,CAAUa,SAAjB,EAA4B,UAAUC,QAAV,EAAoB;AAC5CA,yBAASC,OAAT,GAAmBJ,KAAKP,eAAL,GAAuBU,SAASE,KAAnD;AACH,aAFD;;AAIA,iBAAKC,UAAL,CAAgBV,OAAhB;;AAEAZ,oBAAQuB,oBAAR,CAA6B,KAAKrB,QAAlC,EAA4C,KAAKG,IAAjD,EAAuD,UAAUmB,GAAV,EAAe;AAClER,qBAAKS,GAAL,CAASC,MAAT,CAAgBF,GAAhB;;AAEAR,qBAAKM,UAAL,eAA4BT,MAA5B;AACAG,qBAAKT,MAAL,GAAcS,KAAKS,GAAL,CAASE,IAAT,CAAc,QAAd,CAAd;AACAX,qBAAKY,cAAL;;AAEAZ,qBAAKT,MAAL,CAAYsB,KAAZ,GAAoBC,OAApB,CAA4B,QAA5B;AACAd,qBAAKS,GAAL,CAASpB,IAAT,CAAc,SAAd,EAAyB,IAAzB;AACAW,qBAAKR,OAAL,GAAeQ,KAAKS,GAAL,CAASE,IAAT,CAAc,UAAd,CAAf;;AAEAX,qBAAKS,GAAL,CAASE,IAAT,CAAc,4BAAd,EAA4CI,OAA5C;;AAEA,oBAAIhB,QAAJ,EAAc;AACVA;AACH;AACJ,aAhBD;AAiBH,SA7CsB;AA+CvBiB,gBA/CuB,oBA+CbC,KA/Ca,EA+CN;AACb,iBAAK1B,MAAL,CAAYsB,KAAZ,GAAoBK,GAApB,CAAwBD,KAAxB,EAA+BH,OAA/B,CAAuC,QAAvC;AACH,SAjDsB;AAmDvBK,qBAnDuB,2BAmDN;AACb,iBAAKP,cAAL;AACH,SArDsB;AAuDvBQ,gBAvDuB,oBAuDbC,CAvDa,EAuDV;AACT,gBAAIC,OAAOzC,EAAEwC,EAAEE,aAAJ,EAAmBC,MAAnB,EAAX;AAAA,gBACIP,QAAQI,EAAEE,aAAF,CAAgBN,KAD5B;AAAA,gBAEIQ,WAAW,EAFf;AAAA,gBAGIC,SAAS5C,EAAE6B,IAAF,CAAO,KAAKtB,IAAL,CAAUa,SAAjB,EAA4B,UAAUyB,GAAV,EAAe;AAChD,uBAAOA,IAAItB,KAAJ,KAAcY,KAArB;AACH,aAFQ,CAHb;;AAOAQ,qBAASG,IAAT,GAAgBF,OAAOrB,KAAvB;AACAvB,cAAE+C,GAAF,CAAMH,OAAOI,MAAP,CAAcC,UAApB,EAAgC,UAAUd,KAAV,EAAiBe,GAAjB,EAAsB;AAClDP,yBAASO,GAAT,IAAgBf,KAAhB;AACH,aAFD;;AAIAK,iBAAKjC,IAAL,CAAU,UAAV,EAAsBoC,QAAtB;;AAEA3C,cAAEmB,IAAF,CAAO,KAAKZ,IAAL,CAAUa,SAAjB,EAA4B,UAAUyB,GAAV,EAAe;AACvCL,qBAAKW,WAAL,CAAiBN,IAAItB,KAAJ,CAAU6B,WAAV,EAAjB;AACH,aAFD;AAGAZ,iBAAKa,QAAL,CAAclB,MAAMiB,WAAN,EAAd;AACH,SA1EsB;AA4EvBE,oBA5EuB,wBA4ETf,CA5ES,EA4EN;AACb,gBAAIG,SAAS3C,EAAEwC,EAAEgB,MAAJ,EAAYb,MAAZ,EAAb;AAAA,gBACIhC,UAAUgC,OAAOc,QAAP,CAAgB,YAAhB,CADd;AAAA,gBAEI/C,SAASC,QAAQgC,MAAR,GAAiBc,QAAjB,CAA0B,QAA1B,CAFb;AAAA,gBAGIC,SAAS,IAHb;;AAKA,gBAAI/C,QAAQ8C,QAAR,CAAiB,gBAAjB,EAAmCE,MAAnC,GAA4C,CAAhD,EAAmD;AAC/C1D,kBAAEmB,IAAF,CAAO,KAAKZ,IAAL,CAAUa,SAAjB,EAA4B,UAAUyB,GAAV,EAAe;AACvCY,6BAAShD,OAAOoB,IAAP,qBAA6BgB,IAAItB,KAAjC,SAAT;AACA,wBAAIoC,aAAa,CAAC,EAAEd,IAAIG,MAAJ,CAAWC,UAAX,CAAsBW,SAAtB,IAAmCf,IAAIG,MAAJ,CAAWC,UAAX,CAAsBY,OAA3D,CAAlB;AACAJ,2BAAOK,IAAP,CAAY,UAAZ,EAAwBH,UAAxB;AACH,iBAJD;AAKH,aAND,MAMO;AACHlD,uBAAO+C,QAAP,GAAkBM,IAAlB,CAAuB,UAAvB,EAAmC,KAAnC;AACH;AACJ;AA3FsB,KAApB,CAAP;AA6FH,CAnGD","file":"OperatorRulesView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2014-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\"\n], function ($, _, AbstractView, UIUtils) {\n    return AbstractView.extend({\n        template: \"templates/admin/views/realms/authorization/policies/conditions/OperatorRulesTemplate.html\",\n        noBaseTemplate: true,\n        events: {\n            \"change    > select\": \"onSelect\",\n            \"onfocus   select\": \"checkOptions\",\n            \"mousedown select\": \"checkOptions\"\n        },\n        data: {},\n        mode: \"append\",\n        select: null,\n        dropbox: null,\n\n        operatorI18nKey: \"console.authorization.policies.edit.operators.\",\n\n        render (args, element, itemID, firstChild, callback) {\n            var self = this;\n\n            this.data = $.extend(true, {}, args);\n            this.data.itemID = itemID;\n            this.data.firstChild = firstChild;\n\n            _.each(this.data.operators, function (operator) {\n                operator.i18nKey = self.operatorI18nKey + operator.title;\n            });\n\n            this.setElement(element);\n\n            UIUtils.fillTemplateWithData(this.template, this.data, function (tpl) {\n                self.$el.append(tpl);\n\n                self.setElement(`#operator${itemID}`);\n                self.select = self.$el.find(\"select\");\n                self.delegateEvents();\n\n                self.select.focus().trigger(\"change\");\n                self.$el.data(\"logical\", true);\n                self.dropbox = self.$el.find(\".dropbox\");\n\n                self.$el.find('.fa[data-toggle=\"popover\"]').popover();\n\n                if (callback) {\n                    callback();\n                }\n            });\n        },\n\n        setValue (value) {\n            this.select.focus().val(value).trigger(\"change\");\n        },\n\n        rebindElement () {\n            this.delegateEvents();\n        },\n\n        onSelect (e) {\n            var item = $(e.currentTarget).parent(),\n                value = e.currentTarget.value,\n                itemData = {},\n                schema = _.find(this.data.operators, function (obj) {\n                    return obj.title === value;\n                });\n\n            itemData.type = schema.title;\n            _.map(schema.config.properties, function (value, key) {\n                itemData[key] = value;\n            });\n\n            item.data(\"itemData\", itemData);\n\n            _.each(this.data.operators, function (obj) {\n                item.removeClass(obj.title.toLowerCase());\n            });\n            item.addClass(value.toLowerCase());\n        },\n\n        checkOptions (e) {\n            var parent = $(e.target).parent(),\n                dropbox = parent.children(\"ol.dropbox\"),\n                select = dropbox.parent().children(\"select\"),\n                option = null;\n\n            if (dropbox.children(\":not(.dragged)\").length > 1) {\n                _.each(this.data.operators, function (obj) {\n                    option = select.find(`option[value=\"${obj.title}\"]`);\n                    var isDisabled = !!(obj.config.properties.condition || obj.config.properties.subject);\n                    option.prop(\"disabled\", isDisabled);\n                });\n            } else {\n                select.children().prop(\"disabled\", false);\n            }\n        }\n    });\n});\n"]}