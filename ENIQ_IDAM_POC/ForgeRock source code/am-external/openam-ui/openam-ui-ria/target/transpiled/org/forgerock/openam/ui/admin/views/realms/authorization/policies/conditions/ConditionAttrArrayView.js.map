{"version":3,"sources":["../../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrArrayView.js"],"names":["define","$","_","ConditionAttrBaseView","PoliciesService","DEFAULT_TIME_ZONE","IDENTITY_PLACEHOLDER","IDENTITY_TYPES","MIN_QUERY_LENGTH","SCRIPT_PLACEHOLDER","SCRIPT_TYPE","AUTHENTICATION_STRATEGY_ENUM_ARRAY","AUTHENTICATION_STRATEGY_TYPE","AUTHENTICATION_STRATEGY_I18N_PATH","TIME_ZONE_PLACEHOLDER","TIME_ZONE_TYPE","extend","template","render","data","element","callback","title","multiple","undefined","initBasic","parentRender","view","text","itemData","options","item","$item","type","$el","find","each","parent","source","placeholder","t","preload","sortField","load","query","loadFromDataSource","call","onChange","value","$input","hiddenData","selectize","ajax","url","dataType","cache","done","timezones","addOption","enforcementTimeZone","contains","length","queryIdentities","onItemAdd","getUniversalId","onItemRemove","universalid","findKey","obj","subjectValues","without","valueField","labelField","map","key","label","items","authenticationStrategy","create","delimiter","persist","input","prev","createFilter","indexOf","lastIndexOf","plugins","result","error","e","console","self","subject","union","getDataByType","then","_id","name"],"mappings":"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","file":"ConditionAttrArrayView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrBaseView\",\n    \"org/forgerock/openam/ui/admin/services/realm/PoliciesService\",\n\n    // jquery dependencies\n    \"selectize\"\n], function ($, _, ConditionAttrBaseView, PoliciesService) {\n    const DEFAULT_TIME_ZONE = \"GMT\";\n    const IDENTITY_PLACEHOLDER = \"console.authorization.policies.edit.subjectTypes.Identity.placeholder\";\n    const IDENTITY_TYPES = [\"users\", \"groups\"];\n    const MIN_QUERY_LENGTH = 1;\n    const SCRIPT_PLACEHOLDER = \"console.authorization.policies.edit.conditionTypes.Script.placeholder\";\n    const SCRIPT_TYPE = \"scriptId\";\n    const AUTHENTICATION_STRATEGY_ENUM_ARRAY = [\n        \"AuthenticateToServiceConditionAdvice\", \"AuthenticateToRealmConditionAdvice\",\n        \"AuthenticateToTreeConditionAdvice\", \"AuthSchemeConditionAdvice\", \"AuthLevelConditionAdvice\"\n    ];\n    const AUTHENTICATION_STRATEGY_TYPE = \"authenticationStrategy\";\n    const AUTHENTICATION_STRATEGY_I18N_PATH = \"console.authorization.policies.edit.conditionTypes.Transaction.props.\";\n    const TIME_ZONE_PLACEHOLDER = \"console.authorization.policies.edit.conditionTypes.SimpleTime.props.enterTimeZone\";\n    const TIME_ZONE_TYPE = \"enforcementTimeZone\";\n\n    return ConditionAttrBaseView.extend({\n        template: \"templates/admin/views/realms/authorization/policies/conditions/ConditionAttrArray.html\",\n\n        render (data, element, callback) {\n            if (data.title === AUTHENTICATION_STRATEGY_TYPE) {\n                data.multiple = false;\n            }\n\n            // default to multiple selection if this option is not specified\n            if (data.multiple === undefined) {\n                data.multiple = true;\n            }\n\n            this.initBasic(data, element, \"field-float-selectize data-obj\");\n\n            this.parentRender(function () {\n                var view = this,\n                    title = \"\",\n                    text = \"\",\n                    itemData,\n                    options,\n                    item, $item,\n                    type;\n\n                this.$el.find(\"select.selectize\").each(function () {\n                    item = this;\n                    $item = $(this);\n                    type = $item.parent().find(\"label\").data().title;\n                    options = {};\n\n                    if ($item.data().source) {\n                        if (type === SCRIPT_TYPE) {\n                            _.extend(options, {\n                                placeholder: $.t(SCRIPT_PLACEHOLDER),\n                                preload: true,\n                                sortField: \"value\",\n                                load (query, callback) {\n                                    view.loadFromDataSource.call(this, item, callback);\n                                },\n                                onChange (value) {\n                                    title = this.$input.parent().find(\"label\").data().title;\n                                    text = this.$input.find(\":selected\").text();\n                                    view.data.itemData[title] = value ? value : \"\";\n                                    view.data.hiddenData[view.data.itemData.type] = text ? text : \"\";\n                                }\n                            });\n                        } else if (type === TIME_ZONE_TYPE) {\n                            _.extend(options, {\n                                placeholder: $.t(TIME_ZONE_PLACEHOLDER),\n                                preload: true,\n                                sortField: \"value\",\n                                render: {\n                                    item (item) {\n                                        return `<span class='time-zone-selected'>${item.text}</span>`;\n                                    }\n                                },\n                                load () {\n                                    var selectize = this;\n                                    $.ajax({\n                                        url: \"timezones.json\",\n                                        dataType: \"json\",\n                                        cache: true\n                                    }).done(function (data) {\n                                        _.each(data.timezones, function (value) {\n                                            selectize.addOption({ value, text: value });\n                                        });\n                                    });\n                                },\n                                onChange (value) {\n                                    view.data.itemData.enforcementTimeZone = value ? value : DEFAULT_TIME_ZONE;\n                                }\n                            });\n                        } else if (_.contains(IDENTITY_TYPES, type)) {\n                            _.extend(options, {\n                                placeholder: $.t(IDENTITY_PLACEHOLDER),\n                                sortField: \"value\",\n                                load (query, callback) {\n                                    if (query.length < MIN_QUERY_LENGTH) {\n                                        return callback();\n                                    }\n                                    view.queryIdentities.call(this, item, query, callback);\n                                },\n                                onItemAdd (item) {\n                                    view.getUniversalId(item, type);\n                                },\n                                onItemRemove (item) {\n                                    var universalid = _.findKey(view.data.hiddenData[type], function (obj) {\n                                        return obj === item;\n                                    });\n\n                                    view.data.itemData.subjectValues = _.without(view.data.itemData.subjectValues,\n                                        universalid);\n                                    delete view.data.hiddenData[type][universalid];\n                                }\n                            });\n                        }\n                    } else if (type === AUTHENTICATION_STRATEGY_TYPE) {\n                        _.extend(options, {\n                            placeholder: $.t(\"common.form.select\"),\n                            valueField: \"value\",\n                            labelField: \"label\",\n                            options: _.map(AUTHENTICATION_STRATEGY_ENUM_ARRAY, (key) => {\n                                return {\n                                    value: key,\n                                    label: $.t(`${AUTHENTICATION_STRATEGY_I18N_PATH}${key}`)\n                                };\n                            }),\n                            items: [view.data.itemData.authenticationStrategy],\n                            create: false,\n                            onChange (value) {\n                                title = this.$input.parent().find(\"label\").data().title;\n                                itemData = view.data.itemData;\n                                itemData[title] = value ? value : \"\";\n                            }\n                        });\n                    } else {\n                        _.extend(options, {\n                            delimiter: false,\n                            persist: false,\n                            create (input) {\n                                return {\n                                    value: input,\n                                    text: input\n                                };\n                            },\n                            onChange (value) {\n                                title = this.$input.parent().find(\"label\").data().title;\n                                itemData = view.data.itemData;\n                                itemData[title] = value ? value : [];\n                            }\n                        });\n                        if ($item.prev(\"label\").data(\"title\") === \"dnsName\") {\n                            options.createFilter = function (text) {\n                                return text.indexOf(\"*\") === -1 || text.lastIndexOf(\"*\") === 0;\n                            };\n                        }\n                    }\n\n                    _.extend(options, { plugins: [\"restore_on_backspace\"] });\n                    $item.selectize(options);\n                });\n\n                if (callback) {\n                    callback();\n                }\n            });\n        },\n\n        queryIdentities (item, query, callback) {\n            var selectize = this;\n            PoliciesService.queryIdentities($(item).data().source, query)\n                .done(function (data) {\n                    _.each(data.result, function (value) {\n                        selectize.addOption({ value, text: value });\n                    });\n                    callback(data.result);\n                }).error(function (e) {\n                    console.error(\"error\", e);\n                    callback();\n                });\n        },\n\n        getUniversalId (item, type) {\n            var self = this;\n            PoliciesService.getUniversalId(item, type).done(function (subject) {\n                self.data.itemData.subjectValues = _.union(self.data.itemData.subjectValues, subject.universalid);\n                self.data.hiddenData[type][subject.universalid[0]] = item;\n            });\n        },\n\n        loadFromDataSource (item, callback) {\n            var selectize = this;\n            PoliciesService.getDataByType($(item).data().source).then(function (data) {\n                _.each(data.result, function (value) {\n                    selectize.addOption({ value: value._id, text: value.name });\n                });\n                callback(data.result);\n            }, function (e) {\n                console.error(\"error\", e);\n                callback();\n            });\n        }\n    });\n});\n"]}