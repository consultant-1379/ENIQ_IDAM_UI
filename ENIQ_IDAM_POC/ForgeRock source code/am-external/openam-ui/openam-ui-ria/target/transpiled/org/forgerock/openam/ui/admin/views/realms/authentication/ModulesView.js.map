{"version":3,"sources":["../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authentication/ModulesView.js"],"names":["define","$","_","AbstractView","arrayify","Configuration","EditModuleDialog","Form","FormHelper","Messages","Promise","AuthenticationService","getModuleInfoFromElement","element","closest","data","performDeleteModules","realmPath","moduleInfos","all","map","moduleInfo","authentication","modules","remove","moduleName","moduleType","ModulesView","extend","template","events","partials","moduleSelected","event","hasModuleSelected","$el","find","is","row","currentTarget","checked","prop","addClass","removeClass","editModule","preventDefault","href","moduleChains","onDeleteSingle","showConfirmationBeforeDeleting","type","t","bind","deleteModule","onDeleteMultiple","selectedModules","message","count","length","deleteModules","self","then","render","args","response","addMessage","TYPE_DANGER","toArray","value","callback","chainsPromise","modulesPromise","chains","values","each","result","module","chain","authChainConfiguration","link","_id","push","uniq","formData","parentRender","errorChains","errorModules","save","promise","update","form","bindSavePromiseToElement"],"mappings":"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","file":"ModulesView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/openam/ui/common/util/array/arrayify\",\n    \"org/forgerock/commons/ui/common/main/Configuration\",\n    \"org/forgerock/openam/ui/admin/views/realms/authentication/EditModuleDialog\",\n    \"org/forgerock/openam/ui/admin/models/Form\",\n    \"org/forgerock/openam/ui/admin/utils/FormHelper\",\n    \"org/forgerock/commons/ui/common/components/Messages\",\n    \"org/forgerock/openam/ui/common/util/Promise\",\n    \"org/forgerock/openam/ui/admin/services/realm/AuthenticationService\",\n\n    // jquery dependencies\n    \"selectize\"\n], function ($, _, AbstractView, arrayify, Configuration, EditModuleDialog, Form, FormHelper, Messages,\n             Promise, AuthenticationService) {\n    function getModuleInfoFromElement (element) {\n        return $(element).closest(\"tr\").data();\n    }\n    function performDeleteModules (realmPath, moduleInfos) {\n        return Promise.all(arrayify(moduleInfos).map(function (moduleInfo) {\n            return AuthenticationService.authentication.modules.remove(realmPath, moduleInfo.moduleName,\n                moduleInfo.moduleType);\n        }));\n    }\n\n    var ModulesView = AbstractView.extend({\n        template: \"templates/admin/views/realms/authentication/ModulesTemplate.html\",\n        events: {\n            \"change [data-select-module]\"   : \"moduleSelected\",\n            \"click [data-delete-module]\"    : \"onDeleteSingle\",\n            \"click [data-delete-modules]\"   : \"onDeleteMultiple\",\n            \"click [data-check-before-edit]\": \"editModule\"\n        },\n        partials: [\n            \"partials/alerts/_Alert.html\"\n        ],\n        data: {},\n        moduleSelected (event) {\n            var hasModuleSelected = this.$el.find(\"input[type=checkbox]\").is(\":checked\"),\n                row = $(event.currentTarget).closest(\"tr\"),\n                checked = $(event.currentTarget).is(\":checked\");\n\n            this.$el.find(\"[data-delete-modules]\").prop(\"disabled\", !hasModuleSelected);\n            if (checked) {\n                row.addClass(\"selected\");\n            } else {\n                row.removeClass(\"selected\");\n            }\n        },\n        editModule (event) {\n            event.preventDefault();\n            var data = $(event.currentTarget).closest(\"tr\").data(),\n                href = event.currentTarget.href;\n\n            EditModuleDialog(data.moduleName, data.moduleChains, href);\n        },\n        onDeleteSingle (event) {\n            event.preventDefault();\n\n            FormHelper.showConfirmationBeforeDeleting({\n                type: $.t(\"console.authentication.common.module\")\n            }, _.bind(this.deleteModule, this, event));\n        },\n        onDeleteMultiple (event) {\n            event.preventDefault();\n\n            var selectedModules = this.$el.find(\"input[type=checkbox]:checked\");\n\n            FormHelper.showConfirmationBeforeDeleting({\n                message: $.t(\"console.authentication.modules.confirmDeleteSelected\", { count: selectedModules.length })\n            }, _.bind(this.deleteModules, this, event, selectedModules));\n        },\n        deleteModule (event) {\n            var self = this,\n                element = event.currentTarget,\n                moduleInfo = getModuleInfoFromElement(element);\n\n            $(element).prop(\"disabled\", true);\n\n            performDeleteModules(this.data.realmPath, moduleInfo).then(function () {\n                self.render(self.data.args);\n            }, function (response) {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response\n                });\n                $(element).prop(\"disabled\", false);\n            });\n        },\n        deleteModules (event, selectedModules) {\n            var self = this,\n                element = event.currentTarget,\n                moduleInfos = _(selectedModules).toArray().map(getModuleInfoFromElement).value();\n\n            $(element).prop(\"disabled\", true);\n\n            performDeleteModules(this.data.realmPath, moduleInfos).then(function () {\n                self.render([self.data.realmPath]);\n            }, function (response) {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response\n                });\n                $(element).prop(\"disabled\", false);\n            });\n        },\n        render (args, callback) {\n            var self = this,\n                chainsPromise,\n                modulesPromise;\n\n            this.data.args = args;\n            this.data.realmPath = args[0];\n\n            chainsPromise = AuthenticationService.authentication.chains.all(this.data.realmPath);\n            modulesPromise = AuthenticationService.authentication.modules.all(this.data.realmPath);\n\n            Promise.all([chainsPromise, modulesPromise]).then(function (values) {\n                _.each(values[1][0].result, function (module) {\n                    _.each(values[0].values.result, function (chain) {\n                        _.each(chain.authChainConfiguration, function (link) {\n                            if (link.module === module._id) {\n                                module.chains = module.chains || [];\n                                module.chains.push(chain._id);\n                            }\n                        });\n                    });\n                    module.chains = _.uniq(module.chains);\n                });\n\n                self.data.formData = values[1][0].result;\n\n                self.parentRender(function () {\n                    if (callback) {\n                        callback();\n                    }\n                });\n            }, function (errorChains, errorModules) {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response: errorChains ? errorChains : errorModules\n                });\n\n                self.parentRender(function () {\n                    if (callback) {\n                        callback();\n                    }\n                });\n            });\n        },\n        save (event) {\n            var promise = AuthenticationService.authentication.update(this.data.form.data());\n\n            FormHelper.bindSavePromiseToElement(promise, event.currentTarget);\n        }\n    });\n\n    return ModulesView;\n});\n"]}