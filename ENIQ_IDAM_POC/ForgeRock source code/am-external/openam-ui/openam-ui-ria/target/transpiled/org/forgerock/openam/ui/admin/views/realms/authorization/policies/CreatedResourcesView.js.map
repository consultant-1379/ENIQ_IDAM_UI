{"version":3,"sources":["../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authorization/policies/CreatedResourcesView.js"],"names":["define","$","_","AbstractView","EventManager","Constants","UIUtils","CreatedResourcesView","extend","element","template","noBaseTemplate","events","render","args","callback","data","entity","resources","sortBy","self","parentRender","$el","find","selectize","sortField","field","direction","onChange","value","options","newPattern","fillTemplateWithData","content","html","autosizeInput","space","focus","select","justAdded","flashDomItem","validate","inputs","allInputsValid","input","isFunction","checkValidity","addResource","e","type","keyCode","resourceBuilder","resourceStr","resource","replace","strLength","length","count","i","duplicateIndex","sendEvent","EVENT_DISPLAY_MESSAGE_REQUEST","indexOf","push","removePendingResource","deleteResource","currentTarget","parent","without","showEditingResources","prop","removeClass","item","className","addClass","doTimeout","uniqueId"],"mappings":"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","file":"CreatedResourcesView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2014-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\n    \"autosizeInput\",\n    \"doTimeout\"\n], ($, _, AbstractView, EventManager, Constants, UIUtils) => {\n    const CreatedResourcesView = AbstractView.extend({\n        element: \"#editResources\",\n        template: \"templates/admin/views/realms/authorization/policies/CreatedResourcesTemplate.html\",\n        noBaseTemplate: true,\n        events: {\n            \"click [data-add-resource]\": \"addResource\",\n            \"keyup [data-add-resource]\": \"addResource\",\n            \"keyup #resourceBuilder input\": \"addResource\",\n            \"click span[data-delete]\": \"deleteResource\",\n            \"keyup span[data-delete]\": \"deleteResource\",\n            \"click [data-remove-pending]\": \"removePendingResource\",\n            \"click [data-show-editing]\" : \"showEditingResources\"\n        },\n\n        render (args, callback) {\n            _.extend(this.data, args);\n\n            if (this.data.entity.resources) {\n                this.data.entity.resources = _.sortBy(this.data.entity.resources);\n            } else {\n                this.data.entity.resources = [];\n            }\n\n            var self = this;\n\n            this.parentRender(() => {\n                this.$el.find(\".selectize\").selectize({\n                    sortField: {\n                        field: \"text\",\n                        direction: \"asc\"\n                    },\n                    onChange (value) {\n                        self.data.options.newPattern = value;\n\n                        UIUtils.fillTemplateWithData(\n                            \"templates/admin/views/realms/authorization/policies/PopulateResourceTemplate.html\",\n                            self.data,\n                            function (content) {\n                                var resources = self.$el.find(\"#populateResource\");\n                                resources.html(content);\n\n                                resources.find(\"input\").autosizeInput({ space: 19 });\n                                resources.find(\"input:eq(0)\").focus().select();\n                            });\n                    }\n                });\n\n                delete self.data.options.justAdded;\n                self.flashDomItem(self.$el.find(\".text-success\"), \"text-success\");\n\n                if (callback) { callback(); }\n            });\n        },\n\n        validate (inputs) {\n            // This is very simple native validation for supporting browsers for now.\n            // More complexity to come later.\n            let allInputsValid = true;\n\n            _.find(inputs, (input) => {\n                if (_.isFunction(input.checkValidity) && !input.checkValidity()) {\n                    allInputsValid = false;\n                    return;\n                }\n            });\n\n            return allInputsValid;\n        },\n\n        addResource (e) {\n            if (e.type === \"keyup\" && e.keyCode !== 13) {\n                return;\n            }\n\n            var resourceBuilder = this.$el.find(\"#resourceBuilder\"),\n                resourceStr = resourceBuilder.data().resource.replace(\"-*-\", \"̂\"),\n                inputs = resourceBuilder.find(\"input\"),\n                strLength = resourceStr.length,\n                resource = \"\",\n                count = 0,\n                i,\n                duplicateIndex;\n\n            if (this.validate(inputs) === false) {\n                EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"invalidItem\");\n                this.flashDomItem(this.$el.find(\".editing\"), \"text-danger\");\n                return;\n            }\n\n            for (i = 0; i < strLength; i++) {\n                if (resourceStr[i] === \"*\") {\n                    resource += inputs[count].value;\n                    count++;\n                } else if (resourceStr[i] === \"̂\") {\n                    resource += inputs[count].value === \"̂\" ? \"-*-\" : inputs[count].value;\n                    count++;\n                } else {\n                    resource += resourceStr[i];\n                }\n            }\n\n            duplicateIndex = _.indexOf(this.data.entity.resources, resource);\n\n            if (duplicateIndex >= 0) {\n                EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"duplicateItem\");\n                this.flashDomItem(this.$el.find(`#createdResources ul li:eq(${duplicateIndex})`), \"text-danger\");\n            } else {\n                this.data.entity.resources.push(resource);\n                this.data.options.justAdded = resource;\n                this.render(this.data);\n            }\n        },\n\n        removePendingResource (e) {\n            if (e.type === \"keyup\" && e.keyCode !== 13) {\n                return;\n            }\n\n            this.data.options.newPattern = null;\n            this.render(this.data);\n        },\n\n        deleteResource (e) {\n            if (e.type === \"keyup\" && e.keyCode !== 13) {\n                return;\n            }\n            var resource = $(e.currentTarget).parent().data().resource;\n            this.data.entity.resources = _.without(this.data.entity.resources, resource);\n            this.render(this.data);\n        },\n\n        showEditingResources () {\n            this.$el.find(\"[data-show-editing]\").prop(\"disabled\", true);\n            this.$el.find(\"li.editing\").removeClass(\"hidden\");\n        },\n\n        flashDomItem (item, className) {\n            item.addClass(className);\n            $.doTimeout(_.uniqueId(className), 2000, function () {\n                item.removeClass(className);\n            });\n        }\n    });\n\n    return new CreatedResourcesView();\n});\n"]}