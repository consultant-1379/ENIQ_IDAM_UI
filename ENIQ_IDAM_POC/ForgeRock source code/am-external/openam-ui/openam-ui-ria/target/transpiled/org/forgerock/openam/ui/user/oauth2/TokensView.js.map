{"version":3,"sources":["../../../../../../../XUI/org/forgerock/openam/ui/user/oauth2/TokensView.js"],"names":["define","$","AbstractView","tokensService","eventManager","constants","dataTable","i18nManager","require","TokensView","extend","template","delegate","events","select","event","stopPropagation","render","args","callback","parentRender","reloadData","sUrl","aoData","fnCallback","getAllTokens","tokens","data","aaData","i","cleanScope","cleanDate","length","selector","id","scope","text","wrap","parent","html","Date","Number","expireTime","t","toUrl","language","row","children","not","click","htmlCode","table","temp","td","getTokenByID","tokenInfo","output","realm","refreshToken","redirectURI","userName","next","attr","fnIsOpen","fnClose","fnOpen","formSubmit","preventDefault","fnGetNodes","each","deleteToken","location","reload"],"mappings":"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","file":"TokensView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2011-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/openam/ui/user/services/TokenService\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"dataTable\",\n    \"org/forgerock/commons/ui/common/main/i18nManager\",\n    \"require\"\n], function ($, AbstractView, tokensService, eventManager, constants, dataTable, i18nManager, require) {\n    var TokensView = AbstractView.extend({\n        template: \"templates/openam/oauth2/TokensTemplate.html\",\n\n        delegate: tokensService,\n\n        events: {\n            \"click checkbox\": \"select\",\n            \"click input[type=submit]\": \"formSubmit\"\n        },\n\n        select (event) {\n            event.stopPropagation();\n        },\n\n        render (args, callback) {\n            this.parentRender(function () {\n                this.reloadData();\n\n                if (callback) {\n                    callback();\n                }\n            });\n        },\n\n        reloadData () {\n            $(\"#tokensTable\").dataTable({\n                \"bProcessing\": true,\n                \"sAjaxSource\": \"\",\n                \"fnServerData\": (sUrl, aoData, fnCallback) => {\n                    tokensService.getAllTokens(function (tokens) {\n                        var data = { aaData: tokens }, i, cleanScope, cleanDate;\n\n                        for (i = 0; i < data.aaData.length; i++) {\n                            data.aaData[i].selector = `<input name=\"selector\" id=\"${\n                                data.aaData[i].id\n                            }\" type=\"checkbox\" />`;\n\n                            if (typeof data.aaData[i].scope === \"undefined\") {\n                                cleanScope = \"-\";\n                            } else {\n                                cleanScope = data.aaData[i].scope;\n                            }\n                            data.aaData[i].cleanScope = $('<span class=\"cleanScope\" />').text(cleanScope).wrap(\"<p>\")\n                                .parent().html();\n                            cleanDate = new Date(Number(data.aaData[i].expireTime));\n                            data.aaData[i].cleanDate = $('<span class=\"cleanDate\" />').text(cleanDate).wrap(\"<p>\")\n                                .parent().html();\n                        }\n\n                        fnCallback(data);\n                    });\n                },\n                \"aoColumns\": [\n                    {\n                        \"mData\": \"selector\",\n                        \"bSortable\": false\n                    },\n                    {\n                        \"mData\": \"clientID\",\n                        \"sTitle\": $.t(\"templates.oauth.clientID\")\n                    },\n                    {\n                        \"mData\": \"id\",\n                        \"sTitle\": $.t(\"templates.oauth.tokenID\")\n                    },\n                    {\n                        \"mData\": \"cleanScope\",\n                        \"sTitle\": $.t(\"templates.oauth.scope\")\n                    },\n                    {\n                        \"mData\": \"cleanDate\",\n                        \"sTitle\": $.t(\"templates.oauth.expireDate\")\n                    },\n                    {\n                        \"mData\": \"tokenName\",\n                        \"sTitle\": $.t(\"templates.oauth.tokenType\")\n                    }\n                ],\n                \"oLanguage\": {\n                    \"sUrl\": require.toUrl(`locales/${i18nManager.language}/translation.json`)\n                },\n                \"sDom\": 'l<\"deleteSelected\">f<\"clear\">rt<\"clear\">ip<\"clear\">',\n                \"sPaginationType\": \"full_numbers\",\n                \"fnInitComplete\": () => {\n                    $(\".deleteSelected\").html(`<input type=\"submit\" class=\"button orange floatRight\" value=\"${\n                        $.t(\"common.form.deleteSelected\")\n                    }\" >`);\n                },\n                \"fnRowCallback\": (row, data) => {\n                    $(row).children().not(\":first\").click(function () {\n                        var id = data.id[0], htmlCode, table, temp = row, td;\n                        tokensService.getTokenByID(function (tokenInfo) {\n                            var output;\n\n                            output = '<table width=\"100%\" cellpadding=\"5\" cellspacing=\"0\" border=\"0\" ' +\n                                'style=\"padding:25px;\">';\n                            if (tokenInfo.realm) {\n                                output += `<tr><td>${$.t(\"templates.oauth.realm\")}</td><td>${\n                                    tokenInfo.realm\n                                }</td></tr>`;\n                            }\n                            if (tokenInfo.refreshToken) {\n                                output += `<tr><td>${$.t(\"templates.oauth.refreshToken\")}</td><td>${\n                                    tokenInfo.refreshToken\n                                }</td></tr>`;\n                            }\n                            if (tokenInfo.redirectURI) {\n                                output += `<tr><td>${$.t(\"templates.oauth.redirectURI\")}</td><td>${\n                                    tokenInfo.redirectURI\n                                }</td></tr>`;\n                            }\n                            if (tokenInfo.userName) {\n                                output += `<tr><td>${$.t(\"templates.oauth.username\")}</td><td>${\n                                    tokenInfo.userName\n                                }</td></tr>`;\n                            }\n                            if (tokenInfo.parent) {\n                                output += `<tr><td>${$.t(\"templates.oauth.parent\")}</td><td>${\n                                    tokenInfo.parent\n                                }</td></tr>`;\n                            }\n                            output += \"</table>\";\n\n                            td = $(temp).next().children(0);\n                            if (td.attr(\"class\") === \"details\") {\n                                td.html(output);\n                            }\n                        }, null, id);\n\n                        table = $(\"#tokensTable\").dataTable();\n\n                        if (table.fnIsOpen(row)) {\n                            table.fnClose(row);\n                        } else {\n                            table.fnOpen(row, htmlCode, \"details\");\n                        }\n                    });\n                    return row;\n                }\n            });\n        },\n\n        formSubmit (event) {\n            event.preventDefault();\n            event.stopPropagation();\n\n            $(\"input:checked\", $(\"#tokensTable\").dataTable().fnGetNodes()).each(function () {\n                var id, td;\n                td = $(this);\n                id = td.attr(\"id\");\n                tokensService.deleteToken(\n                    function () {\n                        location.reload(true);\n                    },\n                    function () {\n\n                    },\n                    id);\n            });\n        }\n    });\n\n    return new TokensView();\n});\n"]}