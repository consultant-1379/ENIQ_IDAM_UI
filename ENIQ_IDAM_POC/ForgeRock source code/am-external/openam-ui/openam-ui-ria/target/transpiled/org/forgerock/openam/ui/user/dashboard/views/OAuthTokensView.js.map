{"version":3,"sources":["../../../../../../../../XUI/org/forgerock/openam/ui/user/dashboard/views/OAuthTokensView.js"],"names":["define","$","_","AbstractView","OAuthTokensService","OAuthToken","extend","template","noBaseTemplate","element","events","render","self","getApplications","then","data","applications","map","result","application","id","_id","name","scopes","values","join","expiryDateTime","Date","toLocaleString","t","parentRender","$el","find","tooltip","deleteToken","event","preventDefault","revokeApplication","currentTarget","console","error"],"mappings":";;AAAA;;;;;;;;;;;;;;;;AAgBAA,OAAO,CACH,QADG,EAEH,QAFG,EAGH,mDAHG,EAIH,oEAJG,CAAP,EAKG,UAAUC,CAAV,EAAaC,CAAb,EAAgBC,YAAhB,EAA8BC,kBAA9B,EAAkD;AACjD,QAAIC,aAAaF,aAAaG,MAAb,CAAoB;AACjCC,kBAAU,8CADuB;AAEjCC,wBAAgB,IAFiB;AAGjCC,iBAAS,uBAHwB;AAIjCC,gBAAQ;AACJ,mCAAuB;AADnB,SAJyB;;AAQjCC,cARiC,oBAQvB;AACN,gBAAIC,OAAO,IAAX;;AAEAR,+BAAmBS,eAAnB,GAAqCC,IAArC,CAA0C,UAAUC,IAAV,EAAgB;AACtDH,qBAAKG,IAAL,CAAUC,YAAV,GAAyBd,EAAEe,GAAF,CAAMF,KAAKG,MAAX,EAAmB,UAAUC,WAAV,EAAuB;AAC/D,2BAAO;AACHC,4BAAID,YAAYE,GADb;AAEHC,8BAAMH,YAAYG,IAFf;AAGHC,gCAAQrB,EAAEsB,MAAF,CAASL,YAAYI,MAArB,EAA6BE,IAA7B,CAAkC,IAAlC,CAHL;AAIHC,wCAAgBP,YAAYO,cAAZ,GACV,IAAIC,IAAJ,CAASR,YAAYO,cAArB,EAAqCE,cAArC,EADU,GAEV3B,EAAE4B,CAAF,CAAI,mCAAJ;AANH,qBAAP;AAQH,iBATwB,CAAzB;AAUAjB,qBAAKkB,YAAL,CAAkB,YAAY;AAC1BlB,yBAAKmB,GAAL,CAASC,IAAT,CAAc,2BAAd,EAA2CC,OAA3C;AACH,iBAFD;AAGH,aAdD;AAeH,SA1BgC;AA4BjCC,mBA5BiC,uBA4BpBC,KA5BoB,EA4Bb;AAChBA,kBAAMC,cAAN;AACA,gBAAIxB,OAAO,IAAX;;AAEAR,+BAAmBiC,iBAAnB,CAAqCF,MAAMG,aAAN,CAAoBlB,EAAzD,EAA6DN,IAA7D,CAAkE,YAAY;AAC1EF,qBAAKD,MAAL;AACH,aAFD,EAEG,YAAY;AACX4B,wBAAQC,KAAR,CAAc,8BAAd;AACH,aAJD;AAKH;AArCgC,KAApB,CAAjB;;AAwCA,WAAO,IAAInC,UAAJ,EAAP;AACH,CA/CD","file":"OAuthTokensView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/openam/ui/user/dashboard/services/OAuthTokensService\"\n], function ($, _, AbstractView, OAuthTokensService) {\n    var OAuthToken = AbstractView.extend({\n        template: \"templates/user/dashboard/TokensTemplate.html\",\n        noBaseTemplate: true,\n        element: \"#myOAuthTokensSection\",\n        events: {\n            \"click a.deleteToken\": \"deleteToken\"\n        },\n\n        render () {\n            var self = this;\n\n            OAuthTokensService.getApplications().then(function (data) {\n                self.data.applications = _.map(data.result, function (application) {\n                    return {\n                        id: application._id,\n                        name: application.name,\n                        scopes: _.values(application.scopes).join(\", \"),\n                        expiryDateTime: application.expiryDateTime\n                            ? new Date(application.expiryDateTime).toLocaleString()\n                            : $.t(\"openam.oAuth2.tokens.neverExpires\")\n                    };\n                });\n                self.parentRender(function () {\n                    self.$el.find(\"[data-toggle=\\\"tooltip\\\"]\").tooltip();\n                });\n            });\n        },\n\n        deleteToken (event) {\n            event.preventDefault();\n            var self = this;\n\n            OAuthTokensService.revokeApplication(event.currentTarget.id).then(function () {\n                self.render();\n            }, function () {\n                console.error(\"Failed to revoke application\");\n            });\n        }\n    });\n\n    return new OAuthToken();\n});\n"]}