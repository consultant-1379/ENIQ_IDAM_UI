{"version":3,"sources":["../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authorization/resourceTypes/ResourceTypeActionsView.js"],"names":["define","$","_","AbstractView","EventManager","Constants","UIUtils","extend","element","template","noBaseTemplate","events","render","data","el","callback","self","parentRender","renderActionsTable","fillTemplateWithData","actions","tpl","$el","find","html","updateEntity","length","forEach","name","value","entity","isExistingItem","itemPending","itemFromCollection","addItem","e","actionName","val","type","keyCode","toggleAddButton","pending","duplicateIndex","counter","sendEvent","EVENT_DISPLAY_MESSAGE_REQUEST","each","item","push","focus","deleteItem","$target","target","closest","text","trim","without","toggleRadio","permitted","action","enabled","prop"],"mappings":"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","file":"ResourceTypeActionsView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\"\n], ($, _, AbstractView, EventManager, Constants, UIUtils) =>\n    AbstractView.extend({\n        element: \"#actions\",\n        template: \"templates/admin/views/realms/authorization/resourceTypes/ResourceTypesActionsTemplate.html\",\n        noBaseTemplate: true,\n        events: {\n            \"click [data-toggle-item]\": \"toggleRadio\",\n            \"keyup [data-toggle-item]\": \"toggleRadio\",\n            \"click [data-add-item]\": \"addItem\",\n            \"keyup [data-add-item]\": \"addItem\",\n            \"keyup [data-editing-input]\": \"addItem\",\n            \"click button[data-delete]\": \"deleteItem\",\n            \"keyup button[data-delete]\": \"deleteItem\"\n        },\n        render (data, el, callback) {\n            var self = this;\n            _.extend(this.data, data);\n            this.element = el;\n\n            this.parentRender(function () {\n                self.renderActionsTable(callback);\n            });\n        },\n\n        renderActionsTable (callback) {\n            var self = this;\n            UIUtils.fillTemplateWithData(\n                \"templates/admin/views/realms/authorization/common/ActionsTableTemplate.html\",\n                { \"items\": this.data.actions },\n                function (tpl) {\n                    self.$el.find(\"#createdActions\").html(tpl);\n                    if (callback) {\n                        callback();\n                    }\n                });\n        },\n\n        updateEntity () {\n            var actions = null;\n\n            if (this.data.actions.length) {\n                actions = {};\n                this.data.actions.forEach(function (el) {\n                    actions[el.name] = el.value;\n                });\n            }\n\n            this.data.entity.actions = actions;\n        },\n\n        isExistingItem (itemPending, itemFromCollection) {\n            return itemPending.name === itemFromCollection.name;\n        },\n\n        addItem (e) {\n            const actionName = this.$el.find(\"[data-editing-input]\").val();\n\n            if (e.type === \"keyup\" && e.keyCode !== 13) {\n                this.toggleAddButton(actionName !== \"\");\n                return;\n            }\n\n            const pending = { \"name\": actionName, \"value\": true };\n            let duplicateIndex = -1;\n            let counter = 0;\n\n            if (pending.name === \"\") {\n                EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"invalidItem\");\n                return;\n            }\n\n            _.each(this.data.actions, (item) => {\n                if (this.isExistingItem(pending, item)) {\n                    duplicateIndex = counter;\n                    return;\n                }\n                counter++;\n            });\n\n            if (duplicateIndex >= 0) {\n                EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"duplicateItem\");\n            } else {\n                this.data.actions.push(pending);\n                this.updateEntity();\n                this.renderActionsTable(() => {\n                    this.toggleAddButton(false);\n                    this.$el.find(\"[data-editing-input]\").val(\"\").focus();\n                });\n            }\n        },\n\n        deleteItem (e) {\n            if (e.type === \"keyup\" && e.keyCode !== 13) {\n                return;\n            }\n\n            var $target = $(e.target),\n                actionName = $target.closest(\"tr\").find(\".action-name\").text().trim();\n\n            this.data.actions = _.without(this.data.actions, _.find(this.data.actions, { name: actionName }));\n            this.updateEntity();\n            this.renderActionsTable();\n        },\n\n        toggleRadio (e) {\n            var $target = $(e.target),\n                permitted,\n                actionName;\n\n            permitted = $target.val() || $target.find(\"input\").val();\n            actionName = $target.closest(\"tr\").find(\".action-name\").text().trim();\n\n            if (!actionName) {\n                return;\n            }\n\n            _.find(this.data.actions, function (action) {\n                return action.name === actionName;\n            }).value = permitted === \"true\";\n\n            this.updateEntity();\n        },\n\n        toggleAddButton (enabled) {\n            this.$el.find(\"[data-add-item]\").prop(\"disabled\", !enabled);\n        }\n    })\n);\n"]}