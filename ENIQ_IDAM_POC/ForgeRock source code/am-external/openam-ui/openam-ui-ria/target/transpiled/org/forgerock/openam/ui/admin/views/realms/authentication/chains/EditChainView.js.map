{"version":3,"sources":["../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authentication/chains/EditChainView.js"],"names":["define","$","_","AbstractView","Constants","EventManager","EditLinkView","FormHelper","Handlebars","LinkView","Messages","PostProcessView","Router","AuthenticationService","createLinkView","index","view","linkView","el","element","parent","data","typeDescription","allModules","linkConfig","form","chainData","authChainConfiguration","allCriteria","REQUIRED","t","OPTIONAL","REQUISITE","SUFFICIENT","initSortable","self","$el","find","nestingSortable","exclude","delay","vertical","placeholder","onDrag","item","position","css","left","adjustment","top","onDragStart","container","offset","pointer","rootGroup","originalIndex","addClass","width","onDrop","_super","sortChainData","validateChain","extend","template","events","partials","addItemToList","append","addNewModule","length","editItem","linkview","show","onDeleteClick","e","preventDefault","currentTarget","hasClass","showConfirmationBeforeDeleting","type","bind","deleteChain","authentication","chains","remove","realmPath","_id","then","addMessage","TYPE_INFO","message","routeTo","configuration","routes","realmsAuthenticationChains","args","encodeURIComponent","trigger","response","TYPE_DANGER","render","get","modulesData","headerActions","actionPartial","title","icon","parentRender","adminAuthModule","orgConfig","popoverOpt","placement","content","popover","each","saveSettings","loginSuccessUrl","val","loginFailureUrl","addClassNameDialog","savedData","loginPostProcessClass","update","sendEvent","EVENT_DISPLAY_MESSAGE_REQUEST","saveChain","from","to","addItem","splice","invalid","alert","firstRequiredIndex","sufficentIndex","config","removeClass","findIndex","criteria","drop","compile","html","prop"],"mappings":"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","file":"EditChainView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/openam/ui/admin/views/realms/authentication/chains/EditLinkView\",\n    \"org/forgerock/openam/ui/admin/utils/FormHelper\",\n    \"handlebars\",\n    \"org/forgerock/openam/ui/admin/views/realms/authentication/chains/LinkView\",\n    \"org/forgerock/commons/ui/common/components/Messages\",\n    \"org/forgerock/openam/ui/admin/views/realms/authentication/chains/PostProcessView\",\n    \"org/forgerock/commons/ui/common/main/Router\",\n    \"org/forgerock/openam/ui/admin/services/realm/AuthenticationService\",\n    // jquery dependencies\n    \"sortable\"\n], function ($, _, AbstractView, Constants, EventManager, EditLinkView, FormHelper, Handlebars, LinkView, Messages,\n             PostProcessView, Router, AuthenticationService) {\n    var createLinkView = function (index, view) {\n            var linkView = new LinkView();\n\n            /**\n              * A new list item is being dynamically created and added to the current EditChainView as a child View.\n              * In order to do this we must create the element here, parent and pass it to the child so that it has\n              * something to render inside of.\n              */\n            linkView.el = $(\"<li class='chain-link' />\");\n            linkView.element = linkView.el;\n            linkView.parent = view;\n\n            linkView.data = {\n                // Each linkview instance requires allCriteria and allModules to render. These values are never changed\n                // Because multiple instances require this same data, I grab it only in this parent view, then pass it\n                // on to to all the child linkview instances.\n                typeDescription : \"\",\n                allModules : view.data.allModules,\n                linkConfig : view.data.form.chainData.authChainConfiguration[index],\n                allCriteria : {\n                    REQUIRED : $.t(\"console.authentication.editChains.criteria.0.title\"),\n                    OPTIONAL : $.t(\"console.authentication.editChains.criteria.1.title\"),\n                    REQUISITE : $.t(\"console.authentication.editChains.criteria.2.title\"),\n                    SUFFICIENT : $.t(\"console.authentication.editChains.criteria.3.title\")\n                }\n            };\n\n            return linkView;\n        },\n\n        initSortable = function (self) {\n            self.$el.find(\"ol#sortableAuthChain\").nestingSortable({\n                exclude: \"li:not(.chain-link)\",\n                delay: 100,\n                vertical: true,\n                placeholder: \"<li class='placeholder'><div class='placeholder-inner'></div></i>\",\n\n                onDrag (item, position) {\n                    item.css({\n                        left: position.left - self.adjustment.left,\n                        top: position.top - self.adjustment.top\n                    });\n                },\n\n                onDragStart (item, container) {\n                    var offset = item.offset(),\n                        pointer = container.rootGroup.pointer;\n\n                    self.adjustment = {\n                        left: pointer.left - offset.left + 5,\n                        top: pointer.top - offset.top\n                    };\n                    self.originalIndex = item.index();\n                    item.addClass(\"dragged\");\n                    item.width(item.width());\n                    $(\"body\").addClass(\"dragging\");\n                },\n\n                onDrop (item, container, _super) {\n                    self.sortChainData(self.originalIndex, item.index());\n                    self.validateChain();\n                    _super(item, container);\n                }\n            });\n        };\n\n    return AbstractView.extend({\n        template: \"templates/admin/views/realms/authentication/chains/EditChainTemplate.html\",\n        events: {\n            \"click [data-save-chain]\"    : \"saveChain\",\n            \"click [data-save-settings]\" : \"saveSettings\",\n            \"click [data-add-new-module]\": \"addNewModule\",\n            \"click [data-delete]\"        : \"onDeleteClick\"\n        },\n        partials: [\n            \"partials/alerts/_Alert.html\"\n        ],\n\n        addItemToList (element) {\n            this.$el.find(\"ol#sortableAuthChain\").append(element);\n        },\n\n        addNewModule () {\n            var index = this.data.form.chainData.authChainConfiguration.length,\n                linkView = createLinkView(index, this);\n            this.editItem(linkView);\n        },\n\n        editItem (linkview) {\n            EditLinkView.show(linkview);\n        },\n\n        onDeleteClick (e) {\n            e.preventDefault();\n            if ($(e.currentTarget).hasClass(\"disabled\")) { return false; }\n\n            FormHelper.showConfirmationBeforeDeleting({ type: $.t(\"console.authentication.modules.chain\") },\n                _.bind(this.deleteChain, this));\n        },\n\n        deleteChain () {\n            var self = this;\n\n            AuthenticationService.authentication.chains.remove(\n                self.data.realmPath,\n                self.data.form.chainData._id)\n                .then(() => {\n                    Messages.addMessage({\n                        type: Messages.TYPE_INFO,\n                        message: $.t(\"console.authentication.editChains.deletedChain\")\n                    });\n                    Router.routeTo(Router.configuration.routes.realmsAuthenticationChains, {\n                        args: [encodeURIComponent(self.data.realmPath)],\n                        trigger: true\n                    });\n                }, (response) => {\n                    Messages.addMessage({\n                        type: Messages.TYPE_DANGER,\n                        response\n                    });\n                });\n        },\n\n        render (args) {\n            var self = this;\n\n            AuthenticationService.authentication.chains.get(args[0], args[1]).then((data) => {\n                self.data = {\n                    realmPath : args[0],\n                    allModules : data.modulesData,\n                    form : { chainData: data.chainData },\n                    headerActions: [\n                        { actionPartial: \"form/_Button\", data:\"delete\", title:\"common.form.delete\", icon:\"fa-times\" }\n                    ]\n                };\n\n                self.parentRender(function () {\n                    if (self.data.form.chainData.adminAuthModule || self.data.form.chainData.orgConfig) {\n                        var popoverOpt = {\n                            trigger : \"hover\",\n                            container : \"body\",\n                            placement : \"top\"\n                        };\n\n                        if (self.data.form.chainData.adminAuthModule && self.data.form.chainData.orgConfig) {\n                            popoverOpt.content =\n                                $.t(\"console.authentication.editChains.deleteBtnTooltip.defaultAdminOrgAuthChain\");\n                        } else if (self.data.form.chainData.adminAuthModule) {\n                            popoverOpt.content =\n                                $.t(\"console.authentication.editChains.deleteBtnTooltip.defaultAdminAuthChain\");\n                        } else {\n                            popoverOpt.content =\n                                $.t(\"console.authentication.editChains.deleteBtnTooltip.defaultOrgAuthChain\");\n                        }\n                        // popover doesn't work in case button has disabled attribute\n                        self.$el.find(\"[data-delete]\").addClass(\"disabled\").popover(popoverOpt);\n                    }\n\n                    if (self.data.form.chainData.authChainConfiguration.length > 0) {\n                        _.each(self.data.form.chainData.authChainConfiguration, function (linkConfig, index) {\n                            var linkView = createLinkView(index, self);\n                            self.addItemToList(linkView.element);\n                            linkView.render();\n                        });\n                    } else {\n                        self.validateChain();\n                    }\n\n                    initSortable(self);\n                    PostProcessView.render(self.data.form.chainData);\n                });\n            }, (response) => {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response\n                });\n            });\n        },\n\n        saveSettings () {\n            var self = this,\n                chainData = this.data.form.chainData;\n\n            chainData.loginSuccessUrl[0] = this.$el.find(\"#loginSuccessUrl\").val();\n            chainData.loginFailureUrl[0] = this.$el.find(\"#loginFailureUrl\").val();\n\n            PostProcessView.addClassNameDialog().then(() => {\n                var savedData = {\n                    loginFailureUrl: chainData.loginFailureUrl,\n                    loginPostProcessClass: chainData.loginPostProcessClass,\n                    loginSuccessUrl: chainData.loginSuccessUrl\n                };\n\n                AuthenticationService.authentication.chains.update(self.data.realmPath, chainData._id, savedData)\n                    .then(() => {\n                        EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"changesSaved\");\n                    }, (response) => {\n                        Messages.addMessage({\n                            type: Messages.TYPE_DANGER,\n                            response\n                        });\n                    });\n            });\n        },\n\n        saveChain () {\n            var chainData = this.data.form.chainData,\n                savedData = {\n                    authChainConfiguration: chainData.authChainConfiguration\n                };\n\n            AuthenticationService.authentication.chains.update(this.data.realmPath, chainData._id, savedData)\n                .then(() => {\n                    EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"changesSaved\");\n                }, (response) => {\n                    Messages.addMessage({\n                        type: Messages.TYPE_DANGER,\n                        response\n                    });\n                });\n        },\n\n        sortChainData (from, to) {\n            var addItem = this.data.form.chainData.authChainConfiguration.splice(from, 1)[0];\n            this.data.form.chainData.authChainConfiguration.splice(to, 0, addItem);\n        },\n\n        validateChain () {\n            var invalid = false,\n                alert = \"\",\n                firstRequiredIndex,\n                sufficentIndex,\n                config = this.data.form.chainData.authChainConfiguration;\n\n            if (config.length === 0) {\n                invalid = true;\n                this.$el.find(\"#sortableAuthChain\").addClass(\"hidden\");\n                this.$el.find(\"#lowerAuthChainsLegend\").addClass(\"hidden\");\n                this.$el.find(\".btn-toolbar\").addClass(\"hidden\");\n                this.$el.find(\".call-to-action-block\").removeClass(\"hidden\");\n            } else {\n                this.$el.find(\".call-to-action-block\").addClass(\"hidden\");\n                firstRequiredIndex = _.findIndex(config, { criteria: \"REQUIRED\" });\n                sufficentIndex = _.findIndex(_.drop(config, firstRequiredIndex), { criteria: \"SUFFICIENT\" });\n\n                if (firstRequiredIndex > -1 && sufficentIndex > -1 &&\n                    firstRequiredIndex < sufficentIndex &&\n                    config.length - 1 > sufficentIndex) {\n                    alert = Handlebars.compile(\"{{> alerts/_Alert type='warning' \" +\n                        \"text='console.authentication.editChains.alerts.reqdFailSuffPass'}}\");\n                }\n\n                this.$el.find(\"#sortableAuthChain\").removeClass(\"hidden\");\n                this.$el.find(\"#lowerAuthChainsLegend\").removeClass(\"hidden\");\n                this.$el.find(\".btn-toolbar\").removeClass(\"hidden\");\n            }\n\n            this.$el.find(\"#alertContainer\").html(alert);\n            this.$el.find(\"[data-save-chain]\").prop(\"disabled\", invalid);\n        }\n    });\n});\n"]}