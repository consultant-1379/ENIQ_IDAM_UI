{"version":3,"sources":["../../../../../../../../../XUI/org/forgerock/openam/ui/user/uma/views/resource/LabelTreeNavigationView.js"],"names":["define","_","$","Router","TreeNavigation","UMAService","LabelTreeNavigationView","extend","template","partials","findActiveNavItem","fragment","myLabelsRoute","configuration","routes","umaResourcesMyLabelsResource","isCurrentRouteForResource","currentRoute","subFragment","initial","split","join","anchor","$el","find","parentOls","length","removeClass","parentsUntil","addClass","parent","children","attr","navigateToPage","event","currentTarget","nextRenderPage","render","args","callback","self","userLabels","sortedUserLabels","labels","all","done","data","any","result","label","name","toLowerCase","create","filter","type","sortBy","starred","system","user","nestedLabels","each","addToParent","prototype","call","collection","indexOf","title","viewId","uniqueId","push","shift","parentName","addUserLabels"],"mappings":"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","file":"LabelTreeNavigationView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"lodash\",\n    \"jquery\",\n    \"org/forgerock/commons/ui/common/main/Router\",\n    \"org/forgerock/openam/ui/common/components/TreeNavigation\",\n    \"org/forgerock/openam/ui/user/uma/services/UMAService\"\n], function (_, $, Router, TreeNavigation, UMAService) {\n    var LabelTreeNavigationView = TreeNavigation.extend({\n        template: \"templates/user/uma/views/resource/LabelTreeNavigationTemplate.html\",\n        partials: [\"templates/user/uma/views/resource/_NestedList.html\"],\n        findActiveNavItem (fragment) {\n            var myLabelsRoute = Router.configuration.routes.umaResourcesMyLabelsResource,\n                isCurrentRouteForResource = Router.currentRoute === myLabelsRoute,\n                subFragment = isCurrentRouteForResource ? _.initial(fragment.split(\"/\")).join(\"/\") : fragment,\n                anchor = this.$el.find(`.sidenav ol > li > a[href='#${subFragment}']`),\n                parentOls;\n\n            if (anchor.length) {\n                this.$el.find(\".sidenav ol\").removeClass(\"in\");\n\n                parentOls = anchor.parentsUntil(this.$el.find(\".sidenav\"), \"ol.collapse\");\n                parentOls.addClass(\"in\").parent().children(\"span[data-toggle]\").attr(\"aria-expanded\", \"true\");\n                anchor.parent().addClass(\"active\");\n\n                if (anchor.attr(\"aria-expanded\") === \"false\") {\n                    anchor.attr(\"aria-expanded\", \"true\");\n                }\n            }\n        },\n        navigateToPage (event) {\n            this.$el.find(\".sidenav li\").removeClass(\"active\");\n            $(event.currentTarget).addClass(\"active\");\n            this.nextRenderPage = true;\n        },\n        render (args, callback) {\n            var self = this,\n                userLabels,\n                sortedUserLabels;\n\n            this.args = args;\n            this.callback = callback;\n\n            UMAService.labels.all().done(function (data) {\n                if (!_.any(data.result, function (label) {\n                    return label.name.toLowerCase() === \"starred\";\n                })) {\n                    UMAService.labels.create(\"starred\", \"STAR\");\n                }\n\n                userLabels = _.filter(data.result, function (label) { return label.type.toLowerCase() === \"user\"; });\n                sortedUserLabels = _.sortBy(userLabels, function (label) { return label.name; });\n\n                self.data.labels = {\n                    starred: _.filter(data.result, function (label) { return label.type.toLowerCase() === \"starred\"; }),\n                    system: _.filter(data.result, function (label) { return label.type.toLowerCase() === \"system\"; }),\n                    user: sortedUserLabels\n                };\n                self.data.nestedLabels = [];\n\n                _.each(self.data.labels.user, function (label) {\n                    self.addToParent(self.data.nestedLabels, label);\n                });\n\n                TreeNavigation.prototype.render.call(self, args, callback);\n            });\n        },\n\n        addToParent (collection, label) {\n            if (label.name.indexOf(\"/\") === -1) {\n                label.title = label.name;\n                label.children = [];\n                label.viewId = _.uniqueId(\"viewId_\");\n                collection.push(label);\n            } else {\n                var shift = label.name.split(\"/\"),\n                    parentName = shift.shift(),\n                    parent;\n                label.name = shift.join(\"/\");\n                parent = _.find(collection, { title: parentName });\n                if (!parent) {\n                    parent = { title: parentName, children: [], viewId: _.uniqueId(\"viewId_\") };\n                    collection.push(parent);\n                }\n                this.addToParent(parent.children, label);\n            }\n        },\n\n        addUserLabels (userLabels) {\n            var self = this;\n\n            this.data.nestedLabels = [];\n            this.data.labels.user = _.sortBy(userLabels, function (label) { return label.name; });\n\n            _.each(this.data.labels.user, function (label) {\n                self.addToParent(self.data.nestedLabels, label);\n            });\n\n            this.nextRenderPage = true;\n            TreeNavigation.prototype.render.call(this, this.args, this.callback);\n        }\n    });\n\n    return new LabelTreeNavigationView();\n});\n"]}