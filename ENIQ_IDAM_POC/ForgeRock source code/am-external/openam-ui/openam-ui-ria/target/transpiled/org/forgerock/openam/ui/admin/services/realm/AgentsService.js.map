{"version":3,"sources":["../../../../../../../../XUI/org/forgerock/openam/ui/admin/services/realm/AgentsService.jsm"],"names":["getCreatableTypes","create","update","get","getSchema","getAll","getInitialState","remove","obj","host","context","realm","serviceCall","url","type","headers","then","data","result","id","encodeURIComponent","JSON","stringify","suppressSpinner","errorsHandlers","status","getTemplate","all","response","schema","values","ids","promises"],"mappings":"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","file":"AgentsService.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2016-2017 ForgeRock AS.\n */\n\n/**\n * @module org/forgerock/openam/ui/admin/services/realm/AgentsService\n */\nimport { map, omit } from \"lodash\";\n\nimport AbstractDelegate from \"org/forgerock/commons/ui/common/main/AbstractDelegate\";\nimport Constants from \"org/forgerock/commons/ui/common/util/Constants\";\nimport fetchUrl from \"org/forgerock/openam/ui/common/services/fetchUrl\";\nimport Promise from \"org/forgerock/openam/ui/common/util/Promise\";\n\nconst obj = new AbstractDelegate(`${Constants.host}${Constants.context}/json`);\n\nexport function getCreatableTypes (realm) {\n    return obj.serviceCall({\n        url: fetchUrl(\"/realm-config/agents?_action=getCreatableTypes\", { realm }),\n        type: \"POST\",\n        headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" }\n    }).then((data) => data.result);\n}\n\nexport function create (realm, type, data, id) {\n    return obj.serviceCall({\n        url: fetchUrl(`/realm-config/agents/${type}/${encodeURIComponent(id)}`, { realm }),\n        type: \"PUT\",\n        headers: {\n            \"Accept-API-Version\": \"protocol=2.0,resource=1.0\",\n            \"If-None-Match\": \"*\"\n        },\n        data: JSON.stringify(data),\n        suppressSpinner: true,\n        errorsHandlers: { \"incorrectRevisionError\": { status: 412 } }\n    });\n}\n\nexport function update (realm, type, data, id) {\n    return obj.serviceCall({\n        url: fetchUrl(`/realm-config/agents/${type}/${encodeURIComponent(id)}`, { realm }),\n        type: \"PUT\",\n        headers: { \"Accept-API-Version\": \"protocol=2.0,resource=1.0\" },\n        // CREST Protocol 2.0 payload must not transmit _rev\n        data: JSON.stringify(omit(data, \"_rev\"))\n    });\n}\n\nexport function get (realm, type, id) {\n    return obj.serviceCall({\n        url: fetchUrl(`/realm-config/agents/${type}/${encodeURIComponent(id)}`, { realm }),\n        headers: { \"Accept-API-Version\": \"protocol=2.0,resource=1.0\" },\n        suppressSpinner: true\n    });\n}\n\nexport function getSchema (realm, type) {\n    return obj.serviceCall({\n        url: fetchUrl(`/realm-config/agents/${type}?_action=schema`, { realm }),\n        headers: { \"Accept-API-Version\": \"protocol=2.0,resource=1.0\" },\n        type: \"POST\"\n    });\n}\n\nexport function getAll (realm, type) {\n    return obj.serviceCall({\n        url: fetchUrl(`/realm-config/agents/${type}?_queryFilter=true`, { realm }),\n        headers: { \"Accept-API-Version\": \"protocol=2.0,resource=1.0\" },\n        suppressSpinner: true\n    });\n}\n\nexport function getInitialState (realm, type) {\n    function getTemplate () {\n        return obj.serviceCall({\n            url: fetchUrl(`/realm-config/agents/${type}?_action=template`, { realm }),\n            headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" },\n            type: \"POST\"\n        });\n    }\n\n    return Promise.all([getSchema(realm, type), getTemplate()]).then((response) => ({\n        schema: response[0],\n        values: response[1]\n    }));\n}\n\nexport function remove (realm, type, ids) {\n    const promises = map(ids, (id) => obj.serviceCall({\n        url: fetchUrl(`/realm-config/agents/${type}/${encodeURIComponent(id)}`, { realm }),\n        headers: { \"Accept-API-Version\": \"protocol=2.0,resource=1.0\" },\n        type: \"DELETE\"\n    }));\n\n    return Promise.all(promises);\n}\n"]}