{"version":3,"sources":["../../../../../../../XUI/org/forgerock/commons/ui/common/main/Router.js"],"names":["define","_","Backbone","EventManager","constants","conf","AbstractConfigurationAware","URIUtils","obj","currentRoute","getUrl","getCurrentUrl","getCurrentUrlBasePart","getCurrentOrigin","getURIFragmentQueryString","getCurrentFragmentQueryString","getURIQueryString","getCurrentQueryString","getCurrentHash","indexOf","substring","getURIFragment","getCurrentFragment","getCurrentUrlQueryParameters","hash","queries","getCompositeQueryString","getCurrentCompositeQueryString","getCurrentPathName","setUrl","url","window","location","href","normalizeSubPath","subPath","replace","convertCurrentUrlToJSON","result","pathName","params","convertQueryParametersToJSON","parseQueryString","getParamByName","getCurrentQueryParam","extractParameters","route","isRegExp","exec","slice","applyDefaultParameters","originalParameters","populatedParameters","clone","maxArgLength","i","isObject","defaults","isArray","length","isString","isUndefined","checkRole","role","loggedUser","sendEvent","EVENT_UNAUTHENTICATED","fromRouter","find","split","uiroles","EVENT_UNAUTHORIZED","excludedRole","init","Router","extend","initialize","routes","each","key","partial","routeCallback","view","args","event","dialog","baseView","configuration","base","EVENT_SHOW_DIALOG","EVENT_CHANGE_VIEW","router","history","start","routeTo","link","getLink","navigate","rawParameters","pattern","map","match","part","join"],"mappings":"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","file":"Router.js","sourcesContent":["/**\r\n * The contents of this file are subject to the terms of the Common Development and\r\n * Distribution License (the License). You may not use this file except in compliance with the\r\n * License.\r\n *\r\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\r\n * specific language governing permission and limitations under the License.\r\n *\r\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\r\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\r\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\r\n * information: \"Portions copyright [year] [name of copyright owner]\".\r\n *\r\n * Copyright 2011-2016 ForgeRock AS.\r\n */\r\n/* eslint-disable */\r\n define([\r\n    \"underscore\",\r\n    \"backbone\",\r\n    \"org/forgerock/commons/ui/common/main/EventManager\",\r\n    \"org/forgerock/commons/ui/common/util/Constants\",\r\n    \"org/forgerock/commons/ui/common/main/Configuration\",\r\n    \"org/forgerock/commons/ui/common/main/AbstractConfigurationAware\",\r\n    \"org/forgerock/commons/ui/common/util/URIUtils\"\r\n], function(_, Backbone, EventManager, constants, conf, AbstractConfigurationAware, URIUtils) {\r\n    /**\r\n     * @exports org/forgerock/commons/ui/common/main/Router\r\n     */\r\n\r\n    var obj = new AbstractConfigurationAware();\r\n\r\n    obj.currentRoute = {};\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentUrl}\r\n     */\r\n    obj.getUrl = URIUtils.getCurrentUrl;\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentOrigin}\r\n     */\r\n    obj.getCurrentUrlBasePart = URIUtils.getCurrentOrigin;\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentFragmentQueryString}\r\n     */\r\n    obj.getURIFragmentQueryString = URIUtils.getCurrentFragmentQueryString;\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentQueryString}\r\n     */\r\n    obj.getURIQueryString = URIUtils.getCurrentQueryString;\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentFragment}\r\n     */\r\n    obj.getCurrentHash = function() {\r\n        if (obj.getUrl().indexOf('#') === -1) {\r\n            return \"\";\r\n        } else {\r\n            // cannot use window.location.hash due to FF which de-encodes this parameter.\r\n            return obj.getUrl().substring(obj.getUrl().indexOf('#') + 1);\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentFragment}\r\n     */\r\n    obj.getURIFragment = URIUtils.getCurrentFragment;\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentCompositeQueryString}\r\n     */\r\n    obj.getCurrentUrlQueryParameters = function() {\r\n        var hash = obj.getCurrentHash(),\r\n            queries = obj.getURIQueryString();\r\n            // location.search will only return a value if there are queries before the hash.\r\n        if (hash && hash.indexOf('&') > -1) {\r\n            queries = hash.substring(hash.indexOf('&') + 1);\r\n        }\r\n        return queries;\r\n    };\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentCompositeQueryString}\r\n     */\r\n    obj.getCompositeQueryString = URIUtils.getCurrentCompositeQueryString;\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentPathName}\r\n     */\r\n    obj.getCurrentPathName = URIUtils.getCurrentPathName;\r\n\r\n    obj.setUrl = function(url) {\r\n        window.location.href = url;\r\n    };\r\n\r\n    obj.normalizeSubPath = function(subPath) {\r\n        return subPath.replace(/\\/$/, '');\r\n    };\r\n\r\n    obj.convertCurrentUrlToJSON = function() {\r\n        var result = {};\r\n\r\n        result.url = obj.getCurrentUrlBasePart();\r\n        result.pathName = obj.normalizeSubPath(obj.getCurrentPathName());\r\n\r\n        result.params = obj.convertQueryParametersToJSON(obj.getCurrentUrlQueryParameters());\r\n        return result;\r\n    };\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.parseQueryString}\r\n     */\r\n    obj.convertQueryParametersToJSON = URIUtils.parseQueryString;\r\n\r\n    /**\r\n     * @deprecated\r\n     * @see Use {@link module:org/forgerock/commons/ui/common/util/URIUtils.getCurrentQueryParam}\r\n     */\r\n    obj.getParamByName = URIUtils.getCurrentQueryParam;\r\n\r\n    // returns undecoded route parameters for the provided hash\r\n    obj.extractParameters = function (route, hash) {\r\n        if (_.isRegExp(route.url)) {\r\n            return route.url.exec(hash).slice(1);\r\n        } else {\r\n            return null;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Given a route and a set of current parameters, will return a new parameter\r\n     * list with whichever missing default values were available.\r\n     */\r\n    obj.applyDefaultParameters = function (route, originalParameters) {\r\n        var populatedParameters = _.clone(originalParameters),\r\n            maxArgLength,i;\r\n\r\n        if (_.isObject(route.defaults)) {\r\n            if (_.isArray(originalParameters) && originalParameters.length) {\r\n                maxArgLength = (originalParameters.length >= route.defaults.length)\r\n                    ? originalParameters.length : route.defaults.length;\r\n                for (i=0;i<maxArgLength;i++) {\r\n                    if (!_.isString(originalParameters[i]) && !_.isUndefined(route.defaults[i])) {\r\n                        populatedParameters[i] = _.clone(route.defaults[i]);\r\n                    }\r\n                }\r\n            } else {\r\n                populatedParameters = _.clone(route.defaults);\r\n            }\r\n        }\r\n        return populatedParameters;\r\n    };\r\n\r\n    obj.checkRole = function (route) {\r\n        if(route.role) {\r\n            if (!conf.loggedUser) {\r\n                EventManager.sendEvent(constants.EVENT_UNAUTHENTICATED, { fromRouter: true });\r\n                return false;\r\n            } else if(!_.find(route.role.split(','), function(role) {\r\n                return conf.loggedUser.uiroles.indexOf(role) !== -1;\r\n            })) {\r\n                EventManager.sendEvent(constants.EVENT_UNAUTHORIZED, { fromRouter: true });\r\n                return false;\r\n            }\r\n        }\r\n\r\n        if (route.excludedRole) {\r\n            if(conf.loggedUser && conf.loggedUser.uiroles.indexOf(route.excludedRole) !== -1) {\r\n                EventManager.sendEvent(constants.EVENT_UNAUTHORIZED, { fromRouter: true });\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    };\r\n\r\n    obj.init = function() {\r\n        var Router = Backbone.Router.extend({\r\n            initialize: function(routes) {\r\n                _.each(routes, function(route, key) {\r\n                    this.route(route.url, key, _.partial(this.routeCallback, route));\r\n                }, this);\r\n            },\r\n            routeCallback : function(route) {\r\n                if (!obj.checkRole(route)) {\r\n                    if (!conf.loggedUser) {\r\n                        return;\r\n                    }\r\n                    route = {\r\n                        view: \"org/forgerock/commons/ui/common/UnauthorizedView\",\r\n                        url: \"\"\r\n                    };\r\n                }\r\n\r\n                /**\r\n                 * we don't actually use any of the backbone-provided arguments to this function,\r\n                 * as they are decoded and that results in the loss of important context.\r\n                 * instead we parse the parameters out of the hash ourselves:\r\n                 */\r\n                var args = obj.applyDefaultParameters(route, obj.extractParameters(route, obj.getURIFragment()));\r\n\r\n                obj.currentRoute = route;\r\n\r\n                if(route.event) {\r\n                    EventManager.sendEvent(route.event, {route: route, args: args});\r\n                } else if(route.dialog) {\r\n                    route.baseView = obj.configuration.routes[route.base];\r\n\r\n                    EventManager.sendEvent(constants.EVENT_SHOW_DIALOG, {route: route, args: args, base: route.base});\r\n                } else if(route.view) {\r\n                    EventManager.sendEvent(constants.EVENT_CHANGE_VIEW, {route: route, args: args, fromRouter: true});\r\n                }\r\n            }\r\n        });\r\n\r\n        obj.router = new Router(obj.configuration.routes);\r\n        Backbone.history.start();\r\n    };\r\n\r\n    obj.routeTo = function(route, params) {\r\n        var link;\r\n\r\n        if (params && params.args) {\r\n            link = obj.getLink(route, params.args);\r\n        } else if (_.isArray(route.defaults) && route.defaults.length) {\r\n            link = obj.getLink(route, route.defaults);\r\n        } else {\r\n            link = route.url;\r\n        }\r\n\r\n        params.replace = false;\r\n        obj.currentRoute = route;\r\n        obj.router.navigate(link, params);\r\n    };\r\n\r\n    obj.navigate = function(link, params) {\r\n        obj.router.navigate(link, params);\r\n    };\r\n\r\n    obj.getLink = function(route, rawParameters) {\r\n        var pattern,\r\n            args = obj.applyDefaultParameters(route, rawParameters),\r\n            i = 0;\r\n\r\n        if (!_.isRegExp(route.url)) {\r\n            pattern = route.url.replace(/:[A-Za-z@.]+/, \"?\");\r\n        } else {\r\n            pattern = route.pattern;\r\n        }\r\n\r\n        if (args) {\r\n            // Breaks the pattern up into groups, based on ? placeholders\r\n            // Each ? found will be replaced by the corresponding argument\r\n            // The final result will recompose the groups into a single string value\r\n            pattern = _.map(pattern.match(/([^\\?]+|\\?)/g), function (part) {\r\n                if (part === \"?\") {\r\n                    return (typeof args[i] === \"string\") ? args[i++] : \"\";\r\n                } else {\r\n                    return part;\r\n                }\r\n            }).join('');\r\n        }\r\n\r\n        return pattern;\r\n    };\r\n\r\n    return obj;\r\n\r\n});"]}