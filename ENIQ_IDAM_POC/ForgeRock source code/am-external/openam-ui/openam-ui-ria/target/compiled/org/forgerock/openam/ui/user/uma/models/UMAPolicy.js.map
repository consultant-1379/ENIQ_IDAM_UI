{"version":3,"sources":["../../../../../../../../XUI/org/forgerock/openam/ui/user/uma/models/UMAPolicy.js"],"names":["define","_","Backbone","BackboneRelational","Configuration","Constants","fetchUrl","UMAPolicyPermission","RelationalModel","extend","idAttribute","toBeCreated","relations","type","HasMany","key","relatedModel","parse","response","isEmpty","permissions","sync","method","model","options","beforeSend","xhr","setRequestHeader","toLowerCase","headers","get","length","Model","prototype","call","urlRoot","host","context","default","loggedUser"],"mappings":";;AAAA;;;;;;;;;;;;;;;;AAgBAA,OAAO,CACH,QADG,EAEH,UAFG,EAGH,qBAHG,EAIH,oDAJG,EAKH,gDALG,EAMH,kDANG,EAOH,6DAPG,CAAP,EAQG,UAACC,CAAD,EAAIC,QAAJ,EAAcC,kBAAd,EAAkCC,aAAlC,EAAiDC,SAAjD,EAA4DC,QAA5D,EAAsEC,mBAAtE,EAA8F;AAC7F,WAAOL,SAASM,eAAT,CAAyBC,MAAzB,CAAgC;AACnCC,qBAAa,UADsB;AAEnCC,qBAAa,IAFsB;AAGnCC,mBAAW,CAAC;AACRC,kBAAMX,SAASY,OADP;AAERC,iBAAK,aAFG;AAGRC,0BAAcT;AAHN,SAAD,CAHwB;AAQnCU,aARmC,iBAQ5BC,QAR4B,EAQlB;AACb,gBAAI,CAACjB,EAAEkB,OAAF,CAAUD,SAASE,WAAnB,CAAL,EAAsC;AAClC,qBAAKT,WAAL,GAAmB,KAAnB;AACH;;AAED,mBAAOO,QAAP;AACH,SAdkC;AAenCG,YAfmC,gBAe7BC,MAf6B,EAerBC,KAfqB,EAedC,OAfc,EAeL;AAC1BA,sBAAUA,WAAW,EAArB;AACAA,oBAAQC,UAAR,GAAqB,UAAUC,GAAV,EAAe;AAChCA,oBAAIC,gBAAJ,CAAqB,oBAArB,EAA2C,2BAA3C;AACH,aAFD;;AAIA,gBAAIL,OAAOM,WAAP,OAAyB,QAAzB,IAAqCL,MAAMZ,WAAN,KAAsB,IAA/D,EAAqE;AACjEY,sBAAMZ,WAAN,GAAoB,KAApB;AACAa,wBAAQK,OAAR,GAAkB,EAAlB;AACAL,wBAAQK,OAAR,CAAgB,eAAhB,IAAmC,GAAnC;AACH;;AAED,gBAAI,CAACN,MAAMO,GAAN,CAAU,aAAV,EAAyBC,MAA9B,EAAsC;AAClCR,sBAAMZ,WAAN,GAAoB,IAApB;AACH;;AAED,mBAAOT,SAAS8B,KAAT,CAAeC,SAAf,CAAyBZ,IAAzB,CAA8Ba,IAA9B,CAAmC,IAAnC,EAAyCZ,MAAzC,EAAiDC,KAAjD,EAAwDC,OAAxD,CAAP;AACH,SAhCkC;;AAiCnCW,sBAAY9B,UAAU+B,IAAtB,GAA6B/B,UAAUgC,OAAvC,aACI/B,SAASgC,OAAT,aAA2BlC,cAAcmC,UAAd,CAAyBT,GAAzB,CAA6B,UAA7B,CAA3B;AAlC+B,KAAhC,CAAP;AAoCH,CA7CD","file":"UMAPolicy.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"lodash\",\n    \"backbone\",\n    \"backbone-relational\",\n    \"org/forgerock/commons/ui/common/main/Configuration\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/openam/ui/common/services/fetchUrl\",\n    \"org/forgerock/openam/ui/user/uma/models/UMAPolicyPermission\"\n], (_, Backbone, BackboneRelational, Configuration, Constants, fetchUrl, UMAPolicyPermission) => {\n    return Backbone.RelationalModel.extend({\n        idAttribute: \"policyId\",\n        toBeCreated: true,\n        relations: [{\n            type: Backbone.HasMany,\n            key: \"permissions\",\n            relatedModel: UMAPolicyPermission\n        }],\n        parse (response) {\n            if (!_.isEmpty(response.permissions)) {\n                this.toBeCreated = false;\n            }\n\n            return response;\n        },\n        sync (method, model, options) {\n            options = options || {};\n            options.beforeSend = function (xhr) {\n                xhr.setRequestHeader(\"Accept-API-Version\", \"protocol=1.0,resource=1.0\");\n            };\n\n            if (method.toLowerCase() === \"update\" && model.toBeCreated === true) {\n                model.toBeCreated = false;\n                options.headers = {};\n                options.headers[\"If-None-Match\"] = \"*\";\n            }\n\n            if (!model.get(\"permissions\").length) {\n                model.toBeCreated = true;\n            }\n\n            return Backbone.Model.prototype.sync.call(this, method, model, options);\n        },\n        urlRoot: `${Constants.host}${Constants.context}/json${\n            fetchUrl.default(`/users/${Configuration.loggedUser.get(\"username\")}/uma/policies`)}`\n    });\n});\n"]}