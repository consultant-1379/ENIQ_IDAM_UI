{"version":3,"sources":["../../../../../../../../../XUI/org/forgerock/openam/ui/user/uma/views/resource/MyResourcesPage.js"],"names":["define","$","_","BootstrapDialog","BasePage","Configuration","Constants","EventManager","UMAService","MyResourcesPage","extend","template","partials","events","recordsPresent","$el","find","prop","render","args","callback","data","labelId","topLevel","renderResources","renderGrid","createSetCollection","createColumns","labels","get","then","columns","encodeURIComponent","id","splice","labelName","name","createLabelCollection","unshareAllResources","self","buttons","label","t","action","dialog","close","cssClass","enableButtons","getButton","text","forEach","collection","models","model","toBeCreated","sendEvent","EVENT_DISPLAY_MESSAGE_REQUEST","show","type","TYPE_DANGER","title","message","closable"],"mappings":"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","file":"MyResourcesPage.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/components/BootstrapDialog\",\n    \"org/forgerock/openam/ui/user/uma/views/resource/BasePage\",\n    \"org/forgerock/commons/ui/common/main/Configuration\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/openam/ui/user/uma/services/UMAService\"\n], function ($, _, BootstrapDialog, BasePage, Configuration, Constants, EventManager, UMAService) {\n    var MyResourcesPage = BasePage.extend({\n        template: \"templates/user/uma/views/resource/MyResourcesPageTemplate.html\",\n        partials: [\n            \"templates/user/uma/views/resource/_UnshareAllResourcesButton.html\"\n        ],\n        events: {\n            \"click button#unshareAllResources\": \"unshareAllResources\"\n        },\n        recordsPresent () {\n            this.$el.find(\"button#unshareAllResources\").prop(\"disabled\", false);\n        },\n        render (args, callback) {\n            this.data.labelId = args[1];\n            this.data.topLevel = args[1] === \"\";\n            this.renderResources(callback);\n        },\n        renderResources (callback) {\n            if (this.data.topLevel) {\n                this.renderGrid(this.createSetCollection(), this.createColumns(\"myresources/all\"), callback);\n            } else {\n                // Resolve label ID to name\n                UMAService.labels.get(this.data.labelId).then((data) => {\n                    const columns = this.createColumns(`myresources/${encodeURIComponent(data.id)}`);\n                    // Splice out the \"Hosts\" column\n                    columns.splice(1, 1);\n\n                    this.data.labelName = data.name;\n                    this.renderGrid(this.createLabelCollection(this.data.labelId), columns, callback);\n                });\n            }\n        },\n        unshareAllResources () {\n            var self = this,\n                buttons = [{\n                    label: $.t(\"common.form.cancel\"),\n                    action (dialog) {\n                        dialog.close();\n                    }\n                }, {\n                    id: \"ok\",\n                    label: $.t(\"common.form.ok\"),\n                    cssClass: \"btn-primary btn-danger\",\n                    action (dialog) {\n                        dialog.enableButtons(false);\n                        dialog.getButton(\"ok\").text($.t(\"common.form.working\"));\n\n                        UMAService.unshareAllResources().then(() => {\n                            self.renderResources(function () {\n                                _.forEach(self.data.collection.models, (model) => { model.toBeCreated = true; });\n                                EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST,\n                                    \"unshareAllResourcesSuccess\");\n                                dialog.close();\n                            });\n                        }, () => {\n                            EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"unshareAllResourcesFail\");\n                            dialog.enableButtons(true);\n                            dialog.getButton(\"ok\").text($.t(\"common.form.ok\"));\n                        });\n                    }\n                }];\n\n            BootstrapDialog.show({\n                type: BootstrapDialog.TYPE_DANGER,\n                title: $.t(\"uma.resources.myresources.unshareAllResources.dialog.title\"),\n                message: $.t(\"uma.resources.myresources.unshareAllResources.dialog.message\"),\n                closable: false,\n                buttons\n            });\n        }\n    });\n\n    return MyResourcesPage;\n});\n"]}