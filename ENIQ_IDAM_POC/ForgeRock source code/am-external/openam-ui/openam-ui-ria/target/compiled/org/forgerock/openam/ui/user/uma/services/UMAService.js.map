{"version":3,"sources":["../../../../../../../../XUI/org/forgerock/openam/ui/user/uma/services/UMAService.js"],"names":["define","_","AbstractDelegate","Configuration","Constants","fetchUrl","obj","host","context","getUmaConfig","serviceCall","url","default","headers","then","data","globalData","auth","uma","enabled","resharingMode","unshareAllResources","username","encodeURIComponent","loggedUser","get","type","approveRequest","id","permissions","JSON","stringify","scopes","denyRequest","labels","all","create","name","find","result","_id","remove"],"mappings":"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","file":"UMAService.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractDelegate\",\n    \"org/forgerock/commons/ui/common/main/Configuration\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/openam/ui/common/services/fetchUrl\"\n], function (_, AbstractDelegate, Configuration, Constants, fetchUrl) {\n    var obj = new AbstractDelegate(`${Constants.host}${Constants.context}/json`);\n\n    obj.getUmaConfig = function () {\n        return obj.serviceCall({\n            url: fetchUrl.default(\"/serverinfo/uma\"),\n            headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" }\n        }).then(function (data) {\n            Configuration.globalData.auth.uma = Configuration.globalData.auth.uma || {};\n            Configuration.globalData.auth.uma.enabled = data.enabled;\n            Configuration.globalData.auth.uma.resharingMode = data.resharingMode;\n            return data;\n        });\n    };\n\n    obj.unshareAllResources = function () {\n        const username = encodeURIComponent(Configuration.loggedUser.get(\"username\"));\n        return obj.serviceCall({\n            url: fetchUrl.default(`/users/${username}/oauth2/resources/sets?_action=revokeAll`),\n            headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" },\n            type: \"POST\"\n        });\n    };\n\n    obj.approveRequest = function (id, permissions) {\n        return obj.serviceCall({\n            url: fetchUrl.default(`/users/${\n                encodeURIComponent(Configuration.loggedUser.get(\"username\"))\n            }/uma/pendingrequests/${id}?_action=approve`),\n            headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" },\n            type: \"POST\",\n            data: JSON.stringify({\n                scopes: permissions\n            })\n        });\n    };\n\n    obj.denyRequest = function (id) {\n        return obj.serviceCall({\n            url: fetchUrl.default(`/users/${\n                encodeURIComponent(Configuration.loggedUser.get(\"username\"))\n            }/uma/pendingrequests/${id}?_action=deny`),\n            headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" },\n            type: \"POST\"\n        });\n    };\n\n    // FIXME: Mutiple calls to #all end-point throughout this section. Optimize\n    obj.labels = {\n        all () {\n            return obj.serviceCall({\n                url: fetchUrl.default(`/users/${\n                    encodeURIComponent(Configuration.loggedUser.get(\"username\"))\n                }/oauth2/resources/labels?_queryFilter=true`),\n                headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" }\n            });\n        },\n        create (name, type) {\n            return obj.serviceCall({\n                url: fetchUrl.default(`/users/${\n                    encodeURIComponent(Configuration.loggedUser.get(\"username\"))\n                }/oauth2/resources/labels?_action=create`),\n                headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" },\n                type: \"POST\",\n                data: JSON.stringify({\n                    name,\n                    type\n                })\n            });\n        },\n        get (id) {\n            return obj.serviceCall({\n                url: fetchUrl.default(`/users/${\n                    encodeURIComponent(Configuration.loggedUser.get(\"username\"))\n                }/oauth2/resources/labels?_queryFilter=true`),\n                headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" }\n            }).then(function (data) {\n                return _.find(data.result, { _id: id });\n            });\n        },\n        remove (id) {\n            return obj.serviceCall({\n                url: fetchUrl.default(`/users/${\n                    encodeURIComponent(Configuration.loggedUser.get(\"username\"))\n                }/oauth2/resources/labels/${encodeURIComponent(id)}`),\n                headers: { \"Accept-API-Version\": \"protocol=1.0,resource=1.0\" },\n                type: \"DELETE\"\n            });\n        }\n    };\n\n    return obj;\n});\n"]}