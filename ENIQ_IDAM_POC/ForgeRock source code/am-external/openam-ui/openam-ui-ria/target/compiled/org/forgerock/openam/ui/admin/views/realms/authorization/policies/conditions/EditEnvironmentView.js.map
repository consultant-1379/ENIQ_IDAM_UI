{"version":3,"sources":["../../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/EditEnvironmentView.js"],"names":["define","$","_","AbstractView","UIUtils","PoliciesService","BooleanAttr","ArrayAttr","StringAttr","ObjectAttr","EnumAttr","TimeAttr","DayAttr","DateAttr","Handlebars","extend","template","events","data","i18n","SCRIPT_RESOURCE","render","schema","element","itemID","itemData","callback","self","hiddenData","setElement","each","conditions","condition","i18nKey","t","key","title","sortBy","fillTemplateWithData","tpl","$el","append","name","type","scriptId","find","val","trigger","focus","hide","createListItem","allEnvironments","item","itemToDisplay","mergedData","merge","getScriptById","done","script","props","setListItemHtml","html","attr","changeType","e","stopPropagation","selectedType","target","value","delay","length","helperText","setDefaultJsonValues","animateOut","getHelperText","setTimeout","remove","isEmpty","show","toString","content","popover","parents","hasClass","buildHTML","animateIn","helpers","itemDataEl","schemaProps","config","properties","attributesWrapper","htmlBuiltPromise","Deferred","buildScriptAttr","dataSource","multiple","resolve","enforcementTimeZone","has","authenticationStrategy","map","selected","wrapAll","console","error","fadeOut","removeClass","next","addClass","prev","prop"],"mappings":"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","file":"EditEnvironmentView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2014-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\n    \"org/forgerock/openam/ui/admin/services/realm/PoliciesService\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrBooleanView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrArrayView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrStringView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrObjectView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrEnumView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrTimeView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrDayView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrDateView\",\n    \"handlebars\"\n], function ($, _, AbstractView, UIUtils, PoliciesService, BooleanAttr, ArrayAttr, StringAttr, ObjectAttr, EnumAttr,\n             TimeAttr, DayAttr, DateAttr, Handlebars) {\n    return AbstractView.extend({\n        template: \"templates/admin/views/realms/authorization/policies/conditions/EditEnvironmentTemplate.html\",\n        events: {\n            \"change [data-type-selection]\": \"changeType\"\n        },\n        data: {},\n        i18n: {\n            \"condition\": {\n                \"key\": \"console.authorization.policies.edit.conditionTypes.\",\n                \"title\": \".title\",\n                \"props\": \".props.\"\n            }\n        },\n        SCRIPT_RESOURCE: \"Script\",\n\n        render (schema, element, itemID, itemData, callback) {\n            var self = this,\n                hiddenData = {};\n\n            this.setElement(element);\n\n            this.data = $.extend(true, [], schema);\n            this.data.itemID = itemID;\n\n            _.each(this.data.conditions, function (condition) {\n                condition.i18nKey = $.t(self.i18n.condition.key + condition.title + self.i18n.condition.title);\n            });\n\n            this.data.conditions = _.sortBy(this.data.conditions, \"i18nKey\");\n\n            UIUtils.fillTemplateWithData(this.template, this.data, function (tpl) {\n                self.$el.append(tpl);\n                self.setElement(`#environment_${itemID}`);\n\n                if (itemData) {\n                    // Temporary fix, the name attribute is being added by the server after the policy is created.\n                    // TODO: Serverside solution required\n                    delete itemData.name;\n\n                    // Script name is displayed on UI, but script id is saved along with the condition\n                    if (itemData.type === self.SCRIPT_RESOURCE) {\n                        hiddenData[itemData.type] = itemData.scriptId;\n                        self.$el.data(\"hiddenData\", hiddenData);\n                    }\n\n                    self.$el.data(\"itemData\", itemData);\n                    self.$el.find(\"select.type-selection:first\").val(itemData.type).trigger(\"change\");\n                }\n\n                self.$el.find(\"select.type-selection:first\").focus();\n\n                self.$el.find(\".info-button\").hide();\n\n                if (callback) {\n                    callback();\n                }\n            });\n        },\n\n        createListItem (allEnvironments, item) {\n            var self = this,\n                itemToDisplay = null,\n                itemData = item.data().itemData,\n                hiddenData = item.data().hiddenData,\n                mergedData = _.merge({}, itemData, hiddenData),\n                type;\n\n            item.focus(); //  Required to trigger changeInput.\n            this.data.conditions = allEnvironments;\n\n            if (mergedData && mergedData.type) {\n                type = mergedData.type;\n                itemToDisplay = {};\n                if (type === self.SCRIPT_RESOURCE) {\n                    itemToDisplay[\"console.common.type\"] = $.t(self.i18n.condition.key + type +\n                        self.i18n.condition.title);\n                    PoliciesService.getScriptById(mergedData.scriptId).done(function (script) {\n                        itemToDisplay[`${self.i18n.condition.key}${type}${self.i18n.condition.props}scriptId`] =\n                            script.name;\n                        self.setListItemHtml(item, itemToDisplay);\n                    });\n                } else {\n                    _.each(mergedData, function (val, key) {\n                        if (key === \"type\") {\n                            itemToDisplay[\"console.common.type\"] =\n                                $.t(`${self.i18n.condition.key}${type}${self.i18n.condition.title}`);\n                        } else if (key === \"authenticationStrategy\") {\n                            itemToDisplay[`${self.i18n.condition.key}${type}${self.i18n.condition.props}${key}`] =\n                                $.t(`${self.i18n.condition.key}${type}${self.i18n.condition.props}${val}`);\n                        } else {\n                            itemToDisplay[`${self.i18n.condition.key}${type}${self.i18n.condition.props}${key}`] = val;\n                        }\n                    });\n                    this.setListItemHtml(item, itemToDisplay);\n                }\n            } else {\n                this.setListItemHtml(item, itemToDisplay);\n            }\n        },\n\n        setListItemHtml (item, itemToDisplay) {\n            var self = this;\n\n            UIUtils.fillTemplateWithData(\n                \"templates/admin/views/realms/authorization/policies/conditions/ListItem.html\", {\n                    data: itemToDisplay\n                },\n                function (tpl) {\n                    item.find(\".item-data\").html(tpl);\n                    self.setElement(`#${item.attr(\"id\")}`);\n                });\n        },\n\n        changeType (e) {\n            e.stopPropagation();\n            var self = this,\n                itemData = {},\n                hiddenData = {},\n                selectedType = e.target.value,\n                schema = _.find(this.data.conditions, { title: selectedType }) || {},\n                delay = self.$el.find(\".field-float-pattern\").length > 0 ? 500 : 0,\n                helperText;\n\n            if (this.$el.data().itemData && this.$el.data().itemData.type === selectedType) {\n                itemData = this.$el.data().itemData;\n                hiddenData = this.$el.data().hiddenData;\n            } else {\n                itemData = self.setDefaultJsonValues(schema);\n                self.$el.data(\"itemData\", itemData);\n                self.$el.data(\"hiddenData\", hiddenData);\n            }\n\n            if (itemData) {\n                self.animateOut();\n                helperText = this.getHelperText(schema);\n\n                // setTimeout needed to delay transitions.\n                setTimeout(function () {\n                    self.$el.find(\".no-float\").remove();\n                    self.$el.find(\".clear-left\").remove();\n\n                    if (_.isEmpty(helperText)) {\n                        self.$el.find(\".info-button\").hide();\n                    } else {\n                        self.$el.find(\".info-button\")\n                            .show()\n                            .attr(\"data-title\", helperText.title.toString())\n                            .attr(\"data-content\", helperText.content.toString())\n                            .popover();\n                    }\n\n                    if (!self.$el.parents(\"#dropbox\").length || self.$el.hasClass(\"editing\")) {\n                        self.buildHTML(itemData, hiddenData, schema).done(function () {\n                            self.animateIn();\n                        });\n                    }\n                }, delay);\n            }\n        },\n\n        getHelperText (schema) {\n            var helperText = {};\n            switch (schema.title) {\n                case \"IPv4\": // fall through\n                case \"IPv6\":\n                    helperText.title =\n                        Handlebars.helpers.t(\"console.authorization.policies.edit.conditionTypes.ipHelperTitle\");\n                    helperText.content =\n                        Handlebars.helpers.t(\"console.authorization.policies.edit.conditionTypes.ipHelperContent\");\n                    break;\n                case \"SimpleTime\":\n                    helperText.title =\n                        Handlebars.helpers.t(\n                            \"console.authorization.policies.edit.conditionTypes.SimpleTime.helperTitle\");\n                    helperText.content =\n                        Handlebars.helpers.t(\n                            \"console.authorization.policies.edit.conditionTypes.SimpleTime.helperContent\");\n                    break;\n                default:\n                    break;\n            }\n            return helperText;\n        },\n\n        buildHTML (itemData, hiddenData, schema) {\n            var self = this,\n                itemDataEl = this.$el.find(\".item-data\"),\n                schemaProps = schema.config.properties,\n                i18nKey,\n                attributesWrapper,\n                htmlBuiltPromise = $.Deferred();\n\n            function buildScriptAttr () {\n                new ArrayAttr().render({\n                    itemData, hiddenData, data: [hiddenData[itemData.type]],\n                    title: \"scriptId\", dataSource: \"scripts\", multiple: false,\n                    i18nKey: `${self.i18n.condition.key}${schema.title}${self.i18n.condition.props}scriptId`\n                }, itemDataEl, htmlBuiltPromise.resolve);\n            }\n\n            if (itemData.type === \"SimpleTime\") {\n                attributesWrapper = '<div class=\"clearfix clear-left\" id=\"conditionAttrTimeDate\"></div>';\n                new TimeAttr().render({ itemData }, itemDataEl);\n                new DayAttr().render({ itemData }, itemDataEl);\n                new DateAttr().render({ itemData }, itemDataEl);\n\n                if (!itemData.enforcementTimeZone) {\n                    itemData.enforcementTimeZone = \"GMT\";\n                }\n                new ArrayAttr().render({\n                    itemData,\n                    data: [itemData.enforcementTimeZone],\n                    title: \"enforcementTimeZone\",\n                    i18nKey: `${self.i18n.condition.key}${schema.title}${self.i18n.condition.props}enforcementTimeZone`,\n                    dataSource: \"enforcementTimeZone\",\n                    multiple: false\n                }, itemDataEl);\n                htmlBuiltPromise.resolve();\n            } else if (schema.title === self.SCRIPT_RESOURCE) {\n                attributesWrapper = '<div class=\"no-float\"></div>';\n                if (itemData && itemData.scriptId) {\n                    PoliciesService.getScriptById(itemData.scriptId).done(function (script) {\n                        hiddenData[itemData.type] = script.name;\n                        buildScriptAttr();\n                    });\n                } else {\n                    buildScriptAttr();\n                }\n            } else {\n                attributesWrapper = '<div class=\"no-float\"></div>';\n\n                if (_.has(schemaProps, \"authenticationStrategy.type\")) {\n                    schemaProps.authenticationStrategy.type = \"array\";\n                }\n\n                _.map(schemaProps, function (value, key) {\n                    i18nKey = self.i18n.condition.key + schema.title + self.i18n.condition.props + key;\n\n                    switch (value.type) {\n                        case \"string\": // fall through\n                        case \"number\": // fall through\n                        case \"integer\":\n                            new StringAttr().render({\n                                itemData,\n                                data: itemData[key],\n                                title: key,\n                                i18nKey,\n                                schema,\n                                value\n                            }, itemDataEl);\n                            break;\n                        case \"boolean\":\n                            new BooleanAttr().render({\n                                itemData,\n                                data: value,\n                                title: key,\n                                i18nKey,\n                                selected: itemData[key]\n                            }, itemDataEl);\n                            break;\n                        case \"array\":\n                            new ArrayAttr().render({\n                                itemData,\n                                data: itemData[key],\n                                title: key,\n                                i18nKey\n                            }, itemDataEl);\n                            break;\n                        case \"object\":\n                            new ObjectAttr().render({\n                                itemData,\n                                data: itemData[key],\n                                title: key,\n                                i18nKey\n                            }, itemDataEl);\n                            break;\n                        default:\n                            break;\n                    }\n                });\n                htmlBuiltPromise.resolve();\n            }\n\n            htmlBuiltPromise.done(function () {\n                self.$el.find(\".condition-attr\").wrapAll(attributesWrapper);\n            });\n\n            return htmlBuiltPromise;\n        },\n\n        setDefaultJsonValues (schema) {\n            var itemData = { type: schema.title };\n            _.map(schema.config.properties, function (value, key) {\n                switch (value.type) {\n                    case \"string\":\n                        if (key === \"authenticateToRealm\") {\n                            itemData[key] = \"/\";\n                        } else if (key !== \"startIp\" && key !== \"endIp\") {\n                            // OPENAM-5182: we should not submit empty string if IP is missing\n                            itemData[key] = \"\";\n                        }\n                        break;\n                    case \"number\": // fall through\n                    case \"integer\":\n                        itemData[key] = 0;\n                        break;\n                    case \"boolean\":\n                        itemData[key] = false;\n                        break;\n                    case \"array\":\n                        itemData[key] = [];\n                        break;\n                    case \"object\":\n                        itemData[key] = {};\n                        break;\n                    default:\n                        console.error(\"Unexpected data type:\", key, value);\n                        break;\n                }\n            });\n\n            return itemData;\n        },\n\n        animateOut () {\n            // hide all items except the title selector\n            this.$el.find(\".no-float\").fadeOut(500);\n            this.$el.find(\".clear-left\").fadeOut(500);\n            this.$el.find(\".field-float-pattern, .field-float-selectize, .timezone-field\")\n                .find(\"label\").removeClass(\"showLabel\")\n                .next(\"input\").addClass(\"placeholderText\");\n\n            this.$el.find(\".field-float-select select:not(.type-selection)\").addClass(\"placeholderText\")\n                .prev(\"label\").removeClass(\"showLabel\");\n\n            this.$el.removeClass(\"invalid-rule\");\n        },\n\n        animateIn () {\n            var self = this;\n            setTimeout(function () {\n                self.$el.find(\".field-float-pattern, .field-float-selectize, .timezone-field\")\n                    .find(\"label\").addClass(\"showLabel\")\n                    .next(\"input, div input\").removeClass(\"placeholderText\").prop(\"readonly\", false);\n\n                self.$el.find(\".field-float-select select:not(.type-selection)\").removeClass(\"placeholderText\")\n                    .prop(\"readonly\", false).prev(\"label\").addClass(\"showLabel\");\n            }, 10);\n        }\n    });\n});\n"]}