{"version":3,"sources":["../../../../../../../../../XUI/org/forgerock/openam/ui/common/views/jsonSchema/editors/JSONEditorView.js"],"names":["define","$","_","Backbone","JSONEditor","JSONSchema","JSONValues","JSONEditorTheme","UIUtils","convertHelpBlocksToPopOvers","element","template","compileTemplate","then","html","find","addClass","each","index","value","helpPopOver","popoverclickaway","container","placement","content","innerHTML","click","event","preventDefault","parent","append","setPlaceholderOnPasswords","attr","t","applyJSONEditorToElement","options","schema","values","hideInheritance","GRID_COLUMN_WIDTH_1","GRID_COLUMN_WIDTH_2","plugins","selectize","enable","defaults","themes","openam","getTheme","actualSchema","toFlatWithInheritanceMeta","actualValues","removeInheritance","raw","editor","setValue","JSONEditorView","View","extend","className","initialize","TypeError","displayTitle","toggleInheritance","propertySchemaPath","propValue","isInherited","getData","addValueForKey","render","$el","empty","watchlist","get","jsonEditor","hide","isValid","validate","length","getValue","hasDefaultProperties","pick","defaultProperties","nullifyEmptyPasswords","getPasswordKeys","addInheritance","setData","data","watch","path","callback"],"mappings":"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","file":"JSONEditorView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2016-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"backbone\",\n    \"jsonEditor\",\n    \"org/forgerock/openam/ui/common/models/JSONSchema\",\n    \"org/forgerock/openam/ui/common/models/JSONValues\",\n    \"org/forgerock/openam/ui/admin/utils/JSONEditorTheme\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\n\n    \"popoverclickaway\", // depends on jquery and bootstrap\n    \"selectize\" // jquery dependencies\n], ($, _, Backbone, JSONEditor, JSONSchema, JSONValues, JSONEditorTheme, UIUtils) => {\n    function convertHelpBlocksToPopOvers (element) {\n        const template = \"templates/common/jsonSchema/editors/_HelpPopover.html\";\n        UIUtils.compileTemplate(template).then((html) => {\n            $(element).find(\".help-block\").addClass(\"hidden-lg hidden-md hidden-sm\").each((index, value) => {\n                const helpPopOver = $(html);\n\n                helpPopOver.popoverclickaway({\n                    container: \"#content\",\n                    html: true,\n                    placement: \"auto top\",\n                    content: value.innerHTML\n                }).click((event) => {\n                    event.preventDefault();\n                });\n\n                $(value).parent().append(helpPopOver);\n            });\n        });\n    }\n    /**\n     * Passwords are not delivered to the UI from the server. Thus we set a placeholder informing the user that\n     * the password will remain unchanged if they do nothing.\n     * @param {DOMElement} element The element to perform the element search from\n     */\n    function setPlaceholderOnPasswords (element) {\n        $(element).find(\"input:password\").attr(\"placeholder\", $.t(\"common.form.passwordPlaceholder\"));\n    }\n\n    function applyJSONEditorToElement (element, options) {\n        const { schema, values, hideInheritance = false } = options;\n        const GRID_COLUMN_WIDTH_1 = 6;\n        const GRID_COLUMN_WIDTH_2 = 4;\n\n        JSONEditor.plugins.selectize.enable = true;\n        JSONEditor.defaults.themes.openam = JSONEditorTheme.getTheme(GRID_COLUMN_WIDTH_1, GRID_COLUMN_WIDTH_2);\n\n        let actualSchema = schema.toFlatWithInheritanceMeta(values);\n        let actualValues = values.removeInheritance();\n\n        actualSchema = actualSchema.raw;\n        actualValues = actualValues.raw;\n\n        const editor = new JSONEditor(element[0], {\n            \"disable_collapse\": true,\n            \"disable_edit_json\": true,\n            \"disable_properties\": true,\n            \"hide_inheritance\": hideInheritance,\n            \"iconlib\": \"fontawesome4\",\n            \"schema\": actualSchema,\n            \"theme\": \"openam\"\n        });\n\n        convertHelpBlocksToPopOvers(element);\n        setPlaceholderOnPasswords(element);\n\n        editor.setValue(actualValues);\n\n        return editor;\n    }\n\n    const JSONEditorView = Backbone.View.extend({\n        className: \"jsoneditor-block\",\n        initialize (options) {\n            if (!(options.schema instanceof JSONSchema)) {\n                throw new TypeError(\"[JSONEditorView] \\\"schema\\\" argument is not an instance of JSONSchema.\");\n            }\n            if (!(options.values instanceof JSONValues)) {\n                throw new TypeError(\"[JSONEditorView] \\\"values\\\" argument is not an instance of JSONValues.\");\n            }\n\n            this.options = _.defaults(options, {\n                displayTitle: true\n            });\n        },\n        toggleInheritance (propertySchemaPath, propValue, isInherited) {\n            // update the data to hold whatever is now on UI before doing further manipulations\n            this.options.values = this.options.values.extend(this.getData());\n\n            this.options.values = this.options.values.addValueForKey(propertySchemaPath, \"inherited\", isInherited);\n            this.options.values = this.options.values.addValueForKey(propertySchemaPath, \"value\", propValue);\n\n            this.render();\n        },\n        render () {\n            this.$el.empty();\n\n            const watchlist = _.get(this.jsonEditor, \"watchlist\");\n\n            this.jsonEditor = applyJSONEditorToElement(\n                this.$el,\n                this.options\n            );\n\n            this.jsonEditor.watchlist = watchlist;\n\n            if (!this.options.displayTitle) {\n                this.$el.find(\"[data-header]\").parent().hide();\n            }\n\n            return this;\n        },\n        isValid () {\n            return this.jsonEditor.validate().length === 0;\n        },\n        /**\n        * Returns form data.\n        * @returns {Object} form data\n        */\n        getData () {\n            let values = new JSONValues(this.jsonEditor.getValue());\n\n            // Returns only the subset of values that were displayed to the user (via defaultProperties)\n            if (this.options.schema.hasDefaultProperties()) {\n                values = values.pick(this.options.schema.raw.defaultProperties);\n            }\n\n            values = values.nullifyEmptyPasswords(this.options.schema.getPasswordKeys());\n            values = values.addInheritance(this.options.values.raw);\n\n            return values.raw;\n        },\n        setData (data) {\n            this.options.values = this.options.values.extend(data);\n        },\n        watch (path, callback) {\n            this.jsonEditor.watch(path, callback);\n        }\n    });\n\n    return JSONEditorView;\n});\n"]}