{"version":3,"sources":["../../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/EditSubjectView.js"],"names":["define","$","_","AbstractView","UIUtils","ArrayAttr","StringAttr","extend","template","events","data","subjectI18n","IDENTITY_RESOURCE","render","schema","element","itemID","itemData","callback","self","setElement","each","subjects","subj","i18nKey","t","key","title","sortBy","fillTemplateWithData","tpl","$el","append","type","getUIDsFromUniversalValues","subjectValues","find","val","trigger","focus","createListItem","allSubjects","item","itemToDisplay","hiddenData","list","mergedData","merge","forOwn","prop","props","html","attr","changeType","e","stopPropagation","selectedType","target","value","delay","length","setDefaultJsonValues","animateOut","setTimeout","remove","parents","hasClass","buildHTML","done","animateIn","itemDataEl","schemaProps","config","properties","htmlBuiltPromise","Deferred","identityType","dataSource","resolve","map","wrapAll","console","error","fadeOut","removeClass","next","addClass","values","returnObj","users","groups","endIndex","startIndex","String","universalid","indexOf","substring"],"mappings":"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","file":"EditSubjectView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2014-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrArrayView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/policies/conditions/ConditionAttrStringView\"\n], function ($, _, AbstractView, UIUtils, ArrayAttr, StringAttr) {\n    return AbstractView.extend({\n        template: \"templates/admin/views/realms/authorization/policies/conditions/EditSubjectTemplate.html\",\n        events: {\n            \"change [data-type-selection]\": \"changeType\"\n        },\n        data: {},\n        subjectI18n: {\n            \"key\": \"console.authorization.policies.edit.subjectTypes.\",\n            \"title\": \".title\",\n            \"props\": \".props.\"\n        },\n        IDENTITY_RESOURCE: \"Identity\",\n\n        render (schema, element, itemID, itemData, callback) {\n            var self = this;\n            this.setElement(element);\n\n            this.data = $.extend(true, [], schema);\n            this.data.itemID = itemID;\n\n            _.each(this.data.subjects, function (subj) {\n                subj.i18nKey = $.t(self.subjectI18n.key + subj.title + self.subjectI18n.title);\n            });\n\n            this.data.subjects = _.sortBy(this.data.subjects, \"i18nKey\");\n\n            UIUtils.fillTemplateWithData(this.template, this.data, function (tpl) {\n                self.$el.append(tpl);\n\n                self.setElement(`#subject_${itemID}`);\n\n                if (itemData) {\n                    if (itemData.type === self.IDENTITY_RESOURCE) { // client side fix for 'Identity'\n                        self.$el.data(\"hiddenData\", self.getUIDsFromUniversalValues(itemData.subjectValues));\n                    }\n\n                    self.$el.data(\"itemData\", itemData);\n                    self.$el.find(\"select.type-selection:first\").val(itemData.type).trigger(\"change\");\n                }\n\n                self.$el.find(\"select.type-selection:first\").focus();\n\n                if (callback) {\n                    callback();\n                }\n            });\n        },\n\n        createListItem (allSubjects, item) {\n            var self = this,\n                itemToDisplay = null,\n                itemData = item.data().itemData,\n                hiddenData = item.data().hiddenData,\n                type,\n                list,\n                mergedData;\n\n            mergedData = _.merge({}, itemData, hiddenData);\n\n            item.focus(); //  Required to trigger changeInput.\n            this.data.subjects = allSubjects;\n\n            if (mergedData && mergedData.type) {\n                type = mergedData.type;\n                itemToDisplay = {};\n\n                _.each(mergedData, function (val, key) {\n                    if (key === \"type\") {\n                        itemToDisplay[\"console.common.type\"] = $.t(self.subjectI18n.key + type +\n                            self.subjectI18n.title);\n                    } else if (type === self.IDENTITY_RESOURCE) {\n                        // Do not display the Identities subject values, but display the merged hidden data instead.\n                        if (key !== \"subjectValues\") {\n                            list = \"\";\n                            _.forOwn(val, function (prop) {\n                                list += `${prop} `;\n                            });\n\n                            itemToDisplay[self.subjectI18n.key + type + self.subjectI18n.props + key] = list;\n                        }\n                    } else {\n                        itemToDisplay[self.subjectI18n.key + type + self.subjectI18n.props + key] = val;\n                    }\n                });\n            }\n\n            UIUtils.fillTemplateWithData(\n                \"templates/admin/views/realms/authorization/policies/conditions/ListItem.html\", {\n                    data: itemToDisplay\n                },\n                function (tpl) {\n                    item.find(\".item-data\").html(tpl);\n                    self.setElement(`#${item.attr(\"id\")}`);\n                });\n        },\n\n        changeType (e) {\n            e.stopPropagation();\n            var self = this,\n                itemData = {},\n                hiddenData,\n                selectedType = e.target.value,\n                schema = _.find(this.data.subjects, { title: selectedType }) || {},\n                delay = self.$el.find(\".field-float-pattern\").length > 0 ? 500 : 0;\n\n            if (this.$el.data().itemData && this.$el.data().itemData.type === selectedType) {\n                itemData = this.$el.data().itemData;\n                hiddenData = this.$el.data().hiddenData;\n            } else {\n                itemData = self.setDefaultJsonValues(schema);\n                self.$el.data(\"itemData\", itemData);\n                hiddenData = itemData.type === self.IDENTITY_RESOURCE ? { \"users\": {}, \"groups\": {} } : {};\n                self.$el.data(\"hiddenData\", hiddenData);\n            }\n\n            if (itemData) {\n                self.animateOut();\n\n                // setTimeout needed to delay transitions.\n                setTimeout(function () {\n                    self.$el.find(\".no-float\").remove();\n                    self.$el.find(\".clear-left\").remove();\n\n                    if (!self.$el.parents(\"#dropbox\").length || self.$el.hasClass(\"editing\")) {\n                        self.buildHTML(itemData, hiddenData, schema).done(function () {\n                            self.animateIn();\n                        });\n                    }\n                }, delay);\n            }\n        },\n\n        buildHTML (itemData, hiddenData, schema) {\n            var self = this,\n                itemDataEl = this.$el.find(\".item-data\"),\n                schemaProps = schema.config.properties,\n                i18nKey,\n                htmlBuiltPromise = $.Deferred();\n\n            if (schema.title === self.IDENTITY_RESOURCE) {\n                _.each([\"users\", \"groups\"], function (identityType) {\n                    new ArrayAttr().render({\n                        itemData,\n                        hiddenData,\n                        data: hiddenData[identityType],\n                        title: identityType,\n                        i18nKey: self.subjectI18n.key + schema.title + self.subjectI18n.props + identityType,\n                        dataSource: identityType\n                    }, itemDataEl, htmlBuiltPromise.resolve);\n                });\n            } else {\n                _.map(schemaProps, function (value, key) {\n                    i18nKey = self.subjectI18n.key + schema.title + self.subjectI18n.props + key;\n\n                    switch (value.type) {\n                        case \"string\":\n                            new StringAttr().render({\n                                itemData,\n                                hiddenData,\n                                data: itemData[key],\n                                title: key,\n                                i18nKey\n                            }, itemDataEl);\n                            break;\n                        case \"array\":\n                            new ArrayAttr().render({\n                                itemData,\n                                hiddenData,\n                                data: itemData[key],\n                                title: key,\n                                i18nKey\n                            }, itemDataEl);\n                            break;\n                        default:\n                            break;\n                    }\n                });\n                htmlBuiltPromise.resolve();\n            }\n\n            htmlBuiltPromise.done(function () {\n                self.$el.find(\".condition-attr\").wrapAll(\"<div class='no-float'></div>\");\n            });\n\n            return htmlBuiltPromise;\n        },\n\n        setDefaultJsonValues (schema) {\n            var itemData = { type: schema.title };\n            _.map(schema.config.properties, function (value, key) {\n                switch (value.type) {\n                    case \"string\":\n                        itemData[key] = \"\";\n                        break;\n                    case \"array\":\n                        itemData[key] = [];\n                        break;\n                    default:\n                        console.error(\"Unexpected data type:\", key, value);\n                        break;\n                }\n            });\n\n            return itemData;\n        },\n\n        animateOut () {\n            // hide all items except the title selector\n            this.$el.find(\".no-float\").fadeOut(500);\n            this.$el.find(\".clear-left\").fadeOut(500);\n            this.$el.find(\".field-float-pattern, .field-float-selectize\")\n                .find(\"label\").removeClass(\"showLabel\")\n                .next(\"input, div input\").addClass(\"placeholderText\").prop(\"readonly\", true);\n\n            this.$el.removeClass(\"invalid-rule\");\n        },\n\n        animateIn () {\n            var self = this;\n            setTimeout(function () {\n                self.$el.find(\".field-float-pattern, .field-float-selectize\")\n                    .find(\"label\").addClass(\"showLabel\")\n                    .next(\"input, div input\").removeClass(\"placeholderText\").prop(\"readonly\", false);\n            }, 10);\n        },\n\n        getUIDsFromUniversalValues (values) {\n            var returnObj = { users: {}, groups: {} },\n                endIndex = -1,\n                startIndex = String(\"id=\").length;\n\n            _.each(values, function (universalid) {\n                endIndex = universalid.indexOf(\",ou=\");\n                if (universalid.indexOf(\",ou=user\") > -1) {\n                    returnObj.users[universalid] = universalid.substring(startIndex, endIndex);\n                } else if (universalid.indexOf(\",ou=group\") > -1) {\n                    returnObj.groups[universalid] = universalid.substring(startIndex, endIndex);\n                }\n            });\n\n            return returnObj;\n        }\n    });\n});\n"]}