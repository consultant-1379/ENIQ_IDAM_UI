{"version":3,"sources":["../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authentication/chains/LinkView.js"],"names":["define","$","_","AbstractView","BootstrapDialog","Handlebars","UIUtils","LinkView","extend","template","popoverTemplate","mode","partials","events","deleteItem","parent","data","form","chainData","authChainConfiguration","splice","$el","index","validateChain","remove","editItem","showPopover","self","popover","find","selected","criteria","val","toLowerCase","passText","t","failText","fillTemplateWithData","options","content","title","text","hidePopover","renderArrows","html","compile","linkConfig","selectCriteria","render","optionsLength","keys","length","typeDescription","getModuleDesciption","parentRender","trigger","container","placement","name","allModules","_id","module"],"mappings":"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","file":"LinkView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/components/BootstrapDialog\",\n    \"handlebars\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\"\n], function ($, _, AbstractView, BootstrapDialog, Handlebars, UIUtils) {\n    var LinkView = AbstractView.extend({\n        template: \"templates/admin/views/realms/authentication/chains/LinkTemplate.html\",\n        popoverTemplate: \"templates/admin/views/realms/authentication/chains/PopoverTemplate.html\",\n        mode: \"replace\",\n        partials : [\"templates/admin/views/realms/authentication/chains/_CriteriaFooter.html\"],\n        events: {\n            \"click [data-edit]\"                   : \"editItem\",\n            \"click [data-delete]\"                 : \"deleteItem\",\n            \"change [data-select-criteria]\"       : \"selectCriteria\",\n            \"mouseenter [data-auth-criteria-info]\": \"showPopover\",\n            \"focusin    [data-auth-criteria-info]\": \"showPopover\",\n            \"mouseleave [data-auth-criteria-info]\": \"hidePopover\",\n            \"focusout   [data-auth-criteria-info]\": \"hidePopover\"\n        },\n\n        deleteItem () {\n            this.parent.data.form.chainData.authChainConfiguration.splice(this.$el.index(), 1);\n            this.parent.validateChain();\n            this.remove();\n        },\n\n        editItem () {\n            this.parent.editItem(this);\n        },\n\n        showPopover () {\n            var self = this,\n                popover = this.$el.find(\"[data-auth-criteria-info]\").data(\"bs.popover\"),\n                selected = this.$el.find(\"[data-select-criteria] option:selected\"),\n                index = selected.index(),\n                data = {\n                    criteria : selected.val().toLowerCase(),\n                    passText : $.t(`console.authentication.editChains.criteria.${index}.passText`),\n                    failText : $.t(`console.authentication.editChains.criteria.${index}.failText`)\n                };\n\n            UIUtils.fillTemplateWithData(self.popoverTemplate, data, function (data) {\n                popover.options.content = data;\n                popover.options.title = selected.text();\n                self.$el.find(\"[data-auth-criteria-info]\").popover(\"show\");\n            });\n        },\n\n        hidePopover () {\n            this.$el.find(\"[data-auth-criteria-info]\").popover(\"hide\");\n        },\n\n        renderArrows () {\n            var html = Handlebars.compile(\n                `{{> templates/admin/views/realms/authentication/chains/_CriteriaFooter type='${\n                    this.data.linkConfig.criteria\n                }'}}`);\n\n            this.$el.find(\".criteria-view\").html(html);\n        },\n\n        selectCriteria () {\n            this.data.linkConfig.criteria = this.$el.find(\"[data-select-criteria] option:selected\").val();\n            this.parent.validateChain();\n            this.renderArrows();\n        },\n\n        render () {\n            var self = this;\n\n            this.data.optionsLength = _.keys(this.data.linkConfig.options).length;\n            this.data.typeDescription = this.getModuleDesciption();\n            this.parent.validateChain();\n\n            this.parentRender(function () {\n                self.renderArrows();\n                self.$el.find(\"[data-auth-criteria-info]\").popover({\n                    trigger : \"manual\",\n                    container : \"body\",\n                    html : \"true\",\n                    placement : \"right\",\n                    template: '<div class=\"popover am-link-popover\" role=\"tooltip\"><div class=\"arrow\"></div>' +\n                        '<h3 class=\"popover-title\"></h3><div class=\"popover-content\"></div></div>'\n                });\n            });\n        },\n\n        getModuleDesciption () {\n            // The server allows for deletion of modules that are in use within a chain.\n            // The chain itself will still have a reference to the deleetd module.\n            // Below we are checking if the module is present. If it isn't the typeDescription is left blank;\n            var name = _.find(this.data.allModules, { _id : this.data.linkConfig.module });\n\n            if (this.data.linkConfig.module && name) {\n                return name.typeDescription;\n            }\n            return;\n        }\n\n    });\n\n    return LinkView;\n});\n"]}