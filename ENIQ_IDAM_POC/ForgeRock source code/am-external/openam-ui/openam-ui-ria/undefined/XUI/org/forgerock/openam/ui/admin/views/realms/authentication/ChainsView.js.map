{"version":3,"sources":["../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authentication/ChainsView.js"],"names":["define","$","_","Messages","AbstractView","AuthenticationService","FormHelper","arrayify","Promise","getChainNameFromElement","element","data","chainName","performDeleteChains","realmPath","names","all","map","name","authentication","chains","remove","ChainsView","extend","template","events","chainSelected","event","hasChainsSelected","$el","find","is","row","currentTarget","closest","checked","prop","addClass","removeClass","selectAll","onDeleteSingle","preventDefault","showConfirmationBeforeDeleting","type","t","bind","deleteChain","onDeleteMultiple","selectedChains","message","count","length","deleteChains","self","then","render","response","addMessage","TYPE_DANGER","toArray","value","args","callback","sortedChains","each","values","result","obj","active","unshift","push","parentRender"],"mappings":"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","file":"ChainsView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/components/Messages\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/openam/ui/admin/services/realm/AuthenticationService\",\n    \"org/forgerock/openam/ui/admin/utils/FormHelper\",\n    \"org/forgerock/openam/ui/common/util/array/arrayify\",\n    \"org/forgerock/openam/ui/common/util/Promise\"\n], function ($, _, Messages, AbstractView, AuthenticationService, FormHelper, arrayify, Promise) {\n    function getChainNameFromElement (element) {\n        return $(element).data().chainName;\n    }\n    function performDeleteChains (realmPath, names) {\n        return Promise.all(arrayify(names).map(function (name) {\n            return AuthenticationService.authentication.chains.remove(realmPath, name);\n        }));\n    }\n\n    var ChainsView = AbstractView.extend({\n        template: \"templates/admin/views/realms/authentication/ChainsTemplate.html\",\n        events: {\n            \"change input[data-chain-name]\" : \"chainSelected\",\n            \"click  [data-delete-chain]\"    : \"onDeleteSingle\",\n            \"click  [data-delete-chains]\"   : \"onDeleteMultiple\",\n            \"click  [data-select-all]\"      : \"selectAll\"\n        },\n        chainSelected (event) {\n            var hasChainsSelected = this.$el.find(\"input[type=checkbox][data-chain-name]\").is(\":checked\"),\n                row = $(event.currentTarget).closest(\"tr\"),\n                checked = $(event.currentTarget).is(\":checked\");\n\n            this.$el.find(\"[data-delete-chains]\").prop(\"disabled\", !hasChainsSelected);\n\n            if (checked) {\n                row.addClass(\"selected\");\n            } else {\n                row.removeClass(\"selected\");\n                this.$el.find(\"[data-select-all]\").prop(\"checked\", false);\n            }\n        },\n        selectAll (event) {\n            var checked = $(event.currentTarget).is(\":checked\");\n            this.$el.find(\".sorted-chains input[type=checkbox][data-chain-name]:not(:disabled)\")\n                .prop(\"checked\", checked);\n            if (checked) {\n                this.$el.find(\".sorted-chains:not(.default-config-row)\").addClass(\"selected\");\n            } else {\n                this.$el.find(\".sorted-chains\").removeClass(\"selected\");\n            }\n            this.$el.find(\"[data-delete-chains]\").prop(\"disabled\", !checked);\n        },\n        onDeleteSingle (event) {\n            event.preventDefault();\n\n            FormHelper.showConfirmationBeforeDeleting({\n                type: $.t(\"console.authentication.common.chain\")\n            }, _.bind(this.deleteChain, this, event));\n        },\n        onDeleteMultiple (event) {\n            event.preventDefault();\n\n            var selectedChains = this.$el.find(\".sorted-chains input[type=checkbox][data-chain-name]:checked\");\n\n            FormHelper.showConfirmationBeforeDeleting({\n                message: $.t(\"console.authentication.chains.confirmDeleteSelected\", { count: selectedChains.length })\n            }, _.bind(this.deleteChains, this, event, selectedChains));\n        },\n        deleteChain (event) {\n            var self = this,\n                element = event.currentTarget,\n                name = getChainNameFromElement(event.currentTarget);\n\n            $(element).prop(\"disabled\", true);\n\n            performDeleteChains(this.data.realmPath, name).then(function () {\n                self.render([self.data.realmPath]);\n            }, function (response) {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response\n                });\n                $(element).prop(\"disabled\", false);\n            });\n        },\n        deleteChains (event, selectedChains) {\n            var self = this,\n                element = event.currentTarget,\n                names = _(selectedChains).toArray().map(getChainNameFromElement).value();\n\n            $(element).prop(\"disabled\", true);\n\n            performDeleteChains(this.data.realmPath, names).then(function () {\n                self.render([self.data.realmPath]);\n            }, function (response) {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response\n                });\n                $(element).prop(\"disabled\", false);\n            });\n        },\n        render (args, callback) {\n            var self = this,\n                sortedChains = [];\n\n            this.data.realmPath = args[0];\n\n            AuthenticationService.authentication.chains.all(this.data.realmPath).then(function (data) {\n                _.each(data.values.result, function (obj) {\n                    // Add default chains to top of list.\n                    if (obj.active) {\n                        sortedChains.unshift(obj);\n                    } else {\n                        sortedChains.push(obj);\n                    }\n                });\n                self.data.sortedChains = sortedChains;\n                self.parentRender(function () {\n                    if (callback) {\n                        callback();\n                    }\n                });\n            }, function (response) {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response\n                });\n            });\n        }\n    });\n\n    return ChainsView;\n});\n"]}