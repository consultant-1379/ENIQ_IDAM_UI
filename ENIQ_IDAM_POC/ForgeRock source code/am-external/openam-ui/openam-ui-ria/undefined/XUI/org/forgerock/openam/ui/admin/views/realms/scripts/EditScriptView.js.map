{"version":3,"sources":["../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/scripts/EditScriptView.js"],"names":["define","$","_","BootstrapDialog","CodeMirror","ChangesPending","Messages","AbstractView","EventManager","Router","Base64","Constants","UIUtils","Script","RealmScriptsService","GlobalScriptsService","FormHelper","Promise","extend","initialize","prototype","call","model","partials","events","render","args","callback","uuid","data","realmPath","renderCallback","length","contextsPromise","scripts","getAllContexts","defaultContextPromise","getDefaultGlobalContext","contextSchemaPromise","getSchema","languageSchemaPromise","getContextSchema","headerActions","actionPartial","title","icon","template","_id","listenTo","renderAfterSyncModel","fetch","newEntity","self","entity","pick","attributes","contexts","done","langSchema","renderScript","all","results","result","defaultContext","addContextNames","cleanupAfterCodemirror","bind","window","addEventListener","scriptEditor","setOption","removeEventListener","context","id","find","contextName","name","languages","addLanguageNames","parentRender","$el","selectize","changesPendingWidget","watchChanges","element","watchedObj","undo","undoCallback","changes","reRenderView","alertClass","showUploadButton","initScriptEditor","makeChanges","reRender","checkChanges","updateFields","toggleSaveButton","checkRequiredFields","app","previousContext","dataFields","dataField","each","field","getAttribute","type","checked","value","trim","changeContext","then","script","getValue","language","submitForm","e","preventDefault","savePromise","nonModifiedAttributes","clone","description","save","routeTo","configuration","routes","realmsScriptEdit","encodeURIComponent","trigger","sendEvent","EVENT_DISPLAY_MESSAGE_REQUEST","validationError","validateScript","scriptText","encodeUTF8","fillTemplateWithData","tpl","html","fail","response","addMessage","TYPE_DANGER","uploadScript","readUploadedFile","file","target","files","reader","FileReader","onload","setValue","readAsText","openDialog","renderDialog","show","constructDialogOptions","footerButtons","options","t","cssClass","message","onshow","dialog","append","push","label","action","close","checkedItem","$modalContent","newContext","val","newContextName","parent","text","buttons","selectedContext","defaultScript","promise","Deferred","resolve","fromTextArea","lineNumbers","autofocus","viewportMargin","Infinity","mode","toLowerCase","theme","on","onChangeLanguage","changeLanguage","lang","File","FileList","schema","i","index","properties","indexOf","enum_titles","items","onDeleteClick","showConfirmationBeforeDeleting","deleteScript","onSuccess","realmsScripts","destroy","success","wait","editFullScreen","toggleFullScreen","exitFullScreen","fullScreen","toggle","flag","prop"],"mappings":";;AAAA;;;;;;;;;;;;;;;;AAgBAA,OAAO,CACH,QADG,EAEH,QAFG,EAGH,4DAHG,EAIH,gCAJG,EAKH,2DALG,EAMH,qDANG,EAOH,mDAPG,EAQH,mDARG,EASH,6CATG,EAUH,6CAVG,EAWH,gDAXG,EAYH,8CAZG,EAaH,0DAbG,EAcH,6DAdG,EAeH,8DAfG,EAgBH,gDAhBG,EAiBH,6CAjBG,EAkBH,oCAlBG,EAmBH,4CAnBG,EAoBH,0CApBG;AAqBH;AACA,WAtBG,CAAP,EAuBG,UAAUC,CAAV,EAAaC,CAAb,EAAgBC,eAAhB,EAAiCC,UAAjC,EAA6CC,cAA7C,EAA6DC,QAA7D,EAAuEC,YAAvE,EAAqFC,YAArF,EAAmGC,MAAnG,EAA2GC,MAA3G,EACUC,SADV,EACqBC,OADrB,EAC8BC,MAD9B,EACsCC,mBADtC,EAC2DC,oBAD3D,EACiFC,UADjF,EAC6FC,OAD7F,EACsG;AACrG,WAAOV,aAAaW,MAAb,CAAoB;AACvBC,kBADuB,wBACT;AACVZ,yBAAaa,SAAb,CAAuBD,UAAvB,CAAkCE,IAAlC,CAAuC,IAAvC;AACA,iBAAKC,KAAL,GAAa,IAAb;AACH,SAJsB;;AAKvBC,kBAAU,CACN,6BADM,CALa;AAQvBC,gBAAQ;AACJ,0CAA8B,cAD1B;AAEJ,oCAAwB,kBAFpB;AAGJ,8CAAkC,gBAH9B;AAIJ,2CAA+B,YAJ3B;AAKJ,2CAA+B,kBAL3B;AAMJ,iCAAqB,YANjB;AAOJ,mCAAuB,eAPnB;AAQJ,4CAAgC,gBAR5B;AASJ,4CAAgC,gBAT5B;AAUJ,mCAAuB,cAVnB;AAWJ,kCAAsB;AAXlB,SARe;;AAsBvBC,cAtBuB,kBAsBfC,IAtBe,EAsBTC,QAtBS,EAsBC;AACpB,gBAAIC,OAAO,IAAX;;AAEA,iBAAKC,IAAL,CAAUC,SAAV,GAAsBJ,KAAK,CAAL,CAAtB;;AAEA;AACA,gBAAIC,QAAJ,EAAc;AACV,qBAAKI,cAAL,GAAsBJ,QAAtB;AACH;;AAED;AACA,gBAAID,KAAKM,MAAL,KAAgB,CAApB,EAAuB;AACnBJ,uBAAOF,KAAK,CAAL,CAAP;AACH;;AAED,iBAAKO,eAAL,GAAuBlB,qBAAqBmB,OAArB,CAA6BC,cAA7B,EAAvB;AACA,iBAAKC,qBAAL,GAA6BrB,qBAAqBmB,OAArB,CAA6BG,uBAA7B,EAA7B;AACA,iBAAKC,oBAAL,GAA4BvB,qBAAqBmB,OAArB,CAA6BK,SAA7B,EAA5B;AACA,iBAAKC,qBAAL,GAA6BzB,qBAAqBmB,OAArB,CAA6BO,gBAA7B,EAA7B;;AAEA,gBAAIb,IAAJ,EAAU;AACN,qBAAKC,IAAL,CAAUa,aAAV,GAA0B,CACtB,EAAEC,eAAe,cAAjB,EAAiCd,MAAK,QAAtC,EAAgDe,OAAM,oBAAtD,EAA4EC,MAAK,UAAjF,EADsB,CAA1B;AAGA,qBAAKC,QAAL,GAAgB,8DAAhB;AACA,qBAAKxB,KAAL,GAAa,IAAIT,MAAJ,CAAW,EAAEkC,KAAKnB,IAAP,EAAX,CAAb;AACA,qBAAKoB,QAAL,CAAc,KAAK1B,KAAnB,EAA0B,MAA1B,EAAkC,KAAK2B,oBAAvC;AACA,qBAAK3B,KAAL,CAAW4B,KAAX;AACH,aARD,MAQO;AACH,qBAAKJ,QAAL,GAAgB,6DAAhB;AACA,qBAAKK,SAAL,GAAiB,IAAjB;AACA,qBAAK7B,KAAL,GAAa,IAAIT,MAAJ,EAAb;AACA,qBAAKoC,oBAAL;AACH;AACJ,SAxDsB;;;AA0DvB;;;;;;;;AAQAA,4BAlEuB,kCAkEC;AACpB,gBAAIG,OAAO,IAAX;;AAEA,iBAAKvB,IAAL,CAAUwB,MAAV,GAAmBnD,EAAEoD,IAAF,CAAO,KAAKhC,KAAL,CAAWiC,UAAlB,EACf,MADe,EACP,MADO,EACC,aADD,EACgB,UADhB,EAC4B,SAD5B,EACuC,QADvC,CAAnB;;AAGA,gBAAI,KAAK1B,IAAL,CAAU2B,QAAd,EAAwB;AACpBJ,qBAAKZ,qBAAL,CAA2BiB,IAA3B,CAAgC,UAAUC,UAAV,EAAsB;AAClDN,yBAAKM,UAAL,GAAkBA,UAAlB;AACAN,yBAAKO,YAAL;AACH,iBAHD;AAIH,aALD,MAKO;AACH1C,wBAAQ2C,GAAR,CAAY,CAACR,KAAKnB,eAAN,EAAuBmB,KAAKhB,qBAA5B,EAAmDgB,KAAKd,oBAAxD,EACRc,KAAKZ,qBADG,CAAZ,EACiCiB,IADjC,CAEI,UAAUI,OAAV,EAAmB;AACfT,yBAAKvB,IAAL,CAAU2B,QAAV,GAAqBK,QAAQ,CAAR,EAAW,CAAX,EAAcC,MAAnC;AACAV,yBAAKvB,IAAL,CAAUkC,cAAV,GAA2BF,QAAQ,CAAR,EAAW,CAAX,EAAcE,cAAzC;AACAX,yBAAKY,eAAL,CAAqBZ,KAAKvB,IAAL,CAAU2B,QAA/B,EAAyCK,QAAQ,CAAR,EAAW,CAAX,CAAzC;AACAT,yBAAKM,UAAL,GAAkBG,QAAQ,CAAR,EAAW,CAAX,CAAlB;AACAT,yBAAKO,YAAL;AACH,iBARL;AASH;;AAEDP,iBAAKa,sBAAL,GAA8B/D,EAAEgE,IAAF,CAAOd,KAAKa,sBAAZ,EAAoCb,IAApC,CAA9B;AACAe,mBAAOC,gBAAP,CAAwB,YAAxB,EAAsChB,KAAKa,sBAA3C;AACH,SA3FsB;AA6FvBA,8BA7FuB,oCA6FG;AACtB;AACA;AACA,gBAAI,KAAKI,YAAT,EAAuB;AACnB,qBAAKA,YAAL,CAAkBC,SAAlB,CAA4B,YAA5B,EAA0C,KAA1C;AACAH,uBAAOI,mBAAP,CAA2B,YAA3B,EAAyC,KAAKN,sBAA9C;AACH;AACJ,SApGsB;AAsGvBN,oBAtGuB,0BAsGP;AACZ,gBAAIP,OAAO,IAAX;AAAA,gBACIoB,OADJ;;AAGA,gBAAI,KAAKlD,KAAL,CAAWmD,EAAf,EAAmB;AACfD,0BAAUtE,EAAEwE,IAAF,CAAO,KAAK7C,IAAL,CAAU2B,QAAjB,EAA2B,UAAUgB,OAAV,EAAmB;AACpD,2BAAOA,QAAQzB,GAAR,KAAgBK,KAAKvB,IAAL,CAAUwB,MAAV,CAAiBmB,OAAxC;AACH,iBAFS,CAAV;AAGA,qBAAK3C,IAAL,CAAU8C,WAAV,GAAwBH,QAAQI,IAAhC;AACA,qBAAK/C,IAAL,CAAUgD,SAAV,GAAsB,KAAKC,gBAAL,CAAsBN,QAAQK,SAA9B,CAAtB;AACH,aAND,MAMO;AACH,qBAAKhD,IAAL,CAAUgD,SAAV,GAAsB,EAAtB;AACH;;AAED,iBAAKE,YAAL,CAAkB,YAAY;AAC1B,oBAAI,KAAK5B,SAAT,EAAoB;AAChB,yBAAK6B,GAAL,CAASN,IAAT,CAAc,UAAd,EAA0BO,SAA1B;AACH,iBAFD,MAEO;AACH,yBAAKC,oBAAL,GAA4B7E,eAAe8E,YAAf,CAA4B;AACpDC,iCAAS,KAAKJ,GAAL,CAASN,IAAT,CAAc,yBAAd,CAD2C;AAEpDW,oCAAY,KAAKxD,IAAL,CAAUwB,MAF8B;AAGpDiC,8BAAM,CAAC,KAAKnC,SAHwC;AAIpDoC,oCAJoD,wBAItCC,OAJsC,EAI7B;AACnBtF,8BAAEgB,MAAF,CAASkC,KAAKvB,IAAL,CAAUwB,MAAnB,EAA2BmC,OAA3B;AACA,gCAAIhB,UAAUtE,EAAEwE,IAAF,CAAOtB,KAAKvB,IAAL,CAAU2B,QAAjB,EAA2B;AACrC,uCAAOJ,KAAKvB,IAAL,CAAUwB,MAAV,CAAiBmB;AADa,6BAA3B,CAAd;AAGApB,iCAAKvB,IAAL,CAAU8C,WAAV,GAAwBH,QAAQI,IAAhC;AACAxB,iCAAKvB,IAAL,CAAUgD,SAAV,GAAsBzB,KAAK0B,gBAAL,CAAsBN,QAAQK,SAA9B,CAAtB;AACAzB,iCAAKqC,YAAL;AACH,yBAZmD;;AAapDC,oCAAY;AAbwC,qBAA5B,CAA5B;;AAgBA,yBAAKC,gBAAL;AACA,yBAAKC,gBAAL;AACH;;AAED,oBAAI,KAAK7D,cAAT,EAAyB;AACrB,yBAAKA,cAAL;AACH;AACJ,aA3BD;AA4BH,SAhJsB;AAkJvB0D,oBAlJuB,0BAkJP;AACZ,iBAAKV,YAAL,CAAkB,YAAY;AAC1B,qBAAKY,gBAAL;AACA,qBAAKC,gBAAL;;AAEA,qBAAKV,oBAAL,CAA0BW,WAA1B,CAAsC,KAAKhE,IAAL,CAAUwB,MAAhD;AACA,qBAAK6B,oBAAL,CAA0BY,QAA1B,CAAmC,KAAKd,GAAL,CAASN,IAAT,CAAc,yBAAd,CAAnC;AACH,aAND;AAOH,SA1JsB;AA4JvBqB,oBA5JuB,0BA4JP;AACZ,iBAAKC,YAAL;AACA,gBAAI,KAAK7C,SAAT,EAAoB;AAChB,qBAAK8C,gBAAL,CAAsB,KAAKC,mBAAL,EAAtB;AACH,aAFD,MAEO;AACH,qBAAKhB,oBAAL,CAA0BW,WAA1B,CAAsC,KAAKhE,IAAL,CAAUwB,MAAhD;AACH;AACJ,SAnKsB;AAqKvB2C,oBArKuB,0BAqKP;AACZ,gBAAI5C,OAAO,IAAX;AAAA,gBACI+C,MAAM,KAAKtE,IAAL,CAAUwB,MADpB;AAAA,gBAEI+C,kBAAkBD,IAAI3B,OAF1B;AAAA,gBAGI6B,aAAa,KAAKrB,GAAL,CAASN,IAAT,CAAc,cAAd,CAHjB;AAAA,gBAII4B,SAJJ;;AAMApG,cAAEqG,IAAF,CAAOF,UAAP,EAAmB,UAAUG,KAAV,EAAiB;AAChCF,4BAAYE,MAAMC,YAAN,CAAmB,YAAnB,CAAZ;;AAEA,oBAAID,MAAME,IAAN,KAAe,OAAnB,EAA4B;AACxB,wBAAIF,MAAMG,OAAV,EAAmB;AACfR,4BAAIG,SAAJ,IAAiBE,MAAMI,KAAvB;AACH;AACJ,iBAJD,MAIO;AACHT,wBAAIG,SAAJ,IAAiBE,MAAMI,KAAN,CAAYC,IAAZ,EAAjB;AACH;AACJ,aAVD;;AAYA,gBAAI,KAAK1D,SAAT,EAAoB;AAChB,oBAAIiD,oBAAoBD,IAAI3B,OAA5B,EAAqC;AACjCpB,yBAAK6C,gBAAL,CAAsB,KAAtB;AACA,yBAAKa,aAAL,GAAqBC,IAArB,CAA0B,YAAY;AAClC3D,6BAAK6C,gBAAL,CAAsB7C,KAAK8C,mBAAL,EAAtB;AACH,qBAFD;AAGH;AACJ,aAPD,MAOO;AACHC,oBAAIa,MAAJ,GAAa,KAAK3C,YAAL,CAAkB4C,QAAlB,EAAb;AACH;AACJ,SAlMsB;AAoMvBf,2BApMuB,iCAoMA;AACnB,mBAAO,KAAKrE,IAAL,CAAUwB,MAAV,CAAiBuB,IAAjB,IAAyB,KAAK/C,IAAL,CAAUwB,MAAV,CAAiBmB,OAA1C,IAAqD,KAAK3C,IAAL,CAAUwB,MAAV,CAAiB6D,QAA7E;AACH,SAtMsB;AAwMvBC,kBAxMuB,sBAwMXC,CAxMW,EAwMR;AACXA,cAAEC,cAAF;;AAEA,gBAAIjE,OAAO,IAAX;AAAA,gBACIkE,WADJ;AAAA,gBAEIC,wBAAwBrH,EAAEsH,KAAF,CAAQ,KAAKlG,KAAL,CAAWiC,UAAnB,CAF5B;;AAIA,iBAAKyC,YAAL;;AAEA9F,cAAEgB,MAAF,CAAS,KAAKI,KAAL,CAAWiC,UAApB,EAAgC,EAAEkE,aAAa,EAAf,EAAhC,EAAqD,KAAK5F,IAAL,CAAUwB,MAA/D;AACAiE,0BAAc,KAAKhG,KAAL,CAAWoG,IAAX,EAAd;;AAEA,gBAAIJ,WAAJ,EAAiB;AACbA,4BAAY7D,IAAZ,CAAiB,YAAY;AACzB,wBAAIL,KAAKD,SAAT,EAAoB;AAChB1C,+BAAOkH,OAAP,CAAelH,OAAOmH,aAAP,CAAqBC,MAArB,CAA4BC,gBAA3C,EAA6D;AACzDpG,kCAAM,CAACqG,mBAAmB3E,KAAKvB,IAAL,CAAUC,SAA7B,CAAD,EAA0CsB,KAAK9B,KAAL,CAAWmD,EAArD,CADmD;AAEzDuD,qCAAS;AAFgD,yBAA7D;AAIH,qBALD,MAKO;AACHxH,qCAAayH,SAAb,CAAuBtH,UAAUuH,6BAAjC,EAAgE,cAAhE;AACH;AACJ,iBATD;AAUH,aAXD,MAWO;AACHhI,kBAAEgB,MAAF,CAAS,KAAKI,KAAL,CAAWiC,UAApB,EAAgCgE,qBAAhC;AACA/G,6BAAayH,SAAb,CAAuBtH,UAAUuH,6BAAjC,EAAgE,KAAK5G,KAAL,CAAW6G,eAA3E;AACH;AACJ,SAnOsB;AAqOvBC,sBArOuB,4BAqOL;AACd,gBAAIC,aAAa,KAAKhE,YAAL,CAAkB4C,QAAlB,EAAjB;AAAA,gBACIC,WAAW,KAAKrF,IAAL,CAAUwB,MAAV,CAAiB6D,QADhC;AAAA,gBAEIF,MAFJ;AAAA,gBAGI5D,OAAO,IAHX;;AAKA4D,qBAAS;AACLA,wBAAQtG,OAAO4H,UAAP,CAAkBD,UAAlB,CADH;AAELnB;AAFK,aAAT;;AAKApG,gCAAoBsH,cAApB,CAAmCpB,MAAnC,EAA2CvD,IAA3C,CAAgD,UAAUK,MAAV,EAAkB;AAC9DlD,wBAAQ2H,oBAAR,CAA6B,oEAA7B,EACIzE,MADJ,EAEI,UAAU0E,GAAV,EAAe;AACXpF,yBAAK4B,GAAL,CAASN,IAAT,CAAc,aAAd,EAA6B+D,IAA7B,CAAkCD,GAAlC;AACH,iBAJL;AAKH,aAND,EAMGE,IANH,CAMQ,UAAUC,QAAV,EAAoB;AACxBrI,yBAASsI,UAAT,CAAoB;AAChBlC,0BAAMpG,SAASuI,WADC;AAEhBF;AAFgB,iBAApB;AAIH,aAXD;AAYH,SA5PsB;AA8PvBG,oBA9PuB,0BA8PP;AACZ,iBAAK9D,GAAL,CAASN,IAAT,CAAc,eAAd,EAA+BsD,OAA/B,CAAuC,OAAvC;AACH,SAhQsB;AAkQvBe,wBAlQuB,4BAkQL3B,CAlQK,EAkQF;AACjB,gBAAIhE,OAAO,IAAX;AAAA,gBACI4F,OAAO5B,EAAE6B,MAAF,CAASC,KAAT,CAAe,CAAf,CADX;AAAA,gBAEIC,SAAS,IAAIC,UAAJ,EAFb;;AAIAD,mBAAOE,MAAP,GAAiB,YAAY;AACzB,uBAAO,UAAUjC,CAAV,EAAa;AAChBhE,yBAAKiB,YAAL,CAAkBiF,QAAlB,CAA2BlC,EAAE6B,MAAF,CAASnF,MAApC;AACH,iBAFD;AAGH,aAJgB,CAIfkF,IAJe,CAAjB;;AAMAG,mBAAOI,UAAP,CAAkBP,IAAlB;AACH,SA9QsB;AAgRvBQ,kBAhRuB,wBAgRT;AACV,gBAAIpG,OAAO,IAAX;;AAEA,gBAAI,KAAKvB,IAAL,CAAUkC,cAAd,EAA8B;AAC1BX,qBAAKqG,YAAL;AACH,aAFD,MAEO;AACH,qBAAKrH,qBAAL,CAA2BqB,IAA3B,CAAgC,UAAUe,OAAV,EAAmB;AAC/CpB,yBAAKvB,IAAL,CAAUkC,cAAV,GAA2BS,QAAQT,cAAnC;AACAX,yBAAKqG,YAAL;AACH,iBAHD;AAIH;AACJ,SA3RsB;AA6RvBA,oBA7RuB,0BA6RP;AACZtJ,4BAAgBuJ,IAAhB,CAAqB,KAAKC,sBAAL,EAArB;AACH,SA/RsB;AAiSvBA,8BAjSuB,oCAiSG;AACtB,gBAAIvG,OAAO,IAAX;AAAA,gBACIwG,gBAAgB,EADpB;AAAA,gBAEIC,UAAU;AACNnD,sBAAMvG,gBAAgB0I,WADhB;AAENjG,uBAAO3C,EAAE6J,CAAF,CAAI,mCAAJ,CAFD;AAGNC,0BAAU,uBAHJ;AAINC,yBAAS/J,EAAE,aAAF,CAJH;AAKNgK,sBALM,oBAKI;AACN,wBAAIC,SAAS,IAAb;AACAtJ,4BAAQ2H,oBAAR,CAA6B,iEAA7B,EACInF,KAAKvB,IADT,EAEI,UAAU2G,GAAV,EAAe;AACX0B,+BAAOF,OAAP,CAAeG,MAAf,CAAsB3B,GAAtB;AACH,qBAJL;AAKH;AAZK,aAFd;;AAiBAoB,0BAAcQ,IAAd,CAAmB;AACfC,uBAAOpK,EAAE6J,CAAF,CAAI,oBAAJ,CADQ;AAEfC,0BAAU,aAFK;AAGfO,sBAHe,kBAGPJ,MAHO,EAGC;AACZA,2BAAOK,KAAP;AACH;AALc,aAAnB,EAMG;AACCF,uBAAOpK,EAAE6J,CAAF,CAAI,oBAAJ,CADR;AAECC,0BAAU,YAFX;AAGCO,sBAHD,kBAGSJ,MAHT,EAGiB;AACZ,wBAAIM,cAAcN,OAAOO,aAAP,CAAqB/F,IAArB,CAA0B,8BAA1B,CAAlB;AAAA,wBACIgG,aAAaF,YAAYG,GAAZ,EADjB;AAAA,wBAEIC,iBAAiBJ,YAAYK,MAAZ,GAAqBC,IAArB,GAA4BjE,IAA5B,EAFrB;AAGA,wBAAIzD,KAAKvB,IAAL,CAAUwB,MAAV,CAAiBmB,OAAjB,KAA6BkG,UAAjC,EAA6C;AACzCtH,6BAAKvB,IAAL,CAAUwB,MAAV,CAAiBmB,OAAjB,GAA2BkG,UAA3B;AACAtH,6BAAKvB,IAAL,CAAU8C,WAAV,GAAwBiG,cAAxB;AACAxH,6BAAK0D,aAAL,GAAqBrD,IAArB,CAA0BvD,EAAEgE,IAAF,CAAOd,KAAKqC,YAAZ,EAA0BrC,IAA1B,CAA1B;AACH;AACD8G,2BAAOK,KAAP;AACH;AAbF,aANH;;AAsBAV,oBAAQkB,OAAR,GAAkBnB,aAAlB;;AAEA,mBAAOC,OAAP;AACH,SA5UsB;AA8UvB/C,qBA9UuB,2BA8UN;AACb,gBAAI1D,OAAO,IAAX;AAAA,gBACI4H,kBAAkB9K,EAAEwE,IAAF,CAAO,KAAK7C,IAAL,CAAU2B,QAAjB,EAA2B,UAAUgB,OAAV,EAAmB;AAC5D,uBAAOA,QAAQzB,GAAR,KAAgBK,KAAKvB,IAAL,CAAUwB,MAAV,CAAiBmB,OAAxC;AACH,aAFiB,CADtB;AAAA,gBAIIyG,aAJJ;AAAA,gBAKIC,UAAUjL,EAAEkL,QAAF,EALd;;AAOA,iBAAKtJ,IAAL,CAAUgD,SAAV,GAAsB,KAAKC,gBAAL,CAAsBkG,gBAAgBnG,SAAtC,CAAtB;;AAEA,gBAAImG,gBAAgBC,aAAhB,KAAkC,SAAtC,EAAiD;AAC7C,qBAAKpJ,IAAL,CAAUwB,MAAV,CAAiB2D,MAAjB,GAA0B,EAA1B;AACA,oBAAI,KAAKnF,IAAL,CAAUgD,SAAV,CAAoB7C,MAApB,KAA+B,CAAnC,EAAsC;AAClC,yBAAKH,IAAL,CAAUwB,MAAV,CAAiB6D,QAAjB,GAA4B,KAAKrF,IAAL,CAAUgD,SAAV,CAAoB,CAApB,EAAuBJ,EAAnD;AACH,iBAFD,MAEO;AACH,yBAAK5C,IAAL,CAAUwB,MAAV,CAAiB6D,QAAjB,GAA4B,EAA5B;AACH;AACDgE,wBAAQE,OAAR;AACH,aARD,MAQO;AACHH,gCAAgB,IAAIpK,MAAJ,CAAW,EAAEkC,KAAKiI,gBAAgBC,aAAvB,EAAX,CAAhB;AACA,qBAAKjI,QAAL,CAAciI,aAAd,EAA6B,MAA7B,EAAqC,UAAU3J,KAAV,EAAiB;AAClD,wBAAI8B,KAAKvB,IAAL,CAAUgD,SAAV,CAAoB7C,MAApB,KAA+B,CAAnC,EAAsC;AAClCoB,6BAAKvB,IAAL,CAAUwB,MAAV,CAAiB6D,QAAjB,GAA4B9D,KAAKvB,IAAL,CAAUgD,SAAV,CAAoB,CAApB,EAAuBJ,EAAnD;AACH,qBAFD,MAEO;AACHrB,6BAAKvB,IAAL,CAAUwB,MAAV,CAAiB6D,QAAjB,GAA4B5F,MAAMiC,UAAN,CAAiB2D,QAA7C;AACH;AACD9D,yBAAKvB,IAAL,CAAUwB,MAAV,CAAiB2D,MAAjB,GAA0B1F,MAAMiC,UAAN,CAAiByD,MAA3C;AACAkE,4BAAQE,OAAR;AACH,iBARD;AASAH,8BAAc/H,KAAd;AACH;;AAED,mBAAOgI,OAAP;AACH,SA/WsB;AAiXvBtF,wBAjXuB,8BAiXH;AAChB,iBAAKvB,YAAL,GAAoBjE,WAAWiL,YAAX,CAAwB,KAAKrG,GAAL,CAASN,IAAT,CAAc,SAAd,EAAyB,CAAzB,CAAxB,EAAqD;AACrE4G,6BAAa,IADwD;AAErEC,2BAAW,IAF0D;AAGrEC,gCAAgBC,QAHqD;AAIrEC,sBAAM,KAAK7J,IAAL,CAAUwB,MAAV,CAAiB6D,QAAjB,CAA0ByE,WAA1B,EAJ+D;AAKrEC,uBAAO;AAL8D,aAArD,CAApB;;AAQA,iBAAKvH,YAAL,CAAkBwH,EAAlB,CAAqB,QAArB,EAA+B3L,EAAEgE,IAAF,CAAO,KAAK6B,YAAZ,EAA0B,IAA1B,CAA/B;AACH,SA3XsB;AA6XvB+F,wBA7XuB,4BA6XL1E,CA7XK,EA6XF;AACjB,iBAAK2E,cAAL,CAAoB3E,EAAE6B,MAAF,CAASrC,KAA7B;AACH,SA/XsB;AAiYvBmF,sBAjYuB,0BAiYPC,IAjYO,EAiYD;AAClB,iBAAKnK,IAAL,CAAUwB,MAAV,CAAiB6D,QAAjB,GAA4B8E,IAA5B;AACA,iBAAK3H,YAAL,CAAkBC,SAAlB,CAA4B,MAA5B,EAAoC0H,KAAKL,WAAL,EAApC;AACH,SApYsB;AAsYvBhG,wBAtYuB,8BAsYH;AAChB;AACA;AACA;AACA;AACA,gBAAIxB,OAAO8H,IAAP,IAAe9H,OAAOiF,UAAtB,IAAoCjF,OAAO+H,QAA/C,EAAyD;AACrD,qBAAKlH,GAAL,CAASN,IAAT,CAAc,uBAAd,EAAuCgF,IAAvC;AACH;AACJ,SA9YsB;;;AAgZvB;;;;;AAKA1F,uBArZuB,2BAqZNR,QArZM,EAqZI2I,MArZJ,EAqZY;AAC/B,gBAAIC,CAAJ;AAAA,gBACIC,KADJ;AAAA,gBAEIrK,SAASwB,SAASxB,MAFtB;AAGA,gBAAImK,UAAUA,OAAOG,UAAjB,IAA+BH,OAAOG,UAAP,CAAkBvI,cAArD,EAAqE;AACjE,qBAAKqI,IAAI,CAAT,EAAYA,IAAIpK,MAAhB,EAAwBoK,GAAxB,EAA6B;AACzBC,4BAAQnM,EAAEqM,OAAF,CAAUJ,OAAOG,UAAP,CAAkBvI,cAAlB,CAAiC,MAAjC,CAAV,EAAoDP,SAAS4I,CAAT,EAAYrJ,GAAhE,CAAR;AACAS,6BAAS4I,CAAT,EAAYxH,IAAZ,GAAmBuH,OAAOG,UAAP,CAAkBvI,cAAlB,CAAiC8F,OAAjC,CAAyC2C,WAAzC,CAAqDH,KAArD,CAAnB;AACH;AACJ;AACJ,SA/ZsB;;;AAiavB;;;;;AAKAvH,wBAtauB,4BAsaLD,SAtaK,EAsaM;AACzB,gBAAIf,MAAJ;AAAA,gBACIsI,CADJ;AAAA,gBAEIpK,SAAS6C,UAAU7C,MAFvB;AAAA,gBAGIqK,KAHJ;AAIA,gBAAI,KAAK3I,UAAL,IAAmB,KAAKA,UAAL,CAAgB4I,UAAnC,IAAiD,KAAK5I,UAAL,CAAgB4I,UAAhB,CAA2BzH,SAA5E,IACA,KAAKnB,UAAL,CAAgB4I,UAAhB,CAA2BzH,SAA3B,CAAqC4H,KADzC,EACgD;AAC5C3I,yBAAS,EAAT;AACA,qBAAKsI,IAAI,CAAT,EAAYA,IAAIpK,MAAhB,EAAwBoK,GAAxB,EAA6B;AACzBC,4BAAQnM,EAAEqM,OAAF,CAAU,KAAK7I,UAAL,CAAgB4I,UAAhB,CAA2BzH,SAA3B,CAAqC4H,KAArC,CAA2C,MAA3C,CAAV,EAA8D5H,UAAUuH,CAAV,CAA9D,CAAR;AACAtI,2BAAOsI,CAAP,IAAY;AACR3H,4BAAII,UAAUuH,CAAV,CADI;AAERxH,8BAAM,KAAKlB,UAAL,CAAgB4I,UAAhB,CAA2BzH,SAA3B,CAAqC4H,KAArC,CAA2C5C,OAA3C,CAAmD2C,WAAnD,CAA+DH,KAA/D;AAFE,qBAAZ;AAIH;AACJ;AACD,mBAAOvI,MAAP;AACH,SAvbsB;AAybvB4I,qBAzbuB,yBAybRtF,CAzbQ,EAybL;AACdA,cAAEC,cAAF;;AAEArG,uBAAW2L,8BAAX,CAA0C,EAAEjG,MAAMzG,EAAE6J,CAAF,CAAI,6BAAJ,CAAR,EAA1C,EACI5J,EAAEgE,IAAF,CAAO,KAAK0I,YAAZ,EAA0B,IAA1B,CADJ;AAEH,SA9bsB;AAgcvBA,oBAhcuB,0BAgcP;AACZ,gBAAIxJ,OAAO,IAAX;AAAA,gBACIyJ,YAAY,SAAZA,SAAY,GAAY;AACpBpM,uBAAOkH,OAAP,CAAelH,OAAOmH,aAAP,CAAqBC,MAArB,CAA4BiF,aAA3C,EAA0D;AACtDpL,0BAAM,CAACqG,mBAAmB3E,KAAKvB,IAAL,CAAUC,SAA7B,CAAD,CADgD;AAEtDkG,6BAAS;AAF6C,iBAA1D;AAIAxH,6BAAayH,SAAb,CAAuBtH,UAAUuH,6BAAjC,EAAgE,cAAhE;AACH,aAPL;;AASA,iBAAK5G,KAAL,CAAWyL,OAAX,CAAmB;AACfC,yBAASH,SADM;AAEfI,sBAAM;AAFS,aAAnB;AAIH,SA9csB;AAgdvBC,sBAhduB,4BAgdL;AACd,iBAAKC,gBAAL,CAAsB,IAAtB;AACH,SAldsB;AAodvBC,sBApduB,4BAodL;AACd,iBAAKD,gBAAL,CAAsB,KAAtB;AACH,SAtdsB;AAwdvBA,wBAxduB,4BAwdLE,UAxdK,EAwdO;AAC1B,iBAAKhJ,YAAL,CAAkBC,SAAlB,CAA4B,YAA5B,EAA0C+I,UAA1C;AACA,iBAAKrI,GAAL,CAASN,IAAT,CAAc,kBAAd,EAAkC4I,MAAlC,CAAyCD,UAAzC;AACH,SA3dsB;AA6dvBpH,wBA7duB,4BA6dLsH,IA7dK,EA6dC;AACpB,iBAAKvI,GAAL,CAASN,IAAT,CAAc,aAAd,EAA6B8I,IAA7B,CAAkC,UAAlC,EAA8C,CAACD,IAA/C;AACH;AA/dsB,KAApB,CAAP;AAieH,CA1fD","file":"EditScriptView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/components/BootstrapDialog\",\n    \"libs/codemirror/lib/codemirror\",\n    \"org/forgerock/commons/ui/common/components/ChangesPending\",\n    \"org/forgerock/commons/ui/common/components/Messages\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/commons/ui/common/main/Router\",\n    \"org/forgerock/commons/ui/common/util/Base64\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\n    \"org/forgerock/openam/ui/admin/models/scripts/ScriptModel\",\n    \"org/forgerock/openam/ui/admin/services/realm/ScriptsService\",\n    \"org/forgerock/openam/ui/admin/services/global/ScriptsService\",\n    \"org/forgerock/openam/ui/admin/utils/FormHelper\",\n    \"org/forgerock/openam/ui/common/util/Promise\",\n    \"libs/codemirror/mode/groovy/groovy\",\n    \"libs/codemirror/mode/javascript/javascript\",\n    \"libs/codemirror/addon/display/fullscreen\",\n    // jquery dependencies\n    \"selectize\"\n], function ($, _, BootstrapDialog, CodeMirror, ChangesPending, Messages, AbstractView, EventManager, Router, Base64,\n             Constants, UIUtils, Script, RealmScriptsService, GlobalScriptsService, FormHelper, Promise) {\n    return AbstractView.extend({\n        initialize () {\n            AbstractView.prototype.initialize.call(this);\n            this.model = null;\n        },\n        partials: [\n            \"partials/alerts/_Alert.html\"\n        ],\n        events: {\n            \"click [data-upload-script]\": \"uploadScript\",\n            \"change [name=upload]\": \"readUploadedFile\",\n            \"click [data-validation-script]\": \"validateScript\",\n            \"click [data-change-context]\": \"openDialog\",\n            \"change input[name=language]\": \"onChangeLanguage\",\n            \"click [data-save]\": \"submitForm\",\n            \"click [data-delete]\": \"onDeleteClick\",\n            \"click [data-show-fullscreen]\": \"editFullScreen\",\n            \"click [data-exit-fullscreen]\": \"exitFullScreen\",\n            \"change [data-field]\": \"checkChanges\",\n            \"keyup [data-field]\": \"checkChanges\"\n        },\n\n        render (args, callback) {\n            var uuid = null;\n\n            this.data.realmPath = args[0];\n\n            // As we interrupt render to update the model, we need to remember the callback\n            if (callback) {\n                this.renderCallback = callback;\n            }\n\n            // Realm location is the first argument, second one is the script uuid\n            if (args.length === 2) {\n                uuid = args[1];\n            }\n\n            this.contextsPromise = GlobalScriptsService.scripts.getAllContexts();\n            this.defaultContextPromise = GlobalScriptsService.scripts.getDefaultGlobalContext();\n            this.contextSchemaPromise = GlobalScriptsService.scripts.getSchema();\n            this.languageSchemaPromise = GlobalScriptsService.scripts.getContextSchema();\n\n            if (uuid) {\n                this.data.headerActions = [\n                    { actionPartial: \"form/_Button\", data:\"delete\", title:\"common.form.delete\", icon:\"fa-times\" }\n                ];\n                this.template = \"templates/admin/views/realms/scripts/EditScriptTemplate.html\";\n                this.model = new Script({ _id: uuid });\n                this.listenTo(this.model, \"sync\", this.renderAfterSyncModel);\n                this.model.fetch();\n            } else {\n                this.template = \"templates/admin/views/realms/scripts/NewScriptTemplate.html\";\n                this.newEntity = true;\n                this.model = new Script();\n                this.renderAfterSyncModel();\n            }\n        },\n\n        /**\n         * So the uuid can be omitted to the render function for two reasons:\n         * 1. need to create a new script\n         * 2. the render function is called from the function onModelSync\n         * Then there is a conflict in the function syncModel.\n         * In the first case we should to create a new model, in second case is not create.\n         * So the render function is divided into two parts, so as not to cause a re-check and avoid the second case.\n         */\n        renderAfterSyncModel () {\n            var self = this;\n\n            this.data.entity = _.pick(this.model.attributes,\n                \"uuid\", \"name\", \"description\", \"language\", \"context\", \"script\");\n\n            if (this.data.contexts) {\n                self.languageSchemaPromise.done(function (langSchema) {\n                    self.langSchema = langSchema;\n                    self.renderScript();\n                });\n            } else {\n                Promise.all([self.contextsPromise, self.defaultContextPromise, self.contextSchemaPromise,\n                    self.languageSchemaPromise]).done(\n                    function (results) {\n                        self.data.contexts = results[0][0].result;\n                        self.data.defaultContext = results[1][0].defaultContext;\n                        self.addContextNames(self.data.contexts, results[2][0]);\n                        self.langSchema = results[3][0];\n                        self.renderScript();\n                    });\n            }\n\n            self.cleanupAfterCodemirror = _.bind(self.cleanupAfterCodemirror, self);\n            window.addEventListener(\"hashchange\", self.cleanupAfterCodemirror);\n        },\n\n        cleanupAfterCodemirror () {\n            // When codemirror is in a full screen mode, it adds \"overflow: hidden\" to the document. Pressing back\n            // button while in full screen doesn't remove the style, hence breaking the scrolling for the app\n            if (this.scriptEditor) {\n                this.scriptEditor.setOption(\"fullScreen\", false);\n                window.removeEventListener(\"hashchange\", this.cleanupAfterCodemirror);\n            }\n        },\n\n        renderScript () {\n            var self = this,\n                context;\n\n            if (this.model.id) {\n                context = _.find(this.data.contexts, function (context) {\n                    return context._id === self.data.entity.context;\n                });\n                this.data.contextName = context.name;\n                this.data.languages = this.addLanguageNames(context.languages);\n            } else {\n                this.data.languages = [];\n            }\n\n            this.parentRender(function () {\n                if (this.newEntity) {\n                    this.$el.find(\"#context\").selectize();\n                } else {\n                    this.changesPendingWidget = ChangesPending.watchChanges({\n                        element: this.$el.find(\".script-changes-pending\"),\n                        watchedObj: this.data.entity,\n                        undo: !this.newEntity,\n                        undoCallback (changes) {\n                            _.extend(self.data.entity, changes);\n                            var context = _.find(self.data.contexts, {\n                                \"_id\": self.data.entity.context\n                            });\n                            self.data.contextName = context.name;\n                            self.data.languages = self.addLanguageNames(context.languages);\n                            self.reRenderView();\n                        },\n                        alertClass: \"alert-warning alert-sm\"\n                    });\n\n                    this.showUploadButton();\n                    this.initScriptEditor();\n                }\n\n                if (this.renderCallback) {\n                    this.renderCallback();\n                }\n            });\n        },\n\n        reRenderView () {\n            this.parentRender(function () {\n                this.showUploadButton();\n                this.initScriptEditor();\n\n                this.changesPendingWidget.makeChanges(this.data.entity);\n                this.changesPendingWidget.reRender(this.$el.find(\".script-changes-pending\"));\n            });\n        },\n\n        checkChanges () {\n            this.updateFields();\n            if (this.newEntity) {\n                this.toggleSaveButton(this.checkRequiredFields());\n            } else {\n                this.changesPendingWidget.makeChanges(this.data.entity);\n            }\n        },\n\n        updateFields () {\n            var self = this,\n                app = this.data.entity,\n                previousContext = app.context,\n                dataFields = this.$el.find(\"[data-field]\"),\n                dataField;\n\n            _.each(dataFields, function (field) {\n                dataField = field.getAttribute(\"data-field\");\n\n                if (field.type === \"radio\") {\n                    if (field.checked) {\n                        app[dataField] = field.value;\n                    }\n                } else {\n                    app[dataField] = field.value.trim();\n                }\n            });\n\n            if (this.newEntity) {\n                if (previousContext !== app.context) {\n                    self.toggleSaveButton(false);\n                    this.changeContext().then(function () {\n                        self.toggleSaveButton(self.checkRequiredFields());\n                    });\n                }\n            } else {\n                app.script = this.scriptEditor.getValue();\n            }\n        },\n\n        checkRequiredFields () {\n            return this.data.entity.name && this.data.entity.context && this.data.entity.language;\n        },\n\n        submitForm (e) {\n            e.preventDefault();\n\n            var self = this,\n                savePromise,\n                nonModifiedAttributes = _.clone(this.model.attributes);\n\n            this.updateFields();\n\n            _.extend(this.model.attributes, { description: \"\" }, this.data.entity);\n            savePromise = this.model.save();\n\n            if (savePromise) {\n                savePromise.done(function () {\n                    if (self.newEntity) {\n                        Router.routeTo(Router.configuration.routes.realmsScriptEdit, {\n                            args: [encodeURIComponent(self.data.realmPath), self.model.id],\n                            trigger: true\n                        });\n                    } else {\n                        EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"changesSaved\");\n                    }\n                });\n            } else {\n                _.extend(this.model.attributes, nonModifiedAttributes);\n                EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, this.model.validationError);\n            }\n        },\n\n        validateScript () {\n            var scriptText = this.scriptEditor.getValue(),\n                language = this.data.entity.language,\n                script,\n                self = this;\n\n            script = {\n                script: Base64.encodeUTF8(scriptText),\n                language\n            };\n\n            RealmScriptsService.validateScript(script).done(function (result) {\n                UIUtils.fillTemplateWithData(\"templates/admin/views/realms/scripts/ScriptValidationTemplate.html\",\n                    result,\n                    function (tpl) {\n                        self.$el.find(\"#validation\").html(tpl);\n                    });\n            }).fail(function (response) {\n                Messages.addMessage({\n                    type: Messages.TYPE_DANGER,\n                    response\n                });\n            });\n        },\n\n        uploadScript () {\n            this.$el.find(\"[name=upload]\").trigger(\"click\");\n        },\n\n        readUploadedFile (e) {\n            var self = this,\n                file = e.target.files[0],\n                reader = new FileReader();\n\n            reader.onload = (function () {\n                return function (e) {\n                    self.scriptEditor.setValue(e.target.result);\n                };\n            }(file));\n\n            reader.readAsText(file);\n        },\n\n        openDialog () {\n            var self = this;\n\n            if (this.data.defaultContext) {\n                self.renderDialog();\n            } else {\n                this.defaultContextPromise.done(function (context) {\n                    self.data.defaultContext = context.defaultContext;\n                    self.renderDialog();\n                });\n            }\n        },\n\n        renderDialog () {\n            BootstrapDialog.show(this.constructDialogOptions());\n        },\n\n        constructDialogOptions () {\n            var self = this,\n                footerButtons = [],\n                options = {\n                    type: BootstrapDialog.TYPE_DANGER,\n                    title: $.t(\"console.scripts.edit.dialog.title\"),\n                    cssClass: \"script-change-context\",\n                    message: $(\"<div></div>\"),\n                    onshow () {\n                        var dialog = this;\n                        UIUtils.fillTemplateWithData(\"templates/admin/views/realms/scripts/ChangeContextTemplate.html\",\n                            self.data,\n                            function (tpl) {\n                                dialog.message.append(tpl);\n                            });\n                    }\n                };\n\n            footerButtons.push({\n                label: $.t(\"common.form.cancel\"),\n                cssClass: \"btn-default\",\n                action (dialog) {\n                    dialog.close();\n                }\n            }, {\n                label: $.t(\"common.form.change\"),\n                cssClass: \"btn-danger\",\n                action (dialog) {\n                    var checkedItem = dialog.$modalContent.find(\"[name=changeContext]:checked\"),\n                        newContext = checkedItem.val(),\n                        newContextName = checkedItem.parent().text().trim();\n                    if (self.data.entity.context !== newContext) {\n                        self.data.entity.context = newContext;\n                        self.data.contextName = newContextName;\n                        self.changeContext().done(_.bind(self.reRenderView, self));\n                    }\n                    dialog.close();\n                }\n            });\n\n            options.buttons = footerButtons;\n\n            return options;\n        },\n\n        changeContext () {\n            var self = this,\n                selectedContext = _.find(this.data.contexts, function (context) {\n                    return context._id === self.data.entity.context;\n                }),\n                defaultScript,\n                promise = $.Deferred();\n\n            this.data.languages = this.addLanguageNames(selectedContext.languages);\n\n            if (selectedContext.defaultScript === \"[Empty]\") {\n                this.data.entity.script = \"\";\n                if (this.data.languages.length === 1) {\n                    this.data.entity.language = this.data.languages[0].id;\n                } else {\n                    this.data.entity.language = \"\";\n                }\n                promise.resolve();\n            } else {\n                defaultScript = new Script({ _id: selectedContext.defaultScript });\n                this.listenTo(defaultScript, \"sync\", function (model) {\n                    if (self.data.languages.length === 1) {\n                        self.data.entity.language = self.data.languages[0].id;\n                    } else {\n                        self.data.entity.language = model.attributes.language;\n                    }\n                    self.data.entity.script = model.attributes.script;\n                    promise.resolve();\n                });\n                defaultScript.fetch();\n            }\n\n            return promise;\n        },\n\n        initScriptEditor () {\n            this.scriptEditor = CodeMirror.fromTextArea(this.$el.find(\"#script\")[0], {\n                lineNumbers: true,\n                autofocus: true,\n                viewportMargin: Infinity,\n                mode: this.data.entity.language.toLowerCase(),\n                theme: \"forgerock\"\n            });\n\n            this.scriptEditor.on(\"update\", _.bind(this.checkChanges, this));\n        },\n\n        onChangeLanguage (e) {\n            this.changeLanguage(e.target.value);\n        },\n\n        changeLanguage (lang) {\n            this.data.entity.language = lang;\n            this.scriptEditor.setOption(\"mode\", lang.toLowerCase());\n        },\n\n        showUploadButton () {\n            // Show the Upload button for modern browsers only. Documented feature.\n            // File: Chrome 13; Firefox (Gecko) 3.0 (1.9) (non standard), 7 (7) (standard); Internet Explorer 10.0;\n            //       Opera 11.5; Safari (WebKit) 6.0\n            // FileReader: Firefox (Gecko) 3.6 (1.9.2);\tChrome 7; Internet Explorer 10; Opera 12.02; Safari 6.0.2\n            if (window.File && window.FileReader && window.FileList) {\n                this.$el.find(\"[data-upload-scripts]\").show();\n            }\n        },\n\n        /**\n         * Update context's array using translation from Schema.\n         * @param  {Array} contexts Array with script contexts\n         * @param  {Object} schema Script schema with translations\n         */\n        addContextNames (contexts, schema) {\n            var i,\n                index,\n                length = contexts.length;\n            if (schema && schema.properties && schema.properties.defaultContext) {\n                for (i = 0; i < length; i++) {\n                    index = _.indexOf(schema.properties.defaultContext[\"enum\"], contexts[i]._id);\n                    contexts[i].name = schema.properties.defaultContext.options.enum_titles[index];\n                }\n            }\n        },\n\n        /**\n         * Merge script IDs from Context and translation from Schema to the Language array.\n         * @param  {Array} languages Language IDs from Context\n         * @returns {Array} result combined array\n         */\n        addLanguageNames (languages) {\n            var result,\n                i,\n                length = languages.length,\n                index;\n            if (this.langSchema && this.langSchema.properties && this.langSchema.properties.languages &&\n                this.langSchema.properties.languages.items) {\n                result = [];\n                for (i = 0; i < length; i++) {\n                    index = _.indexOf(this.langSchema.properties.languages.items[\"enum\"], languages[i]);\n                    result[i] = {\n                        id: languages[i],\n                        name: this.langSchema.properties.languages.items.options.enum_titles[index]\n                    };\n                }\n            }\n            return result;\n        },\n\n        onDeleteClick (e) {\n            e.preventDefault();\n\n            FormHelper.showConfirmationBeforeDeleting({ type: $.t(\"console.scripts.edit.script\") },\n                _.bind(this.deleteScript, this));\n        },\n\n        deleteScript () {\n            var self = this,\n                onSuccess = function () {\n                    Router.routeTo(Router.configuration.routes.realmsScripts, {\n                        args: [encodeURIComponent(self.data.realmPath)],\n                        trigger: true\n                    });\n                    EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"changesSaved\");\n                };\n\n            this.model.destroy({\n                success: onSuccess,\n                wait: true\n            });\n        },\n\n        editFullScreen () {\n            this.toggleFullScreen(true);\n        },\n\n        exitFullScreen () {\n            this.toggleFullScreen(false);\n        },\n\n        toggleFullScreen (fullScreen) {\n            this.scriptEditor.setOption(\"fullScreen\", fullScreen);\n            this.$el.find(\".full-screen-bar\").toggle(fullScreen);\n        },\n\n        toggleSaveButton (flag) {\n            this.$el.find(\"[data-save]\").prop(\"disabled\", !flag);\n        }\n    });\n});\n"]}