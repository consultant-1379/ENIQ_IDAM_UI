{"version":3,"sources":["../../../../../../../XUI/org/forgerock/commons/ui/common/main/ViewManager.js"],"names":["define","$","_","msg","AbstractView","ModuleLoader","obj","decodeArgs","args","map","a","decodeURIComponent","isBackboneView","view","render","isFunction","isReactView","currentView","currentDialog","currentViewArgs","currentDialogArgs","changeView","viewPath","callback","forceUpdate","decodedArgs","isEqual","load","then","dialog","close","prototype","modal","messages","hideMessages","__esModule","default","init","require","ReactAdapterView","reactView","Error","rebind","showDialog","dialogPath","refresh","cDialog","cDialogArgs"],"mappings":"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","file":"ViewManager.js","sourcesContent":["/**\r\n * The contents of this file are subject to the terms of the Common Development and\r\n * Distribution License (the License). You may not use this file except in compliance with the\r\n * License.\r\n *\r\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\r\n * specific language governing permission and limitations under the License.\r\n *\r\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\r\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\r\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\r\n * information: \"Portions copyright [year] [name of copyright owner]\".\r\n *\r\n * Copyright 2012-2016 ForgeRock AS.\r\n */\r\n/* eslint-disable */\r\n define([\r\n    \"jquery\",\r\n    \"underscore\",\r\n    \"org/forgerock/commons/ui/common/components/Messages\",\r\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\r\n    \"org/forgerock/commons/ui/common/util/ModuleLoader\"\r\n], function($, _, msg, AbstractView, ModuleLoader) {\r\n    var obj = {},\r\n        decodeArgs = function (args) {\r\n            return _.map(args, function (a) {\r\n                return (a && decodeURIComponent(a)) || \"\";\r\n            });\r\n        },\r\n        isBackboneView = function(view) { return view.render && !_.isFunction(view); },\r\n        isReactView = function(view) { return !view.render && _.isFunction(view); };\r\n\r\n    obj.currentView = null;\r\n    obj.currentDialog = null;\r\n    obj.currentViewArgs = null;\r\n    obj.currentDialogArgs = null;\r\n\r\n    /**\r\n     * Initializes view if it is not equal to current view.\r\n     * Changes URL without triggering event.\r\n     */\r\n    obj.changeView = function(viewPath, args, callback, forceUpdate) {\r\n        var decodedArgs = decodeArgs(args);\r\n\r\n        if(obj.currentView !== viewPath || forceUpdate || !_.isEqual(obj.currentViewArgs, args)) {\r\n            if(obj.currentDialog !== null) {\r\n                ModuleLoader.load(obj.currentDialog).then(function (dialog) {\r\n                    dialog.close();\r\n                });\r\n            }\r\n\r\n            //close all existing dialogs\r\n            if (typeof $.prototype.modal === \"function\") {\r\n                $('.modal.in').modal('hide');\r\n            }\r\n\r\n            obj.currentDialog = null;\r\n\r\n            msg.messages.hideMessages();\r\n            ModuleLoader.load(viewPath).then(function (view) {\r\n                // For ES6 modules, we require that the view is the default export.\r\n                if (view.__esModule) {\r\n                    view = view.default;\r\n                }\r\n\r\n                // TODO: Investigate whether this is required anymore\r\n                if (view.init) {\r\n                    view.init();\r\n                }\r\n\r\n                if (isBackboneView(view)) {\r\n                    view.render(decodedArgs, callback);\r\n                } else if (isReactView(view)) {\r\n                    // ReactAdapterView (and thus React and React-DOM) are only loaded when a React view is encountered\r\n                    require([\"org/forgerock/commons/ui/common/main/ReactAdapterView\"], function(ReactAdapterView) {\r\n                        (new ReactAdapterView({ reactView: view })).render();\r\n                    });\r\n                } else {\r\n                    throw new Error(\"[ViewManager] Unable to determine view type (Backbone or React).\");\r\n                }\r\n            });\r\n\r\n        } else {\r\n            ModuleLoader.load(obj.currentView).then(function (view) {\r\n                view.rebind();\r\n\r\n                if(callback) {\r\n                    callback();\r\n                }\r\n            });\r\n        }\r\n\r\n        obj.currentViewArgs = args;\r\n        obj.currentView = viewPath;\r\n    };\r\n\r\n    obj.showDialog = function(dialogPath, args, callback) {\r\n        var decodedArgs = decodeArgs(args);\r\n\r\n        if(obj.currentDialog !== dialogPath || !_.isEqual(obj.currentDialogArgs, decodedArgs)) {\r\n            msg.messages.hideMessages();\r\n            ModuleLoader.load(dialogPath).then(function (dialog) {\r\n                dialog.render(decodedArgs, callback);\r\n            });\r\n        }\r\n\r\n        if(obj.currentDialog !== null) {\r\n            ModuleLoader.load(obj.currentDialog).then(function (dialog) {\r\n                dialog.close();\r\n            });\r\n        }\r\n\r\n        obj.currentDialog = dialogPath;\r\n        obj.currentDialogArgs = decodedArgs;\r\n    };\r\n\r\n    obj.refresh = function() {\r\n        var cDialog = obj.currentDialog, cDialogArgs = obj.currentDialogArgs;\r\n\r\n        obj.changeView(obj.currentView, obj.currentViewArgs, function() {}, true);\r\n        if (cDialog && cDialog !== null) {\r\n            obj.showDialog(cDialog, cDialogArgs);\r\n        }\r\n    };\r\n\r\n    return obj;\r\n\r\n});"]}