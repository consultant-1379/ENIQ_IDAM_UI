{"version":3,"sources":["../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/deployment/sites/EditSiteView.js"],"names":["define","$","_","Messages","AbstractView","EventManager","Router","Constants","SitesService","FlatJSONSchemaView","FormHelper","Backlink","toggleSave","el","enable","find","prop","EditSitesView","extend","template","events","render","args","data","id","sites","get","then","name","values","raw","_id","etag","headerActions","actionPartial","title","icon","parentRender","jsonSchemaView","remove","schema","onRendered","$el","appendTo","onSave","update","getData","sendEvent","EVENT_DISPLAY_MESSAGE_REQUEST","response","addMessage","type","TYPE_DANGER","onDelete","event","preventDefault","showConfirmationBeforeDeleting","message","t","routeTo","configuration","routes","listSites","trigger"],"mappings":"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","file":"EditSiteView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2016-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/components/Messages\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/commons/ui/common/main/Router\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/openam/ui/admin/services/global/SitesService\",\n    \"org/forgerock/openam/ui/common/views/jsonSchema/FlatJSONSchemaView\",\n    \"org/forgerock/openam/ui/admin/utils/FormHelper\",\n    \"org/forgerock/openam/ui/admin/views/common/Backlink\",\n\n    // jquery dependencies\n    \"bootstrap-tabdrop\"\n], ($, _, Messages, AbstractView, EventManager, Router, Constants, SitesService, FlatJSONSchemaView, FormHelper,\n    Backlink) => { // eslint-disable-line padded-blocks\n\n    function toggleSave (el, enable) {\n        el.find(\"[data-save]\").prop(\"disabled\", !enable);\n    }\n\n    const EditSitesView = AbstractView.extend({\n        template: \"templates/admin/views/deployment/sites/EditSiteTemplate.html\",\n        events: {\n            \"click [data-save]\": \"onSave\",\n            \"click [data-delete]\": \"onDelete\"\n        },\n\n        render (args) {\n            this.data.id = args[0];\n            SitesService.sites.get(this.data.id).then((data) => {\n                this.data.name = data.values.raw._id;\n                this.data.etag = data.values.raw.etag;\n                this.data.headerActions = [{\n                    actionPartial: \"form/_Button\", data:\"delete\", title:\"common.form.delete\", icon:\"fa-times\"\n                }];\n\n                this.parentRender(() => {\n                    new Backlink().render();\n                    if (this.jsonSchemaView) {\n                        this.jsonSchemaView.remove();\n                    }\n                    this.jsonSchemaView = new FlatJSONSchemaView({\n                        schema: data.schema,\n                        values: data.values,\n                        onRendered: () => toggleSave(this.$el, true)\n                    });\n                    $(this.jsonSchemaView.render().el).appendTo(this.$el.find(\"[data-json-form]\"));\n                });\n            });\n        },\n\n        onSave () {\n            SitesService.sites.update(this.data.id, this.jsonSchemaView.getData(), this.data.etag)\n                .then(\n                    () => EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"changesSaved\"),\n                    (response) => Messages.addMessage({ response, type: Messages.TYPE_DANGER })\n                );\n        },\n\n        onDelete (event) {\n            event.preventDefault();\n\n            FormHelper.showConfirmationBeforeDeleting({\n                message: $.t(\"console.common.confirmDeleteText\", { type: $.t(\"console.sites.common.confirmType\") })\n            }, () => {\n                SitesService.sites.remove(this.data.id, this.data.etag).then(\n                    () => Router.routeTo(Router.configuration.routes.listSites, { args: [], trigger: true }),\n                    (response) => Messages.addMessage({ response, type: Messages.TYPE_DANGER })\n                );\n            });\n        }\n    });\n\n    return new EditSitesView();\n});\n"]}