{"version":3,"sources":["../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authorization/resourceTypes/EditResourceTypeView.js"],"names":["define","$","_","Messages","AbstractView","EventManager","Router","Constants","UIUtils","ResourceTypeModel","ResourceTypePatternsView","ResourceTypeActionsView","FormHelper","extend","partials","events","tabs","name","attr","onModelSync","renderAfterSyncModel","render","args","callback","uuid","data","realmPath","renderCallback","length","template","headerActions","actionPartial","title","icon","helpLink","model","listenTo","fetch","newEntity","self","entity","cloneDeep","attributes","actions","each","v","k","push","value","sort","initialActions","initialPatterns","patterns","parentRender","promises","resolve","Deferred","$el","find","tabdrop","renderSettings","patternsView","actionsList","when","done","setActiveTab","fillTemplateWithData","tpl","html","focus","updateFields","app","dataFields","dataField","field","getAttribute","type","checked","submitForm","e","preventDefault","savePromise","nonModifiedAttributes","clone","activeTab","activeTabProperties","activeTabId","pick","index","save","routeTo","configuration","routes","realmsResourceTypeEdit","map","id","encodeURIComponent","trigger","sendEvent","EVENT_DISPLAY_MESSAGE_REQUEST","validationError","onDeleteClick","showConfirmationBeforeDeleting","t","bind","deleteResourceType","onSuccess","realmsResourceTypes","onError","response","addMessage","TYPE_DANGER","destroy","success","error","wait"],"mappings":"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","file":"EditResourceTypeView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/components/Messages\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/main/EventManager\",\n    \"org/forgerock/commons/ui/common/main/Router\",\n    \"org/forgerock/commons/ui/common/util/Constants\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\n    \"org/forgerock/openam/ui/admin/models/authorization/ResourceTypeModel\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/resourceTypes/ResourceTypePatternsView\",\n    \"org/forgerock/openam/ui/admin/views/realms/authorization/resourceTypes/ResourceTypeActionsView\",\n    \"org/forgerock/openam/ui/admin/utils/FormHelper\",\n    \"bootstrap-tabdrop\"\n], function ($, _, Messages, AbstractView, EventManager, Router, Constants, UIUtils, ResourceTypeModel,\n             ResourceTypePatternsView, ResourceTypeActionsView, FormHelper) {\n    return AbstractView.extend({\n        partials: [\n            \"partials/util/_HelpLink.html\"\n        ],\n        events: {\n            \"click [data-save]\": \"submitForm\",\n            \"click [data-delete]\": \"onDeleteClick\"\n        },\n        tabs: [\n            { name: \"patterns\", attr: [\"patterns\"] },\n            { name: \"actions\", attr: [\"actions\"] },\n            { name: \"settings\", attr: [\"name\", \"description\"] }\n        ],\n\n        onModelSync () {\n            this.renderAfterSyncModel();\n        },\n\n        render (args, callback) {\n            var uuid;\n\n            this.data.realmPath = args[0];\n            if (callback) {\n                this.renderCallback = callback;\n            }\n\n            // Realm location is the first argument, second one is the resource type uuid\n            if (args.length === 2) {\n                uuid = args[1];\n            }\n\n            if (uuid) {\n                this.template =\n                    \"templates/admin/views/realms/authorization/resourceTypes/EditResourceTypeTemplate.html\";\n                this.data.headerActions = [\n                    { actionPartial: \"form/_Button\", data:\"delete\", title:\"common.form.delete\", icon:\"fa-times\" },\n                    { actionPartial: \"util/_HelpLink\", helpLink: \"backstage.authz.resourceTypes\" }\n                ];\n                this.model = new ResourceTypeModel({ uuid });\n                this.listenTo(this.model, \"sync\", this.onModelSync);\n                this.model.fetch();\n            } else {\n                this.template = \"templates/admin/views/realms/authorization/resourceTypes/NewResourceTypeTemplate.html\";\n                this.data.headerActions = [\n                    { actionPartial: \"util/_HelpLink\", helpLink: \"backstage.authz.resourceTypes\" }\n                ];\n                this.data.newEntity = true;\n                this.model = new ResourceTypeModel();\n                this.listenTo(this.model, \"sync\", this.onModelSync);\n                this.renderAfterSyncModel();\n            }\n        },\n\n        renderAfterSyncModel () {\n            var self = this,\n                data = this.data;\n            this.data.entity = _.cloneDeep(this.model.attributes);\n\n            data.actions = [];\n            _.each(this.data.entity.actions, function (v, k) {\n                data.actions.push({ name: k, value: v });\n            });\n            data.actions.sort();\n\n            this.initialActions = _.cloneDeep(data.actions);\n            this.initialPatterns = _.cloneDeep(data.entity.patterns);\n\n            this.parentRender(function () {\n                var promises = [], resolve = function () { return (promises[promises.length] = $.Deferred()).resolve; },\n                    data = self.data;\n\n                self.$el.find(\".tab-menu .nav-tabs\").tabdrop();\n                self.renderSettings();\n\n                self.patternsView = new ResourceTypePatternsView();\n                self.patternsView.render(data.entity, data.entity.patterns, \"#resTypePatterns\", resolve());\n\n                self.actionsList = new ResourceTypeActionsView();\n                self.actionsList.render(data, \"#resTypeActions\", resolve());\n\n                $.when(...promises).done(function () {\n                    FormHelper.setActiveTab(self);\n                    if (self.renderCallback) { self.renderCallback(); }\n                });\n            });\n        },\n\n        renderSettings () {\n            var self = this;\n            UIUtils.fillTemplateWithData(\n                \"templates/admin/views/realms/authorization/resourceTypes/ResourceTypeSettingsTemplate.html\",\n                this.data,\n                function (tpl) {\n                    self.$el.find(\"#resTypeSetting\").html(tpl);\n                    self.$el.find(\"#resTypeSetting [autofocus]\").focus();\n                });\n        },\n\n        updateFields () {\n            var app = this.data.entity,\n                dataFields = this.$el.find(\"[data-field]\"),\n                dataField;\n\n            _.each(dataFields, function (field) {\n                dataField = field.getAttribute(\"data-field\");\n\n                if (field.type === \"checkbox\") {\n                    if (field.checked) {\n                        app[dataField].push(field.value);\n                    }\n                } else {\n                    app[dataField] = field.value;\n                }\n            });\n        },\n\n        submitForm (e) {\n            e.preventDefault();\n\n            var self = this,\n                savePromise,\n                nonModifiedAttributes = _.clone(this.model.attributes),\n                activeTab = this.$el.find(\".tab-pane.active\"),\n                activeTabProperties;\n\n            this.updateFields();\n            this.activeTabId = this.$el.find(\".tab-menu li.active a\").attr(\"href\");\n\n            if (this.data.newEntity) {\n                _.extend(this.model.attributes, this.data.entity);\n            } else {\n                activeTabProperties = _.pick(this.data.entity, this.tabs[activeTab.index()].attr);\n                _.extend(this.model.attributes, activeTabProperties);\n            }\n\n            savePromise = this.model.save();\n\n            if (savePromise) {\n                savePromise\n                    .done(function () {\n                        if (self.data.newEntity) {\n                            Router.routeTo(Router.configuration.routes.realmsResourceTypeEdit, {\n                                args: _.map([self.data.realmPath, self.model.id], encodeURIComponent),\n                                trigger: true\n                            });\n                        } else {\n                            EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"changesSaved\");\n                        }\n                    });\n            } else {\n                _.extend(this.model.attributes, nonModifiedAttributes);\n                EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, this.model.validationError);\n            }\n        },\n\n        onDeleteClick (e) {\n            e.preventDefault();\n\n            FormHelper.showConfirmationBeforeDeleting({ type: $.t(\"console.authorization.common.resourceType\") },\n                _.bind(this.deleteResourceType, this));\n        },\n\n        deleteResourceType () {\n            var self = this,\n                onSuccess = function () {\n                    Router.routeTo(Router.configuration.routes.realmsResourceTypes, {\n                        args: [encodeURIComponent(self.data.realmPath)],\n                        trigger: true\n                    });\n                    EventManager.sendEvent(Constants.EVENT_DISPLAY_MESSAGE_REQUEST, \"changesSaved\");\n                },\n                onError = function (model, response) {\n                    Messages.addMessage({ response, type: Messages.TYPE_DANGER });\n                };\n\n            this.model.destroy({\n                success: onSuccess,\n                error: onError,\n                wait: true\n            });\n        }\n    });\n});\n"]}