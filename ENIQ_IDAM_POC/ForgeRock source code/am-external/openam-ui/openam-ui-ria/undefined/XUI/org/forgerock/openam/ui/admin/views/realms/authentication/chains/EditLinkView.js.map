{"version":3,"sources":["../../../../../../../../../../XUI/org/forgerock/openam/ui/admin/views/realms/authentication/chains/EditLinkView.js"],"names":["define","$","_","AbstractView","BootstrapDialog","UIUtils","SelectComponent","TemplateComponent","SelectModuleItemTemplate","SelectModuleOptionTemplate","default","EditLinkView","extend","editLinkTemplate","editLinkTableTemplate","show","view","data","self","newLink","linkConfig","module","options","criteria","formData","title","t","fillTemplateWithData","template","tableTemplate","message","$template","append","find","closable","buttons","label","action","dialog","parent","validateChain","close","cssClass","id","form","chainData","authChainConfiguration","push","addItemToList","element","render","onshow","getButton","disable","itemComponent","optionComponent","moduleSelect","allModules","selectedOption","onChange","_id","type","validateDialog","searchFields","getModalBody","el","criteriaOptions","map","allCriteria","value","key","criteriaSelect","option","labelField","on","e","$tr","target","closest","optionsKey","val","trim","optionsValue","has","refreshOptionsTab","html","length","enable"],"mappings":"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","file":"EditLinkView.js","sourcesContent":["/*\n * The contents of this file are subject to the terms of the Common Development and\n * Distribution License (the License). You may not use this file except in compliance with the\n * License.\n *\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\n * specific language governing permission and limitations under the License.\n *\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\n * information: \"Portions copyright [year] [name of copyright owner]\".\n *\n * Copyright 2015-2017 ForgeRock AS.\n */\n\ndefine([\n    \"jquery\",\n    \"lodash\",\n    \"org/forgerock/commons/ui/common/main/AbstractView\",\n    \"org/forgerock/commons/ui/common/components/BootstrapDialog\",\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\n    \"org/forgerock/openam/ui/common/components/SelectComponent\",\n    \"org/forgerock/openam/ui/common/components/TemplateComponent\",\n    \"text!templates/admin/views/realms/authentication/SelectModuleItem.html\",\n    \"text!templates/admin/views/realms/authentication/SelectModuleOption.html\"\n], ($, _, AbstractView, BootstrapDialog, UIUtils, SelectComponent, TemplateComponent, SelectModuleItemTemplate,\n    SelectModuleOptionTemplate) => { // eslint-disable-line padded-blocks\n\n    SelectComponent = SelectComponent.default;\n    TemplateComponent = TemplateComponent.default;\n\n    var EditLinkView = AbstractView.extend({\n        editLinkTemplate: \"templates/admin/views/realms/authentication/chains/EditLinkTemplate.html\",\n        editLinkTableTemplate: \"templates/admin/views/realms/authentication/chains/EditLinkTableTemplate.html\",\n        show (view) {\n            this.data = view.data;\n            var self = this,\n                newLink = !self.data.linkConfig,\n                linkConfig = self.data.linkConfig || { module: \"\", options: {}, criteria: \"\" },\n                formData = self.data,\n                title = linkConfig.module ? $.t(\"console.authentication.editChains.editModule\")\n                    : $.t(\"console.authentication.editChains.newModule\");\n\n            UIUtils.fillTemplateWithData(self.editLinkTemplate, {}, function (template) {\n                UIUtils.fillTemplateWithData(self.editLinkTableTemplate, {\n                    linkConfig\n                }, function (tableTemplate) {\n                    BootstrapDialog.show({\n                        message () {\n                            var $template = $(\"<div></div>\").append(template);\n                            $template.find(\"#editLinkOptions\").append(tableTemplate);\n                            return $template;\n                        },\n                        title,\n                        closable: false,\n                        buttons: [{\n                            label: $.t(\"common.form.cancel\"),\n                            action (dialog) {\n                                view.parent.validateChain();\n                                dialog.close();\n                            }\n                        }, {\n                            label: $.t(\"common.form.ok\"),\n                            cssClass: \"btn-primary\",\n                            id: \"saveBtn\",\n                            action (dialog) {\n                                if (newLink) {\n                                    view.data.linkConfig = linkConfig;\n                                    view.parent.data.form.chainData.authChainConfiguration.push(linkConfig);\n                                    view.parent.addItemToList(view.element);\n                                }\n\n                                view.render();\n                                dialog.close();\n                            }\n                        }],\n                        onshow (dialog) {\n                            dialog.getButton(\"saveBtn\").disable();\n\n                            const itemComponent = new TemplateComponent({\n                                template: SelectModuleItemTemplate\n                            });\n\n                            const optionComponent = new TemplateComponent({\n                                template: SelectModuleOptionTemplate\n                            });\n\n                            self.moduleSelect = new SelectComponent({\n                                options: formData.allModules,\n                                selectedOption: _.find(formData.allModules, \"_id\", linkConfig.module),\n                                onChange (module) {\n                                    linkConfig.module = module._id;\n                                    linkConfig.type = module.type;\n                                    dialog.options.validateDialog(dialog);\n                                },\n                                itemComponent,\n                                optionComponent,\n                                searchFields: [\"_id\", \"typeDescription\"]\n                            });\n                            dialog.getModalBody().find(\"[data-module-select]\")\n                                .append(self.moduleSelect.render().el);\n\n                            const criteriaOptions = _.map(formData.allCriteria, (value, key) => ({ key, value }));\n                            self.criteriaSelect = new SelectComponent({\n                                options: criteriaOptions,\n                                selectedOption: _.find(criteriaOptions, \"key\", linkConfig.criteria),\n                                onChange (option) {\n                                    linkConfig.criteria = option.key;\n                                    dialog.options.validateDialog(dialog);\n                                },\n                                labelField: \"value\",\n                                searchFields: [\"value\"]\n                            });\n                            dialog.getModalBody().find(\"[data-criteria-select]\")\n                                .append(self.criteriaSelect.render().el);\n\n                            dialog.getModalBody().on(\"click\", \"[data-add-option]\", function (e) {\n                                var $tr = $(e.target).closest(\"tr\"),\n                                    optionsKey = $tr.find(\"#optionsKey\").val().trim(),\n                                    optionsValue = $tr.find(\"#optionsValue\").val().trim(),\n                                    options = {};\n\n                                options[optionsKey] = optionsValue;\n                                if (optionsKey && optionsValue && !_.has(linkConfig.options, optionsKey)) {\n                                    _.extend(linkConfig.options, options);\n                                    dialog.options.refreshOptionsTab(dialog);\n                                    dialog.options.validateDialog(dialog);\n                                }\n                            });\n\n                            dialog.getModalBody().on(\"click\", \"[data-delete-option]\", function (e) {\n                                var optionsKey = $(e.target).closest(\"tr\").find(\".optionsKey\").html();\n                                if (_.has(linkConfig.options, optionsKey)) {\n                                    delete linkConfig.options[optionsKey];\n                                }\n                                dialog.options.refreshOptionsTab(dialog);\n                                dialog.options.validateDialog(dialog);\n                            });\n                        },\n                        validateDialog (dialog) {\n                            if (linkConfig.module.length === 0 || linkConfig.criteria.length === 0) {\n                                dialog.getButton(\"saveBtn\").disable();\n                            } else {\n                                dialog.getButton(\"saveBtn\").enable();\n                            }\n                        },\n                        refreshOptionsTab (dialog) {\n                            UIUtils.fillTemplateWithData(self.editLinkTableTemplate, {\n                                linkConfig\n                            }, function (tableTemplate) {\n                                dialog.getModalBody().find(\"#editLinkOptions\").html(tableTemplate);\n                            });\n                        }\n\n                    });\n                });\n            });\n        }\n    });\n    return new EditLinkView();\n});\n"]}