{"version":3,"sources":["../../../../../../../XUI/org/forgerock/commons/ui/common/maines/AbstractView.js"],"names":["define","$","_","Backbone","Configuration","Constants","EventManager","ModuleLoader","Router","ThemeManager","UIUtils","ValidatorsManager","validationStarted","event","target","Deferred","reject","load","then","validationCompleted","formElement","button","find","length","prop","formValidated","View","extend","element","baseTemplate","mode","defaultEvents","initialize","data","events","delegateEvents","parentRender","callback","_this","needsNewBaseTemplate","noBaseTemplate","registerListener","EVENT_REQUEST_RESEND_REQUIRED","unlock","getTheme","theme","renderTemplate","globalData","bind","loadTemplate","self","validateCurrent","has","route","url","getCurrentHash","replace","configuration","routes","login","match","setElement","$el","unbind","setProperty","sendEvent","EVENT_CHANGE_BASE_VIEW","when","apply","map","partials","preloadPartial","template","noop","rebind","render","args","validationSuccessful","input","popover","parents","removeClass","closest","validationFailed","details","addClass","options","content","failures","join","validationMessage","animation","trigger","placement","html","is","onValidate","console","warn"],"mappings":"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","file":"AbstractView.js","sourcesContent":["/**\r\n * The contents of this file are subject to the terms of the Common Development and\r\n * Distribution License (the License). You may not use this file except in compliance with the\r\n * License.\r\n *\r\n * You can obtain a copy of the License at legal/CDDLv1.0.txt. See the License for the\r\n * specific language governing permission and limitations under the License.\r\n *\r\n * When distributing Covered Software, include this CDDL Header Notice in each file and include\r\n * the License file at legal/CDDLv1.0.txt. If applicable, add the following below the CDDL\r\n * Header, with the fields enclosed by brackets [] replaced by your own identifying\r\n * information: \"Portions copyright [year] [name of copyright owner]\".\r\n *\r\n * Copyright 2011-2016 ForgeRock AS.\r\n */\r\n/* eslint-disable */\r\n define([\r\n    \"jquery\",\r\n    \"underscore\",\r\n    \"backbone\",\r\n    \"org/forgerock/commons/ui/common/main/Configuration\",\r\n    \"org/forgerock/commons/ui/common/util/Constants\",\r\n    \"org/forgerock/commons/ui/common/main/EventManager\",\r\n    \"org/forgerock/commons/ui/common/util/ModuleLoader\",\r\n    \"org/forgerock/commons/ui/common/main/Router\",\r\n    \"ThemeManager\",\r\n    \"org/forgerock/commons/ui/common/util/UIUtils\",\r\n    \"org/forgerock/commons/ui/common/main/ValidatorsManager\"\r\n], function($, _, Backbone, Configuration, Constants, EventManager, ModuleLoader, Router, ThemeManager, UIUtils,\r\n            ValidatorsManager) {\r\n    /**\r\n     * @exports org/forgerock/commons/ui/common/main/AbstractView\r\n     */\r\n\r\n     /**\r\n       Internal helper method shared by the default implementations of\r\n       validationSuccessful and validationFailed\r\n     */\r\n    function validationStarted (event) {\r\n        if (!event || !event.target) {\r\n            return $.Deferred().reject();\r\n        }\r\n        // necessary to load bootstrap for popover support\r\n        // (which isn't always necessary for AbstractView)\r\n        return ModuleLoader.load(\"bootstrap\").then(function () {\r\n            return $(event.target);\r\n        });\r\n    }\r\n\r\n    /**\r\n      Sets the enabled state of the submit button based on the validation status of the provided form\r\n    */\r\n    function validationCompleted (formElement) {\r\n        var button = formElement.find(\"input[type=submit]\");\r\n\r\n        if (!button.length) {\r\n            button = formElement.find(\"#submit\");\r\n        }\r\n        if (button.length) {\r\n            button.prop('disabled', !ValidatorsManager.formValidated(formElement));\r\n        }\r\n    }\r\n\r\n    return Backbone.View.extend({\r\n\r\n        /**\r\n         * This params should be passed when creating new object, for example:\r\n         * new View({el: \"#someId\", template: \"templates/main.html\"});\r\n         */\r\n        element: \"#content\",\r\n\r\n        baseTemplate: \"templates/common/DefaultBaseTemplate.html\",\r\n\r\n        /**\r\n         * View mode: replace or append\r\n         */\r\n        mode: \"replace\",\r\n        defaultEvents: {\r\n            \"validationSuccessful :input\": \"validationSuccessful\",\r\n            \"validationReset :input\": \"validationSuccessful\",\r\n            \"validationFailed :input\": \"validationFailed\"\r\n        },\r\n        initialize: function () {\r\n            this.data = this.data || {};\r\n            _.extend(this.events, this.defaultEvents);\r\n            this.delegateEvents();\r\n        },\r\n\r\n        /**\r\n         * Change content of 'el' element with 'viewTpl',\r\n         * which is compiled using 'data' attributes.\r\n         */\r\n        parentRender: function(callback) {\r\n            this.callback = callback;\r\n\r\n            var _this = this,\r\n                needsNewBaseTemplate = function () {\r\n                    return (Configuration.baseTemplate !== _this.baseTemplate && !_this.noBaseTemplate);\r\n                };\r\n            EventManager.registerListener(Constants.EVENT_REQUEST_RESEND_REQUIRED, function () {\r\n                _this.unlock();\r\n            });\r\n\r\n            ThemeManager.getTheme().then(function(theme){\r\n                _this.data.theme = theme;\r\n\r\n                if (needsNewBaseTemplate()) {\r\n                    UIUtils.renderTemplate(\r\n                        _this.baseTemplate,\r\n                        $(\"#wrapper\"),\r\n                        _.extend({}, Configuration.globalData, _this.data),\r\n                        _.bind(_this.loadTemplate, _this),\r\n                        \"replace\",\r\n                        needsNewBaseTemplate);\r\n                } else {\r\n                    _this.loadTemplate();\r\n                }\r\n            });\r\n        },\r\n\r\n        loadTemplate: function() {\r\n            var self = this,\r\n                validateCurrent = function () {\r\n                    if (!_.has(self, \"route\")) {\r\n                        return true;\r\n                    } else if (!self.route.url.length && Router.getCurrentHash().replace(/^#/, '') === \"\") {\r\n                        return true;\r\n                    } else if (self.route === Router.configuration.routes.login) {\r\n                        /**\r\n                         * Determines if the current route is a login route, in which case allow the route  to execute.\r\n                         * This is due to OpenAM's requirement for two views rendering being rendered at the same time\r\n                         * (an arbitrary view and a session expiry login dialog view layered above) where the route and\r\n                         * the hash don't match.\r\n                         */\r\n                        return true;\r\n                    } else {\r\n                        return Router.getCurrentHash().replace(/^#/, '').match(self.route.url);\r\n                    }\r\n                };\r\n\r\n            this.setElement($(this.element));\r\n            this.$el.unbind();\r\n            this.delegateEvents();\r\n\r\n            if (Configuration.baseTemplate !== this.baseTemplate && !this.noBaseTemplate) {\r\n                Configuration.setProperty(\"baseTemplate\", this.baseTemplate);\r\n                EventManager.sendEvent(Constants.EVENT_CHANGE_BASE_VIEW);\r\n            }\r\n\r\n            // Ensure all partials are (pre)loaded before rendering the template\r\n            $.when.apply($, _.map(this.partials, UIUtils.preloadPartial)).then(function () {\r\n                UIUtils.renderTemplate(\r\n                    self.template,\r\n                    self.$el,\r\n                    _.extend({}, Configuration.globalData, self.data),\r\n                    self.callback ? _.bind(self.callback, self) : _.noop(),\r\n                    self.mode,\r\n                    validateCurrent);\r\n            });\r\n        },\r\n\r\n        rebind: function() {\r\n            this.setElement($(this.element));\r\n            this.$el.unbind();\r\n            this.delegateEvents();\r\n        },\r\n\r\n        render: function(args, callback) {\r\n            this.parentRender(callback);\r\n        },\r\n\r\n\r\n        /**\r\n         * This is the default implementation of the function used to reflect that\r\n         * a given field has passed validation. It is invoked via a the event system,\r\n         * and can be overridden per-view as needed.\r\n         */\r\n        validationSuccessful: function (event) {\r\n            validationStarted(event)\r\n            .then(function (input) {\r\n                if (input.data()[\"bs.popover\"]) {\r\n                    input.popover('destroy');\r\n                }\r\n                input.parents(\".form-group\").removeClass('has-feedback has-error');\r\n                return input.closest(\"form\");\r\n            })\r\n            .then(validationCompleted);\r\n        },\r\n\r\n        /**\r\n         * This is the default implementation of the function used to reflect that\r\n         * a given field has failed validation. It is invoked via a the event system,\r\n         * and can be overridden per-view as needed.\r\n         *\r\n         * @param {object} details - \"failures\" entry lists all messages (localized) associated with this validation\r\n         *                           failure\r\n         */\r\n        validationFailed: function (event, details) {\r\n            validationStarted(event)\r\n            .then(function (input) {\r\n                input.parents(\".form-group\").addClass('has-feedback has-error');\r\n                if (input.data()[\"bs.popover\"]) {\r\n                    input.data('bs.popover').options.content = '<i class=\"fa fa-exclamation-circle\"></i> '\r\n                        + details.failures.join('<br><i class=\"fa fa-exclamation-circle\"></i> ');\r\n                } else {\r\n                    input.popover({\r\n                        validationMessage: details.failures,\r\n                        animation: false,\r\n                        content: '<i class=\"fa fa-exclamation-circle\"></i> '\r\n                        + details.failures.join('<br><i class=\"fa fa-exclamation-circle\"></i> '),\r\n                        trigger:'focus hover',\r\n                        placement:'top',\r\n                        html: 'true',\r\n                        template: '<div class=\"popover popover-error help-block\" role=\"tooltip\">' +\r\n                            '<div class=\"arrow\"></div><h3 class=\"popover-title\"></h3>' +\r\n                            '<div class=\"popover-content\"></div></div>'\r\n                    });\r\n                }\r\n                if (input.is(\":focus\")) {\r\n                    input.popover(\"show\");\r\n                }\r\n                return input.closest(\"form\");\r\n            })\r\n            .then(validationCompleted);\r\n        },\r\n\r\n        // legacy; needed here to prevent breakage of views which have an event registered for this function\r\n        onValidate: function() {\r\n            console.warn(\"Deprecated use of onValidate method; Change to validationSuccessful / validationFailed\");\r\n        }\r\n    });\r\n});"]}